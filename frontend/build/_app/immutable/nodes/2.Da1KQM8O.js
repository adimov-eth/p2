import"../chunks/DsnmJJEf.js";import{i as ot}from"../chunks/cIRUh3x8.js";import{d as oa,w as Wt,g as Be,c as Pa,o as ga,s as M,b as $i}from"../chunks/CDBZvZta.js";import{T as Yt,D as Ga,y as Ua,al as Ja,E as ns,aa as ji,g as e,aw as Ot,ac as Ai,ad as Ni,ae as Us,B as fs,F as Na,C as ni,G as Li,S as Es,ah as Pi,af as Fa,L as oi,Z as ri,R as li,ao as re,aZ as Bs,a_ as Hs,ai as ci,aj as Di,a$ as cs,b0 as ms,aH as di,b1 as ds,b2 as zi,z as vi,b3 as Mi,K as Oi,b4 as Fi,W as ui,b5 as pi,am as os,b6 as qi,t as W,b7 as Ri,I as Ui,A as Bi,V as Vs,b8 as Hi,ak as Vi,b as v,e as z,X as Ji,b9 as Wi,n as Ta,ba as Xi,aI as Os,bb as Gi,aK as Yi,aq as Ki,bc as Zi,bd as Qi,p as Ke,ap as h,be as Pe,bf as Ft,i as ze,k as Ce,l as p,o as Ze,bg as Js,m as T,w as o,q as n,v as i,bh as Jt,bi as ue,aG as pt,bj as Et,bk as rs,bl as Dt,aF as bt,bm as ls,bn as Ya,aV as Wa,bo as en,au as Cs,u as qa,a as ss,aE as _t,s as na,a9 as hs,bp as tn,j as an,bq as sn}from"../chunks/CT77F0NY.js";import{p as Y,i as B,b as wa,u as Ws,s as Ge,a as Xt,c as nn,_ as on,r as fi}from"../chunks/Bh6sRKLl.js";import{b as ta,a as vt,r as ft,c as mi,d as Fs,e as He,s as qe,f as hi,g as rn}from"../chunks/DaU5v6TT.js";function ln(s,t){Yt&&Ga(Ua(s)),Ja(()=>{var a=t();for(var d in a){var l=a[d];l?s.style.setProperty(d,l):s.style.removeProperty(d)}})}let is=null;function nt(s,t){return t}function cn(s,t,a){for(var d=s.items,l=[],c=t.length,u=0;u<c;u++)Mi(t[u].e,l,!0);var b=c>0&&l.length===0&&a!==null;if(b){var r=a.parentNode;Oi(r),r.append(a),d.clear(),pa(s,t[0].prev,t[c-1].next)}Fi(l,()=>{for(var g=0;g<c;g++){var y=t[g];b||(d.delete(y.k),pa(s,y.prev,y.next)),di(y.e,!b)}})}function Je(s,t,a,d,l,c=null){var u=s,b={flags:t,items:new Map,first:null},r=(t&pi)!==0;if(r){var g=s;u=Yt?Ga(Ua(g)):g.appendChild(li())}Yt&&ns();var y=null,m=!1,x=new Map,k=Ot(()=>{var I=a();return ri(I)?I:I==null?[]:oi(I)}),f,C;function w(){dn(C,f,b,x,u,l,t,d,a),c!==null&&(f.length===0?y?ci(y):y=Es(()=>c(u)):y!==null&&Di(y,()=>{y=null}))}ji(()=>{C??=ui,f=e(k);var I=f.length;if(m&&I===0)return;m=I===0;let O=!1;if(Yt){var H=Ai(u)===Ni;H!==(I===0)&&(u=Us(),Ga(u),fs(!1),O=!0)}if(Yt){for(var F=null,A,S=0;S<I;S++){if(Na.nodeType===ni&&Na.data===Li){u=Na,O=!0,fs(!1);break}var $=f[S],J=d($,S);A=$s(Na,b,F,null,$,J,S,l,t,a),b.items.set(J,A),F=A}I>0&&Ga(Us())}if(Yt)I===0&&c&&(y=Es(()=>c(u)));else if(Pi()){var fe=new Set,ee=Fa;for(S=0;S<I;S+=1){$=f[S],J=d($,S);var L=b.items.get(J)??x.get(J);L?(t&(ds|cs))!==0&&gi(L,$,S,t):(A=$s(null,b,null,null,$,J,S,l,t,a,!0),x.set(J,A)),fe.add(J)}for(const[ve,P]of b.items)fe.has(ve)||ee.skipped_effects.add(P.e);ee.add_callback(w)}else w();O&&fs(!0),e(k)}),Yt&&(u=Na)}function dn(s,t,a,d,l,c,u,b,r){var g=(u&qi)!==0,y=(u&(ds|cs))!==0,m=t.length,x=a.items,k=a.first,f=k,C,w=null,I,O=[],H=[],F,A,S,$;if(g)for($=0;$<m;$+=1)F=t[$],A=b(F,$),S=x.get(A),S!==void 0&&(S.a?.measure(),(I??=new Set).add(S));for($=0;$<m;$+=1){if(F=t[$],A=b(F,$),S=x.get(A),S===void 0){var J=d.get(A);if(J!==void 0){d.delete(A),x.set(A,J);var fe=w?w.next:f;pa(a,w,J),pa(a,J,fe),gs(J,fe,l),w=J}else{var ee=f?f.e.nodes_start:l;w=$s(ee,a,w,w===null?a.first:w.next,F,A,$,c,u,r)}x.set(A,w),O=[],H=[],f=w.next;continue}if(y&&gi(S,F,$,u),(S.e.f&ms)!==0&&(ci(S.e),g&&(S.a?.unfix(),(I??=new Set).delete(S))),S!==f){if(C!==void 0&&C.has(S)){if(O.length<H.length){var L=H[0],ve;w=L.prev;var P=O[0],E=O[O.length-1];for(ve=0;ve<O.length;ve+=1)gs(O[ve],L,l);for(ve=0;ve<H.length;ve+=1)C.delete(H[ve]);pa(a,P.prev,E.next),pa(a,w,P),pa(a,E,L),f=L,w=E,$-=1,O=[],H=[]}else C.delete(S),gs(S,f,l),pa(a,S.prev,S.next),pa(a,S,w===null?a.first:w.next),pa(a,w,S),w=S;continue}for(O=[],H=[];f!==null&&f.k!==A;)(f.e.f&ms)===0&&(C??=new Set).add(f),H.push(f),f=f.next;if(f===null)continue;S=f}O.push(S),w=S,f=S.next}if(f!==null||C!==void 0){for(var N=C===void 0?[]:oi(C);f!==null;)(f.e.f&ms)===0&&N.push(f),f=f.next;var K=N.length;if(K>0){var be=(u&pi)!==0&&m===0?l:null;if(g){for($=0;$<K;$+=1)N[$].a?.measure();for($=0;$<K;$+=1)N[$].a?.fix()}cn(a,N,be)}}g&&os(()=>{if(I!==void 0)for(S of I)S.a?.apply()}),s.first=a.first&&a.first.e,s.last=w&&w.e;for(var se of d.values())di(se.e);d.clear()}function gi(s,t,a,d){(d&ds)!==0&&Hs(s.v,t),(d&cs)!==0?Hs(s.i,a):s.i=a}function $s(s,t,a,d,l,c,u,b,r,g,y){var m=is,x=(r&ds)!==0,k=(r&zi)===0,f=x?k?re(l,!1,!1):Bs(l):l,C=(r&cs)===0?u:Bs(u),w={i:C,v:f,k:c,a:null,e:null,prev:a,next:d};is=w;try{if(s===null){var I=document.createDocumentFragment();I.append(s=li())}return w.e=Es(()=>b(s,f,C,g),Yt),w.e.prev=a&&a.e,w.e.next=d&&d.e,a===null?y||(t.first=w):(a.next=w,a.e.next=w.e),d!==null&&(d.prev=w,d.e.prev=w.e),w}finally{is=m}}function gs(s,t,a){for(var d=s.next?s.next.e.nodes_start:a,l=t?t.e.nodes_start:a,c=s.e.nodes_start;c!==null&&c!==d;){var u=vi(c);l.before(c),c=u}}function pa(s,t,a){t===null?s.first=a:(t.next=a,t.e.next=a&&a.e),a!==null&&(a.prev=t,a.e.prev=t&&t.e)}function Xs(s,t,a=!1,d=!1,l=!1){var c=s,u="";W(()=>{var b=ui;if(u===(u=t()??"")){Yt&&ns();return}if(b.nodes_start!==null&&(Ri(b.nodes_start,b.nodes_end),b.nodes_start=b.nodes_end=null),u!==""){if(Yt){Na.data;for(var r=ns(),g=r;r!==null&&(r.nodeType!==ni||r.data!=="");)g=r,r=vi(r);if(r===null)throw Ui(),Bi;Vs(Na,g),c=Ga(r);return}var y=u+"";a?y=`<svg>${y}</svg>`:d&&(y=`<math>${y}</math>`);var m=Hi(y);if((a||d)&&(m=Ua(m)),Vs(Ua(m),m.lastChild),a||d)for(;Ua(m);)c.before(Ua(m));else c.before(m)}})}function vn(s,t,a,d,l){Yt&&ns();var c=t.$$slots?.[a],u=!1;c===!0&&(c=t.children,u=!0),c===void 0||c(s,u?()=>d:d)}function un(s,t,a){Vi(()=>{var d=v(()=>t(s,a?.())||{});if(a&&d?.update){var l=!1,c={};Ja(()=>{var u=a();z(u),l&&Ji(c,u)&&(c=u,d.update(u))}),l=!0}if(d?.destroy)return()=>d.destroy()})}const pn=()=>performance.now(),ma={tick:s=>requestAnimationFrame(s),now:()=>pn(),tasks:new Set};function yi(){const s=ma.now();ma.tasks.forEach(t=>{t.c(s)||(ma.tasks.delete(t),t.f())}),ma.tasks.size!==0&&ma.tick(yi)}function bi(s){let t;return ma.tasks.size===0&&ma.tick(yi),{promise:new Promise(a=>{ma.tasks.add(t={c:s,f:a})}),abort(){ma.tasks.delete(t)}}}function fn(s){if(s==="float")return"cssFloat";if(s==="offset")return"cssOffset";if(s.startsWith("--"))return s;const t=s.split("-");return t.length===1?t[0]:t[0]+t.slice(1).map(a=>a[0].toUpperCase()+a.slice(1)).join("")}function Gs(s){const t={},a=s.split(";");for(const d of a){const[l,c]=d.split(":");if(!l||c===void 0)break;const u=fn(l.trim());t[u]=c.trim()}return t}const mn=s=>s;function hn(s,t,a){var d=is,l,c,u,b=null;d.a??={element:s,measure(){l=this.element.getBoundingClientRect()},apply(){if(u?.abort(),c=this.element.getBoundingClientRect(),l.left!==c.left||l.right!==c.right||l.top!==c.top||l.bottom!==c.bottom){const r=t()(this.element,{from:l,to:c},a?.());u=_i(this.element,r,void 0,1,()=>{u?.abort(),u=void 0})}},fix(){if(!s.getAnimations().length){var{position:r,width:g,height:y}=getComputedStyle(s);if(r!=="absolute"&&r!=="fixed"){var m=s.style;b={position:m.position,width:m.width,height:m.height,transform:m.transform},m.position="absolute",m.width=g,m.height=y;var x=s.getBoundingClientRect();if(l.left!==x.left||l.top!==x.top){var k=`translate(${l.left-x.left}px, ${l.top-x.top}px)`;m.transform=m.transform?`${m.transform} ${k}`:k}}}},unfix(){if(b){var r=s.style;r.position=b.position,r.width=b.width,r.height=b.height,r.transform=b.transform}}},d.a.element=s}function _i(s,t,a,d,l){if(Wi(t)){var c,u=!1;return os(()=>{if(!u){var C=t({direction:"in"});c=_i(s,C,a,d,l)}}),{abort:()=>{u=!0,c?.abort()},deactivate:()=>c.deactivate(),reset:()=>c.reset(),t:()=>c.t()}}if(!t?.duration)return l(),{abort:Ta,deactivate:Ta,reset:Ta,t:()=>d};const{delay:b=0,css:r,tick:g,easing:y=mn}=t;var m=[];if(g&&g(0,1),r){var x=Gs(r(0,1));m.push(x,x)}var k=()=>1-d,f=s.animate(m,{duration:b,fill:"forwards"});return f.onfinish=()=>{f.cancel();var C=1-d,w=d-C,I=t.duration*Math.abs(w),O=[];if(I>0){var H=!1;if(r)for(var F=Math.ceil(I/16.666666666666668),A=0;A<=F;A+=1){var S=C+w*y(A/F),$=Gs(r(S,1-S));O.push($),H||=$.overflow==="hidden"}H&&(s.style.overflow="hidden"),k=()=>{var J=f.currentTime;return C+w*y(J/I)},g&&bi(()=>{if(f.playState!=="running")return!1;var J=k();return g(J,1-J),!0})}f=s.animate(O,{duration:I,fill:"forwards"}),f.onfinish=()=>{k=()=>d,g?.(d,1-d),l()}},{abort:()=>{f&&(f.cancel(),f.effect=null,f.onfinish=Ta)},deactivate:()=>{l=Ta},reset:()=>{},t:()=>k()}}function wt(s,t,a=t){var d=Xi(),l=new WeakSet;Os(s,"input",c=>{var u=c?s.defaultValue:s.value;if(u=bs(s)?_s(u):u,a(u),Fa!==null&&l.add(Fa),d&&u!==(u=t())){var b=s.selectionStart,r=s.selectionEnd;s.value=u??"",r!==null&&(s.selectionStart=b,s.selectionEnd=Math.min(r,s.value.length))}}),(Yt&&s.defaultValue!==s.value||v(t)==null&&s.value)&&(a(bs(s)?_s(s.value):s.value),Fa!==null&&l.add(Fa)),Ja(()=>{var c=t();if(s===document.activeElement){var u=Gi??Fa;if(l.has(u))return}bs(s)&&c===_s(s.value)||s.type==="date"&&!c&&!s.value||c!==s.value&&(s.value=c??"")})}const ys=new Set;function gn(s,t,a,d,l=d){var c=a.getAttribute("type")==="checkbox",u=s;let b=!1;if(t!==null)for(var r of t)u=u[r]??=[];u.push(a),Os(a,"change",()=>{var g=a.__value;c&&(g=Ys(u,g,a.checked)),l(g)},()=>l(c?[]:null)),Ja(()=>{var g=d();if(Yt&&a.defaultChecked!==a.checked){b=!0;return}c?(g=g||[],a.checked=g.includes(a.__value)):a.checked=Yi(a.__value,g)}),Ki(()=>{var g=u.indexOf(a);g!==-1&&u.splice(g,1)}),ys.has(u)||(ys.add(u),os(()=>{u.sort((g,y)=>g.compareDocumentPosition(y)===4?-1:1),ys.delete(u)})),os(()=>{if(b){var g;if(c)g=Ys(u,g,a.checked);else{var y=u.find(m=>m.checked);g=y?.__value}l(g)}})}function yn(s,t,a=t){Os(s,"change",d=>{var l=d?s.defaultChecked:s.checked;a(l)}),(Yt&&s.defaultChecked!==s.checked||v(t)==null)&&a(s.checked),Ja(()=>{var d=t();s.checked=!!d})}function Ys(s,t,a){for(var d=new Set,l=0;l<s.length;l+=1)s[l].checked&&d.add(s[l].__value);return a||d.delete(t),Array.from(d)}function bs(s){var t=s.type;return t==="number"||t==="range"}function _s(s){return s===""?null:+s}function bn(s,t){Zi(window,["resize"],()=>Qi(()=>t(window[s])))}function wi(s){return function(...t){var a=t[0];return a.stopPropagation(),s?.apply(this,t)}}function qs(s,t){var a=s.$$events?.[t.type],d=ri(a)?a.slice():a==null?[]:[a];for(var l of d)l.call(this,t)}let Za=null;async function St(){return Za||(Za=await import(new URL("/server.js",window.location.origin).href),Za)}const Ct=Wt(null),Ba=Wt(!0),La=Wt(null),vs=oa(Ct,s=>s?.replicas||new Map),ha=oa(Ct,s=>s?.history||[]),xi=oa(Ct,s=>s?.height||0);async function js(){try{Ba.set(!0),La.set(null);const s=await St();s.registerEnvChangeCallback?.(a=>{Ct.set(a),console.log("🔄 BROWSER-DEBUG: Environment updated automatically"),console.log(`🔍 BROWSER-DEBUG: Updated env - Height: ${a.height}, Replicas: ${a.replicas?.size||0}`),typeof window<"u"&&(window.xlnEnv=a)}),console.log("🚀 BROWSER-DEBUG: Starting XLN initialization..."),console.log("🔍 BROWSER-DEBUG: About to call xln.main() - this will load snapshots and start j-watcher");const t=await Promise.race([s.main(),new Promise((a,d)=>setTimeout(()=>d(new Error("Local DB taking too long - using empty state")),200))]);if(console.log(`✅ BROWSER-DEBUG: XLN.main() completed! Loaded env with ${t.replicas?.size||0} replicas`),t.replicas&&t.replicas.size>0){console.log("🔍 BROWSER-DEBUG: Loaded replicas from IndexedDB:");for(const[a,d]of t.replicas.entries()){const[l,c]=a.split(":");console.log(`🔍   Entity ${l.slice(0,10)}... (${c}): jBlock=${d.state.jBlock}, height=${d.state.height}, isProposer=${d.isProposer}`)}}else console.log("🔍 BROWSER-DEBUG: No replicas loaded - starting with fresh state");return Ct.set(t),Ba.set(!1),typeof window<"u"&&(window.xlnEnv=t),console.log("✅ XLN Environment initialized with auto-reactivity"),t}catch(s){console.error("❌ XLN initialization failed:",s);try{const t=await St();console.log("🔄 Attempting minimal environment creation...");const a={replicas:new Map,height:0,timestamp:Date.now(),serverInput:{serverTxs:[],entityInputs:[]},history:[]};return Ct.set(a),Ba.set(!1),typeof window<"u"&&(window.xlnEnv=a),console.log("✅ Minimal XLN Environment created"),a}catch(t){const a=s instanceof Error?s.message:"Failed to initialize";throw La.set(a),Ba.set(!1),console.error("❌ Fallback initialization also failed:",t),s}}}const _n=Object.freeze(Object.defineProperty({__proto__:null,currentHeight:xi,error:La,getXLN:St,history:ha,initializeXLN:js,isLoading:Ba,replicas:vs,xlnEnvironment:Ct},Symbol.toStringTag,{value:"Module"})),As={theme:"dark",dropdownMode:"signer-first",serverDelay:0,portfolioScale:5e3,componentStates:{}},zt=Wt(As),ws="xln-settings",xs="xlnComponentStates",Ha={loadFromStorage(){try{if(typeof localStorage>"u")return;const s=localStorage.getItem(ws);if(s){const a=JSON.parse(s);zt.update(d=>({...d,...a}))}const t=localStorage.getItem(xs);if(t){const a=JSON.parse(t);zt.update(d=>({...d,componentStates:a}))}console.log("⚙️ Settings loaded from localStorage")}catch(s){console.error("❌ Failed to load settings:",s),zt.set(As)}},saveToStorage(){try{if(typeof localStorage>"u")return;const s=Be(zt),{componentStates:t,...a}=s;localStorage.setItem(ws,JSON.stringify(a)),localStorage.setItem(xs,JSON.stringify(t)),console.log("💾 Settings saved to localStorage")}catch(s){console.error("❌ Failed to save settings:",s)}},setTheme(s){zt.update(t=>({...t,theme:s})),this.saveToStorage(),typeof document<"u"&&document.documentElement.setAttribute("data-theme",s)},toggleTheme(){const s=Be(zt);this.setTheme(s.theme==="dark"?"light":"dark")},setDropdownMode(s){zt.update(t=>({...t,dropdownMode:s})),this.saveToStorage()},toggleDropdownMode(){const s=Be(zt);this.setDropdownMode(s.dropdownMode==="signer-first"?"entity-first":"signer-first")},setServerDelay(s){zt.update(t=>({...t,serverDelay:s})),this.saveToStorage()},setPortfolioScale(s){zt.update(t=>({...t,portfolioScale:s})),this.saveToStorage()},getComponentState(s){const t=Be(zt);return t.componentStates[s]!==void 0?t.componentStates[s]:s.includes("consensus-")||s.includes("chat-")},setComponentState(s,t){zt.update(a=>({...a,componentStates:{...a.componentStates,[s]:t}})),this.saveToStorage()},toggleComponentState(s){const t=this.getComponentState(s);this.setComponentState(s,!t)},resetToDefaults(){zt.set(As),this.saveToStorage(),typeof localStorage<"u"&&(localStorage.removeItem(ws),localStorage.removeItem(xs))},initialize(){this.loadFromStorage();const s=Be(zt);typeof document<"u"&&document.documentElement.setAttribute("data-theme",s.theme)}},Vt=Wt([]),Aa=Wt(null),Oa=Wt(1),Ks="xln-entity-tabs",Ia={loadFromStorage(){try{if(typeof localStorage>"u")return;const s=localStorage.getItem(Ks);if(s){const t=JSON.parse(s);Vt.set(t.tabs||[]),Aa.set(t.activeTabId||null),Oa.set(t.nextTabId||1),console.log("📁 Tabs loaded from localStorage:",t)}}catch(s){console.error("❌ Failed to load tabs:",s),Vt.set([]),Aa.set(null),Oa.set(1)}},saveToStorage(){try{if(typeof localStorage>"u")return;const s={tabs:Be(Vt),activeTabId:Be(Aa),nextTabId:Be(Oa)};localStorage.setItem(Ks,JSON.stringify(s)),console.log("💾 Tabs saved to localStorage:",s)}catch(s){console.error("❌ Failed to save tabs:",s)}},generateTabId(){const s=Be(Oa);return Oa.set(s+1),`tab-${s}`},addTab(s,t,a){const l=Be(Vt).length+1,c={id:this.generateTabId(),title:`Entity Panel ${l}`,jurisdiction:a||"Ethereum",signer:t||"",entityId:s||"",isActive:!1};return Vt.update(u=>[...u,c]),this.setActiveTab(c.id),this.saveToStorage(),console.log("➕ Added new panel:",c),c},closeTab(s){const t=Be(Vt);if(console.log("❌ Closing tab:",s),t.length<=1){console.log("⚠️ Cannot close last tab");return}if(t.findIndex(c=>c.id===s)===-1)return;const d=t.filter(c=>c.id!==s);Vt.set(d),Be(Aa)===s&&this.setActiveTab(d[0].id),this.saveToStorage()},setActiveTab(s){console.log("🎯 Setting active tab:",s),Vt.update(t=>t.map(a=>({...a,isActive:a.id===s}))),Aa.set(s),this.saveToStorage()},getActiveTab(){const s=Be(Vt),t=Be(Aa);return s.find(a=>a.id===t)||null},updateTab(s,t){Vt.update(a=>a.map(d=>d.id===s?{...d,...t}:d)),this.saveToStorage()},getTab(s){return Be(Vt).find(a=>a.id===s)||null},initializeDefaultTabs(){console.log("📋 Starting with 0 panels by default")},clearAllTabs(){Vt.set([]),Aa.set(null),Oa.set(1),this.saveToStorage()}},wn=()=>{if(typeof localStorage<"u")try{const s=localStorage.getItem("xln-time-state");if(s){const t=JSON.parse(s);return{currentTimeIndex:t.currentTimeIndex??-1,maxTimeIndex:t.maxTimeIndex??0,isLive:t.isLive??!0}}}catch(s){console.warn("Failed to load time state from localStorage:",s)}return{currentTimeIndex:-1,maxTimeIndex:0,isLive:!0}},Mt=Wt(wn()),xn=oa(Mt,s=>s.currentTimeIndex),kn=oa(Mt,s=>s.isLive);oa(Mt,s=>s.maxTimeIndex);const ki=oa([Mt,ha,Ct],([s,t,a])=>{if(s.isLive)return a?.replicas||new Map;const d=s.currentTimeIndex;return d>=0&&d<t.length?t[d]?.replicas||new Map:new Map}),Sn=oa([Mt,ha,Ct],([s,t,a])=>{if(s.isLive)return a?.gossip||null;const d=s.currentTimeIndex;return d>=0&&d<t.length&&t[d]?.gossip||null});oa([Mt,ha,Ct],([s,t,a])=>{if(s.isLive)return a;const d=s.currentTimeIndex;return d>=0&&d<t.length?t[d]:a});const Sa={saveTimeState(s){if(typeof localStorage<"u")try{localStorage.setItem("xln-time-state",JSON.stringify(s))}catch(t){console.warn("Failed to save time state to localStorage:",t)}},updateMaxTimeIndex(){const s=Be(ha),t=Math.max(0,s.length-1);Mt.update(a=>({...a,maxTimeIndex:t}))},goToTimeIndex(s){const t=Be(Mt),a=Math.max(-1,Math.min(s,t.maxTimeIndex)),d={currentTimeIndex:a,maxTimeIndex:t.maxTimeIndex,isLive:a===-1};Mt.set(d),this.saveTimeState(d),console.log("🕰️ Time machine moved to index:",a),this.triggerEntityPanelUpdates()},goToLive(){this.goToTimeIndex(-1)},goToHistoryStart(){this.goToTimeIndex(0)},goToHistoryEnd(){const s=Be(Mt);this.goToTimeIndex(s.maxTimeIndex)},stepBackward(){const s=Be(Mt);s.isLive?this.goToTimeIndex(s.maxTimeIndex):this.goToTimeIndex(Math.max(0,s.currentTimeIndex-1))},stepForward(){const s=Be(Mt);s.isLive||(s.currentTimeIndex<s.maxTimeIndex?this.goToTimeIndex(s.currentTimeIndex+1):this.goToLive())},getCurrentSnapshot(){const s=Be(Mt);if(s.isLive)return null;const t=Be(ha);return s.currentTimeIndex>=0&&s.currentTimeIndex<t.length?t[s.currentTimeIndex]:null},getTimeInfo(){const s=Be(Mt),t=Be(ha);return s.isLive?{status:"LIVE",description:"Current time",frameNumber:t.length,totalFrames:t.length}:{status:"HISTORICAL",description:this.getCurrentSnapshot()?.description||"Historical snapshot",frameNumber:s.currentTimeIndex+1,totalFrames:t.length}},triggerEntityPanelUpdates(){window.dispatchEvent(new CustomEvent("timeChanged",{detail:{timeIndex:Be(Mt).currentTimeIndex}}))},initialize(){this.updateMaxTimeIndex(),ha.subscribe(s=>{const t=Be(Mt);t.isLive?this.updateMaxTimeIndex():console.log(`🕰️ TIME-MACHINE: Ignoring history update while in historical mode (index: ${t.currentTimeIndex})`)})}};function Tn(s,t){Ke(t,!1);const a=re(),d=re(),l=Pa();let c=Y(t,"isActive",12,!1),u=Y(t,"autoMode",12,!1),b=Y(t,"speed",8,2e3);const r=[{id:"start",title:"Welcome to XLN Tutorial",description:"Learn how to create entities and proposals in XLN. You can switch between auto and manual mode anytime.",selector:".app-container",action:"highlight",position:"bottom"},{id:"formation-tab",title:"Open Entity Formation",description:"Click on the Formation tab to start creating a new entity",selector:"text=Formation",action:"click",position:"bottom"},{id:"entity-name",title:"Enter Entity Name",description:"Give your entity a meaningful name",selector:"#entityNameInput",action:"fill",value:"Tutorial Entity",position:"right"},{id:"add-validator",title:"Add Second Validator",description:"Entities need multiple validators for consensus",selector:'button:has-text("➕ Add Validator")',action:"click",position:"left"},{id:"select-alice",title:"Select Alice as First Validator",description:"Choose alice as the first validator",selector:".validator-row:first-child .validator-name",action:"select",value:"alice",position:"right"},{id:"select-bob",title:"Select Bob as Second Validator",description:"Choose bob as the second validator",selector:".validator-row:last-child .validator-name",action:"select",value:"bob",position:"right"},{id:"set-threshold",title:"Set Consensus Threshold",description:"Set how many validators must agree for decisions",selector:"#thresholdSlider",action:"fill",value:"1",position:"top"},{id:"create-entity",title:"Create the Entity",description:"Click to create your entity with the configured validators",selector:'button:has-text("Create Entity")',action:"click",position:"top",validation:()=>window.xlnEnv?.replicas?.size>0},{id:"wait-creation",title:"Wait for Entity Creation",description:"The system is processing your entity...",selector:".entity-panel",action:"wait",position:"top"},{id:"select-entity",title:"Select Your Entity",description:"Click the entity dropdown to select your newly created entity",selector:".unified-dropdown:first-child",action:"click",position:"bottom"},{id:"pick-entity",title:"Choose Entity from List",description:"Select the entity you just created",selector:"#dropdownResults .dropdown-item:first-child",action:"click",position:"right"},{id:"select-signer",title:"Select Signer",description:"Choose who will sign transactions for this entity",selector:".unified-dropdown:nth-child(2)",action:"click",position:"bottom"},{id:"pick-alice",title:"Choose Alice as Signer",description:"Select alice to sign transactions",selector:"#dropdownResults .dropdown-item:first-child",action:"click",position:"right"},{id:"expand-controls",title:"Expand Controls Section",description:"Click to expand the controls where you can create proposals",selector:".entity-panel .controls-header",action:"click",position:"left"},{id:"proposal-title",title:"Enter Proposal Title",description:"Give your proposal a clear, descriptive title",selector:'input[placeholder="Enter proposal title..."]',action:"fill",value:"Approve Marketing Budget",position:"top"},{id:"proposal-description",title:"Enter Proposal Description",description:"Provide details about what this proposal is for",selector:'textarea[placeholder="Enter proposal description..."]',action:"fill",value:"Approve $50,000 budget for Q4 marketing campaigns",position:"top"},{id:"create-proposal",title:"Create Proposal",description:"Submit your proposal to the entity for voting",selector:'button:has-text("Create Proposal")',action:"click",position:"bottom"},{id:"proposal-created",title:"Proposal Created!",description:"Your proposal has been created and is now visible in the proposals list",selector:".proposal-item",action:"highlight",position:"right"},{id:"complete",title:"Tutorial Complete!",description:"You have successfully created an entity and proposal. Explore the voting features next!",selector:".app-container",action:"highlight",position:"top"}];let g=re(0),y=!1,m=null,x=null,k=null;ga(()=>{c()&&f()});function f(){h(g,0),y=!1,F()}function C(){c(!1),fe(),l("tutorialEnd")}function w(){y=!0}function I(){y=!1,u()&&setTimeout(()=>O(),b())}function O(){e(g)<r.length-1?(Js(g),F()):C()}function H(){e(g)>0&&(Js(g,-1),F())}async function F(){if(!e(a))return;fe(),await new Promise(E=>setTimeout(E,100));const P=document.querySelector(e(a).selector);if(!P){console.warn(`Tutorial: Element not found for selector: ${e(a).selector}`),u()&&!y&&setTimeout(()=>O(),1e3);return}m=P,$(P,e(a)),S(P),u()&&!y&&setTimeout(async()=>{if(await A(P,e(a)),e(a).validation){let E=0;const N=10,K=()=>{e(a).validation()||E>=N?setTimeout(()=>O(),500):(E++,setTimeout(K,500))};K()}else setTimeout(()=>O(),b())},1e3)}async function A(P,E){try{switch(E.action){case"click":P.click();break;case"fill":(P instanceof HTMLInputElement||P instanceof HTMLTextAreaElement)&&(P.focus(),P.value=E.value||"",P.dispatchEvent(new Event("input",{bubbles:!0})),P.dispatchEvent(new Event("change",{bubbles:!0})));break;case"select":P instanceof HTMLSelectElement&&(P.value=E.value||"",P.dispatchEvent(new Event("change",{bubbles:!0})));break;case"wait":break;case"highlight":break}}catch(N){console.warn("Tutorial action failed:",N)}}function S(P){const E=document.createElement("div");E.className="tutorial-ripple";const N=P.getBoundingClientRect();E.style.left=`${N.left+N.width/2}px`,E.style.top=`${N.top+N.height/2}px`,document.body.appendChild(E),setTimeout(()=>{E.remove()},2e3)}function $(P,E){x=document.createElement("div"),x.className="tutorial-overlay",document.body.appendChild(x),k=document.createElement("div"),k.className="tutorial-tooltip",k.innerHTML=`
      <div class="tutorial-tooltip-content">
        <h3>${E.title}</h3>
        <p>${E.description}</p>
        <div class="tutorial-controls">
          <button class="tutorial-btn tutorial-btn-secondary" data-action="previous" ${e(g)===0?"disabled":""}>Previous</button>
          <button class="tutorial-btn tutorial-btn-primary" data-action="next">${e(d)?"Finish":"Next"}</button>
          <button class="tutorial-btn tutorial-btn-toggle" data-action="toggle-mode">${u()?"Manual":"Auto"}</button>
          ${u()&&!y?'<button class="tutorial-btn tutorial-btn-warning" data-action="pause">Pause</button>':""}
          ${u()&&y?'<button class="tutorial-btn tutorial-btn-success" data-action="resume">Resume</button>':""}
          <button class="tutorial-btn tutorial-btn-danger" data-action="stop">Exit</button>
        </div>
        <div class="tutorial-progress">
          <div class="tutorial-progress-bar" style="width: ${(e(g)+1)/r.length*100}%"></div>
        </div>
        <div class="tutorial-step-info">${e(g)+1} of ${r.length}</div>
      </div>
    `;const N=P.getBoundingClientRect(),K=E.position||"bottom";document.body.appendChild(k);const be=k.getBoundingClientRect();let se=N.left+N.width/2-be.width/2,Z=N.bottom+10;switch(K){case"top":Z=N.top-be.height-10;break;case"left":se=N.left-be.width-10,Z=N.top+N.height/2-be.height/2;break;case"right":se=N.right+10,Z=N.top+N.height/2-be.height/2;break}se=Math.max(10,Math.min(se,window.innerWidth-be.width-10)),Z=Math.max(10,Math.min(Z,window.innerHeight-be.height-10)),k.style.left=`${se}px`,k.style.top=`${Z}px`,k.addEventListener("click",J),P.classList.add("tutorial-highlight"),P.style.position="relative",P.style.zIndex="10001"}function J(P){switch(P.target.getAttribute("data-action")){case"next":O();break;case"previous":H();break;case"toggle-mode":u(!u()),F();break;case"pause":w(),F();break;case"resume":I();break;case"stop":C();break}}function fe(){m&&(m.classList.remove("tutorial-highlight"),m.style.position="",m.style.zIndex=""),x&&(x.remove(),x=null),k&&(k.removeEventListener("click",J),k.remove(),k=null)}Pe(()=>e(g),()=>{h(a,r[e(g)]||null)}),Pe(()=>e(g),()=>{h(d,e(g)>=r.length-1)}),Ft(),ot();var ee=ze(),L=Ce(ee);{var ve=P=>{};B(L,P=>{c()&&P(ve)})}p(s,ee),Ze()}var In=T('<div class="tutorial-launcher-overlay svelte-hjfs3g"><div class="tutorial-launcher svelte-hjfs3g"><div class="tutorial-intro svelte-hjfs3g"><h3 class="svelte-hjfs3g">🎓 Learn XLN</h3> <p class="svelte-hjfs3g">Interactive tutorial showing how to create entities and proposals</p> <div class="tutorial-modes svelte-hjfs3g"><div class="mode-option svelte-hjfs3g"><h4 class="svelte-hjfs3g">🤖 Auto Mode</h4> <p class="svelte-hjfs3g">AI guides you through each step automatically</p> <button class="tutorial-btn tutorial-btn-primary svelte-hjfs3g">Start Auto Tutorial</button></div> <div class="mode-option svelte-hjfs3g"><h4 class="svelte-hjfs3g">👆 Manual Mode</h4> <p class="svelte-hjfs3g">You control the pace, click Next to advance</p> <button class="tutorial-btn tutorial-btn-secondary svelte-hjfs3g">Start Manual Tutorial</button></div></div> <div class="tutorial-settings svelte-hjfs3g"><label class="svelte-hjfs3g">Auto Speed: <select class="svelte-hjfs3g"><option>Fast (1s)</option><option>Normal (2s)</option><option>Slow (3s)</option></select></label></div> <div class="tutorial-skip svelte-hjfs3g"><button class="tutorial-btn tutorial-btn-skip svelte-hjfs3g">❌ Skip Tutorial</button></div></div></div></div>'),En=T("<!> <!>",1);function Cn(s,t){Ke(t,!1);const a=Pa();let d=Y(t,"isVisible",12,!1),l=re(!1),c=re(!0),u=re(2e3);function b(C="auto"){h(c,C==="auto"),h(l,!0)}function r(){h(l,!1),d(!1),a("tutorialComplete")}function g(){d(!1),a("tutorialSkipped")}ot();var y=En(),m=Ce(y);{var x=C=>{var w=In(),I=n(w),O=n(I),H=o(n(O),4),F=n(H),A=o(n(F),4);i(F);var S=o(F,2),$=o(n(S),4);i(S),i(H);var J=o(H,2),fe=n(J),ee=o(n(fe));W(()=>{e(u),Jt(()=>{})});var L=n(ee);L.value=L.__value=1e3;var ve=o(L);ve.value=ve.__value=2e3;var P=o(ve);P.value=P.__value=3e3,i(ee),i(fe),i(J);var E=o(J,2),N=n(E);i(E),i(O),i(I),i(w),ue("click",A,()=>b("auto")),ue("click",$,()=>b("manual")),ta(ee,()=>e(u),K=>h(u,K)),ue("click",N,g),ue("click",I,wi(function(K){qs.call(this,t,K)})),ue("click",w,g),p(C,w)};B(m,C=>{d()&&!e(l)&&C(x)})}var k=o(m,2);{var f=C=>{Tn(C,{get isActive(){return e(l)},get autoMode(){return e(c)},get speed(){return e(u)},$$events:{tutorialEnd:r}})};B(k,C=>{e(l)&&C(f)})}p(s,y),Ze()}var $n=T('<div class="tutorial-explanation svelte-apjo2k"><span class="tutorial-explanation-icon svelte-apjo2k">💡</span> <span class="svelte-apjo2k"> </span></div>'),jn=T('<div class="tutorial-action-hint svelte-apjo2k"><button class="tutorial-action-btn svelte-apjo2k"><!></button></div>'),An=T('<div class="tutorial-overlay svelte-apjo2k"><div class="tutorial-backdrop svelte-apjo2k"></div> <div class="tutorial-panel svelte-apjo2k"><div class="tutorial-header svelte-apjo2k"><div class="tutorial-progress-container svelte-apjo2k"><div class="tutorial-progress-bar svelte-apjo2k"><div class="tutorial-progress-fill svelte-apjo2k"></div></div> <span class="tutorial-step-counter svelte-apjo2k"> </span></div> <button class="tutorial-close-btn svelte-apjo2k">×</button></div> <div class="tutorial-content svelte-apjo2k"><h3 class="tutorial-title svelte-apjo2k"> </h3> <p class="tutorial-description svelte-apjo2k"> </p> <!> <!></div> <div class="tutorial-navigation svelte-apjo2k"><button class="tutorial-nav-btn tutorial-prev-btn svelte-apjo2k">← Previous</button> <button class="tutorial-skip-btn svelte-apjo2k">Skip Tutorial</button> <button class="tutorial-nav-btn tutorial-next-btn svelte-apjo2k"> </button></div></div></div>');function Nn(s,t){Ke(t,!1);const a=re(),d=re();let l=Y(t,"isVisible",12,!1),c=Y(t,"currentStep",12,0),u=Y(t,"totalSteps",8,0),b=Y(t,"tutorialData",24,()=>[]);const r=Pa();let g=re(),y=null;ga(()=>{console.log("🎯 Tutorial overlay mounted")});function m(){c()<u()-1&&(Ws(c),C(),r("stepChanged",{step:c(),stepData:e(a)}))}function x(){c()>0&&(Ws(c,-1),C(),r("stepChanged",{step:c(),stepData:e(a)}))}function k(){l(!1),w(),r("close")}function f(){if(!e(a)?.targetSelector||!e(a)?.action)return;const F=document.querySelector(e(a).targetSelector);if(!F){console.warn(`🎯 Tutorial target not found: ${e(a).targetSelector}`);return}switch(e(a).action){case"click":F.click();break;case"fill":(F instanceof HTMLInputElement||F instanceof HTMLTextAreaElement)&&(F.value=e(a).actionData||"",F.dispatchEvent(new Event("input",{bubbles:!0})));break;case"select":F instanceof HTMLSelectElement&&(F.value=e(a).actionData||"",F.dispatchEvent(new Event("change",{bubbles:!0})));break}setTimeout(m,1e3)}function C(){if(w(),!e(a)?.targetSelector||!e(a)?.highlightElement)return;const F=document.querySelector(e(a).targetSelector);F&&(F.classList.add("tutorial-highlight"),y=F,F.scrollIntoView({behavior:"smooth",block:"center"}))}function w(){y&&(y.classList.remove("tutorial-highlight"),y=null)}Pe(()=>(z(b()),z(c())),()=>{h(a,b()[c()]||null)}),Pe(()=>(z(u()),z(c())),()=>{h(d,u()>0?(c()+1)/u()*100:0)}),Pe(()=>(z(l()),e(a)),()=>{l()&&e(a)&&C()}),Ft(),ot();var I=ze(),O=Ce(I);{var H=F=>{var A=An(),S=n(A),$=o(S,2),J=n($),fe=n(J),ee=n(fe),L=n(ee);i(ee);var ve=o(ee,2),P=n(ve);i(ve),i(fe);var E=o(fe,2);i(J);var N=o(J,2),K=n(N),be=n(K,!0);i(K);var se=o(K,2),Z=n(se,!0);i(se);var R=o(se,2);{var q=ie=>{var pe=$n(),we=o(n(pe),2),G=n(we,!0);i(we),i(pe),W(()=>M(G,(e(a),v(()=>e(a).explanation)))),p(ie,pe)};B(R,ie=>{e(a),v(()=>e(a).explanation)&&ie(q)})}var ce=o(R,2);{var me=ie=>{var pe=jn(),we=n(pe),G=n(we);{var de=le=>{var ne=pt("🖱️ Click for me");p(le,ne)},Se=le=>{var ne=ze(),Ie=Ce(ne);{var D=he=>{var De=pt("✏️ Fill for me");p(he,De)},_=he=>{var De=ze(),Le=Ce(De);{var ge=te=>{var ke=pt("📋 Select for me");p(te,ke)},X=te=>{var ke=pt("▶️ Do action");p(te,ke)};B(Le,te=>{e(a),v(()=>e(a).action==="select")?te(ge):te(X,!1)},!0)}p(he,De)};B(Ie,he=>{e(a),v(()=>e(a).action==="fill")?he(D):he(_,!1)},!0)}p(le,ne)};B(G,le=>{e(a),v(()=>e(a).action==="click")?le(de):le(Se,!1)})}i(we),i(pe),ue("click",we,f),p(ie,pe)};B(ce,ie=>{e(a),v(()=>e(a).action&&e(a).targetSelector)&&ie(me)})}i(N);var $e=o(N,2),je=n($e),ae=o(je,2),V=o(ae,2),U=n(V,!0);i(V),i($e),i($),i(A),wa(A,ie=>h(g,ie),()=>e(g)),W(()=>{vt(L,`width: ${e(d)??""}%`),M(P,`Step ${c()+1} of ${u()??""}`),M(be,(e(a),v(()=>e(a).title))),M(Z,(e(a),v(()=>e(a).description))),je.disabled=c()===0,V.disabled=c()>=u()-1,M(U,c()>=u()-1?"Finish":"Next →")}),ue("click",S,k),ue("click",E,k),ue("click",je,x),ue("click",ae,k),ue("click",V,m),p(F,A)};B(O,F=>{l()&&e(a)&&F(H)})}p(s,I),Ze()}const Ln={id:"quick-start",title:"Quick Start: Create Your First Entity",description:"Get started with XLN in under 60 seconds. Create Alice's entity and send your first transaction.",difficulty:"beginner",estimatedTime:"1 minute",steps:[{id:"navigate",title:"Welcome to XLN",description:"You're now in the XLN dashboard. Let's create your first entity!",action:"wait",target:"#formationTabContent",explanation:"The formation tab is where you create new entities. Think of entities as smart wallets or organizations."},{id:"select-entity-type",title:"Choose Entity Type",description:'Select "lazy" entity type for quick setup',action:"select",target:"#entityTypeSelect",value:"lazy",explanation:"Lazy entities are perfect for testing - they work without on-chain registration."},{id:"name-entity",title:"Name Your Entity",description:"Give your entity a memorable name",action:"fill",target:"#entityNameInput",value:"My First Entity",explanation:"Entity names help you identify them in the interface. Choose something meaningful!"},{id:"select-validator",title:"Choose Validator",description:"Select Alice as your validator (the signer who can authorize transactions)",action:"click",target:'[data-validator-id="0"] .validator-selector',explanation:"Validators are the accounts that can sign transactions for this entity. Alice is a pre-configured test account."},{id:"pick-alice",title:"Pick Alice",description:"Click on alice.eth from the dropdown",action:"click",target:'#validatorOptions0 [data-signer="alice"]',explanation:"Alice is one of the test accounts available in XLN for demonstration purposes."},{id:"set-threshold",title:"Set Voting Threshold",description:"Keep threshold at 1 (Alice can act alone)",action:"fill",target:"#thresholdSlider",value:"1",explanation:"Threshold determines how many validators must agree for transactions. 1 means Alice has full control."},{id:"create-entity",title:"Create Entity",description:"Click the Create Entity button to launch your entity!",action:"click",target:'button[type="submit"]',explanation:"This creates the entity and imports it into all relevant validator accounts."},{id:"verify-creation",title:"Entity Created!",description:"Your entity is now live and ready for transactions",action:"wait",target:".entity-panel",explanation:"🎉 Congratulations! You've created your first XLN entity. You can now send messages, create proposals, and interact with other entities."}]},Pn={id:"complete-workflow",title:"Complete Entity & Channel Workflow",description:"Master the full XLN experience: create entities, demonstrate governance, and prepare for channels.",difficulty:"intermediate",estimatedTime:"15 minutes",steps:[{id:"setup",title:"Navigate to XLN Dashboard",description:"Load the XLN interface and ensure the environment is ready",action:"navigate",target:"/",explanation:"The XLN dashboard provides entity formation, channel management, and consensus monitoring all in one interface."},{id:"alice-entity-type",title:"Create Alice's Simple Entity",description:'Select lazy entity type and name it "Alice Personal Wallet"',action:"select",target:"#entityTypeSelect",value:"lazy",explanation:"This creates a simple 1-of-1 entity where Alice has full control. Perfect for personal wallets or testing."},{id:"alice-entity-name",title:"Name Alice's Entity",description:'Enter "Alice Personal Wallet" as the entity name',action:"fill",target:"#entityNameInput",value:"Alice Personal Wallet"},{id:"alice-validator",title:"Set Alice as Validator",description:"Select Alice as the validator for her personal entity",action:"click",target:'[data-validator-id="0"] .validator-selector'},{id:"alice-threshold",title:"Set Threshold to 1",description:"Set voting threshold to 1 (Alice can act alone)",action:"fill",target:"#thresholdSlider",value:"1"},{id:"create-alice-entity",title:"Create Alice's Entity",description:"Click Create Entity to launch Alice's personal wallet",action:"click",target:'button[type="submit"]',explanation:"Entity creation involves cryptographic consensus. Alice's entity is now live and can receive transactions."},{id:"add-validators",title:"Create Multi-Signature Hub",description:"Add more validators for the hub entity",action:"click",target:'button[data-action="add-validator"]',explanation:"Multi-signature entities provide enhanced security. Any 2 of the 3 validators can authorize transactions."},{id:"hub-name",title:"Name the Hub",description:'Enter "Payment Hub ABC" as the hub name',action:"fill",target:"#entityNameInput",value:"Payment Hub ABC"},{id:"hub-threshold",title:"Set Hub Threshold",description:"Set threshold to 2 (requires 2 out of 3 signatures)",action:"fill",target:"#thresholdSlider",value:"2"},{id:"create-hub",title:"Create Hub Entity",description:"Click Create Entity to launch the multi-sig hub",action:"click",target:'button[type="submit"]',explanation:"The hub is now operational with 3 validator replicas. Each validator maintains their own view of the entity state."},{id:"configure-panels",title:"Configure Entity Panels",description:"Set up panels to show different validator views",action:"click",target:".entity-panel:first-child .unified-dropdown-btn",explanation:"Each panel can show a different signer's view of any entity they participate in."},{id:"send-chat",title:"Send Chat Message",description:"Demonstrate entity communication with a chat message",action:"fill",target:".controls-section textarea",value:"Hello from Alice! Ready to create channels.",explanation:"Chat messages are cryptographically signed and become part of the entity's permanent state."},{id:"create-proposal",title:"Create Channel Opening Proposal",description:"Propose to open a payment channel with the hub",action:"select",target:".controls-dropdown",value:"proposal",explanation:"Proposals enable democratic decision-making. This proposal would authorize opening a payment channel."},{id:"multi-sig-voting",title:"Demonstrate Multi-Signature Voting",description:"Other validators vote on the proposal",action:"click",target:'.vote-button[data-choice="yes"]',explanation:"With multiple YES votes, the proposal reaches quorum and will be executed automatically."},{id:"time-machine",title:"Use Time Machine",description:"Review entity history using the time machine controls",action:"click",target:'.time-btn-compact[data-action="back"]',explanation:"The time machine allows you to replay the entire entity history, perfect for audits and debugging."},{id:"completion",title:"Tutorial Complete!",description:"You've mastered entity creation and governance. Ready for channels!",action:"wait",target:".entity-panels-container",explanation:"🎉 Tutorial complete! You've created entities, demonstrated multi-signature governance, and are ready for channel operations."}]},Dn={id:"multi-sig-governance",title:"Multi-Signature Governance",description:"Learn democratic decision-making with multi-signature entities.",difficulty:"intermediate",estimatedTime:"10 minutes",steps:[{id:"create-multi-sig",title:"Create Multi-Sig Entity",description:"Set up a 2-of-3 entity with Alice, Bob, and Carol",action:"select",target:"#entityTypeSelect",value:"lazy",explanation:"Multi-signature entities require multiple validators to agree before executing transactions."}]},zn={id:"proposal-workflow",title:"🗳️ Proposal & Voting Workflow",description:"Learn how to create proposals, vote, and execute collective decisions in XLN entities.",difficulty:"intermediate",estimatedTime:"8 minutes",steps:[{id:"introduction",title:"Proposal System Overview",description:"Learn how XLN enables collective decision-making through proposals and voting.",action:"wait",target:".app-container",explanation:"XLN proposals allow entity members to propose actions and vote democratically. Proposals execute automatically when thresholds are met.",screenshot:"proposal-01-introduction"},{id:"navigate-formation",title:"Open Entity Formation",description:"Click the Formation tab to create a new entity for our proposal demonstration",action:"click",target:'button:has-text("Formation")',explanation:"First, we need an entity with multiple validators to demonstrate the proposal workflow.",screenshot:"proposal-02-formation-tab"},{id:"set-entity-name",title:"Name Your Entity",description:'Enter "Governance DAO" as the entity name',action:"fill",target:"#entityNameInput",value:"Governance DAO",explanation:"Give your entity a meaningful name that reflects its purpose.",screenshot:"proposal-03-entity-name"},{id:"add-validator",title:"Add Second Validator",description:'Click "Add Validator" to create a multi-signature entity',action:"click",target:'button:has-text("➕ Add Validator")',explanation:"Multi-validator entities enable democratic governance through voting.",screenshot:"proposal-04-add-validator"},{id:"select-alice",title:"Choose Alice as First Validator",description:"Select alice from the dropdown for the first validator",action:"select",target:".validator-row:first-child .validator-name",value:"alice",explanation:"Alice will be our first validator with voting rights.",screenshot:"proposal-05-select-alice"},{id:"select-bob",title:"Choose Bob as Second Validator",description:"Select bob from the dropdown for the second validator",action:"select",target:".validator-row:last-child .validator-name",value:"bob",explanation:"Bob will be our second validator. With 2 validators, we can demonstrate voting.",screenshot:"proposal-06-select-bob"},{id:"set-threshold",title:"Set Voting Threshold",description:"Set threshold to 1 so either validator can approve proposals",action:"fill",target:"#thresholdSlider",value:"1",explanation:"Threshold determines how many validators must approve a proposal for it to execute.",screenshot:"proposal-07-threshold"},{id:"create-entity",title:"Create the Entity",description:'Click "Create Entity" to establish your governance entity',action:"click",target:'button:has-text("Create Entity")',explanation:"This creates the entity with the configured validators and voting rules.",screenshot:"proposal-08-create-entity"},{id:"wait-creation",title:"Entity Created Successfully",description:"Your governance entity is now ready for proposals and voting",action:"wait",target:".entity-panel",explanation:"The entity is now active and ready for governance operations.",screenshot:"proposal-09-entity-ready"},{id:"select-entity-dropdown",title:"Select Your Entity",description:"Click the entity dropdown to select your newly created entity",action:"click",target:".unified-dropdown:first-child",explanation:"Select the entity to interact with it.",screenshot:"proposal-10-entity-dropdown"},{id:"pick-entity",title:"Choose Your Entity",description:'Select the "Governance DAO" entity from the dropdown',action:"click",target:"#dropdownResults .dropdown-item:first-child",explanation:"This selects the entity for governance operations.",screenshot:"proposal-11-pick-entity"},{id:"select-signer-dropdown",title:"Select Signer",description:"Click the signer dropdown to choose who will create the proposal",action:"click",target:".unified-dropdown:nth-child(2)",explanation:"The signer determines who is creating and initially voting on the proposal.",screenshot:"proposal-12-signer-dropdown"},{id:"pick-alice-signer",title:"Choose Alice as Signer",description:"Select Alice to act as the proposal creator",action:"click",target:"#dropdownResults .dropdown-item:first-child",explanation:"Alice will create the proposal and automatically vote as the proposer.",screenshot:"proposal-13-pick-alice"},{id:"expand-controls",title:"Expand Controls Section",description:'Click "Controls" to open the proposal creation interface',action:"click",target:'.entity-panel button:has-text("Controls")',explanation:"The controls section contains proposal creation and voting tools.",screenshot:"proposal-14-expand-controls"},{id:"fill-proposal-title",title:"Enter Proposal Title",description:'Type "Marketing Budget Approval" as the proposal title',action:"fill",target:'input[placeholder="Enter proposal title..."]',value:"Marketing Budget Approval",explanation:"Clear, descriptive titles help validators understand what they're voting on.",screenshot:"proposal-15-title-filled"},{id:"fill-proposal-description",title:"Enter Proposal Description",description:"Add a detailed description of the proposal",action:"fill",target:'textarea[placeholder="Enter proposal description..."]',value:"Approve $75,000 budget for Q4 marketing campaigns including social media, content creation, and partnership outreach.",explanation:"Detailed descriptions help validators make informed decisions.",screenshot:"proposal-16-description-filled"},{id:"submit-proposal",title:"Create the Proposal",description:'Click "Create Proposal" to submit it to the entity for voting',action:"click",target:'button:has-text("Create Proposal")',explanation:"This creates the proposal and automatically adds Alice's YES vote as the proposer.",screenshot:"proposal-17-proposal-created"},{id:"view-proposal",title:"Proposal Created!",description:"Your proposal is now visible in the proposals list with Alice's automatic vote",action:"wait",target:".proposal-item",explanation:"Proposals show voting status, threshold progress, and execution state.",screenshot:"proposal-18-proposal-visible"},{id:"switch-to-bob",title:"Switch to Bob for Voting",description:"Now let's switch to Bob to demonstrate the voting process",action:"click",target:".unified-dropdown:nth-child(2)",explanation:"Different signers can vote on proposals to reach consensus.",screenshot:"proposal-19-switch-bob"},{id:"select-bob-signer",title:"Select Bob as Signer",description:"Choose Bob from the signer dropdown",action:"click",target:"#dropdownResults .dropdown-item:nth-child(2)",explanation:"Bob will now vote on Alice's proposal.",screenshot:"proposal-20-bob-selected"},{id:"expand-bob-controls",title:"Open Bob's Controls",description:`Click "Controls" to access Bob's voting interface`,action:"click",target:'.entity-panel button:has-text("Controls")',explanation:"Each signer has access to the same governance tools.",screenshot:"proposal-21-bob-controls"},{id:"select-proposal-vote",title:"Select Proposal to Vote On",description:'Choose the "Marketing Budget Approval" proposal from the voting dropdown',action:"select",target:'select option:has-text("Marketing Budget")',value:"Marketing Budget Approval",explanation:"Select which proposal to vote on from the list of pending proposals.",screenshot:"proposal-22-select-proposal"},{id:"vote-yes",title:"Vote YES on the Proposal",description:'Select "Yes" to approve the marketing budget proposal',action:"click",target:'input[type="radio"][value="yes"]',explanation:"Bob votes YES to approve the marketing budget.",screenshot:"proposal-23-vote-yes"},{id:"add-vote-comment",title:"Add Vote Comment",description:"Add a comment explaining your vote",action:"fill",target:'textarea[placeholder*="vote comment"]',value:"Excellent proposal. The marketing budget is well-justified and will drive growth.",explanation:"Comments provide context for voting decisions and improve governance transparency.",screenshot:"proposal-24-vote-comment"},{id:"submit-vote",title:"Submit Your Vote",description:`Click "Submit Vote" to record Bob's YES vote`,action:"click",target:'button:has-text("Submit Vote")',explanation:"This records Bob's vote and may trigger proposal execution if threshold is met.",screenshot:"proposal-25-vote-submitted"},{id:"proposal-executed",title:"Proposal Approved & Executed!",description:"The proposal reached consensus and executed automatically",action:"wait",target:'.proposal-item:has-text("APPROVED")',explanation:"When voting threshold is met, proposals execute automatically. Check the chat for execution confirmation.",screenshot:"proposal-26-executed"},{id:"view-collective-message",title:"Collective Action Recorded",description:"Notice the collective message in chat confirming proposal execution",action:"wait",target:'.chat-messages .message-item:has-text("[COLLECTIVE]")',explanation:"Executed proposals generate collective messages visible to all entity members.",screenshot:"proposal-27-collective-message"},{id:"completion",title:"Proposal Workflow Complete!",description:"You've mastered XLN's governance system: creating proposals, voting, and automatic execution",action:"wait",target:".entity-panel",explanation:"🎉 You now understand XLN's democratic governance: proposals → voting → automatic execution. This enables trustless collective decision-making.",screenshot:"proposal-28-completion"}]},Ns=[Ln,Pn,Dn,zn];function Ls(s){return Ns.find(t=>t.id===s)}const Ps=Wt(!1),Ra=Wt(null),fa=Wt(0),Qa=Wt({}),Ka=oa(Ra,s=>s?Ls(s):null),Ds=oa([Ka,fa],([s,t])=>s?.steps[t]||null);oa([Ka,fa],([s,t])=>s?(t+1)/s.steps.length*100:0);class Mn{highlightedElement=null;startTutorial(t){const a=Ls(t);if(!a){console.error(`Tutorial not found: ${t}`);return}Ra.set(t),fa.set(0),Ps.set(!0),console.log(`🎯 Starting tutorial: ${a.title}`),this.applyCurrentStep()}nextStep(){const t=Be(Ka),a=Be(fa);t&&(a<t.steps.length-1?(fa.update(d=>d+1),this.applyCurrentStep()):this.completeTutorial())}prevStep(){Be(fa)>0&&(fa.update(a=>a-1),this.applyCurrentStep())}executeStepAction(){const t=Be(Ds);if(!t)return;const a=document.querySelector(t.target);if(!a){console.warn(`🎯 Tutorial target not found: ${t.target}`);return}switch(t.action){case"click":a.click();break;case"fill":(a instanceof HTMLInputElement||a instanceof HTMLTextAreaElement)&&(a.value=t.value||"",a.dispatchEvent(new Event("input",{bubbles:!0})));break;case"select":a instanceof HTMLSelectElement&&(a.value=t.value||"",a.dispatchEvent(new Event("change",{bubbles:!0})));break;case"navigate":t.value&&(window.location.href=t.value);break}setTimeout(()=>this.nextStep(),1500)}applyCurrentStep(){const t=Be(Ds);if(!t)return;if(this.clearHighlight(),t.target&&t.action!=="wait"){const l=document.querySelector(t.target);l&&(this.highlightElement(l),l.scrollIntoView({behavior:"smooth",block:"center"}))}const a=Be(Ra),d=Be(fa);a&&(Qa.update(l=>({...l,[a]:d})),this.saveProgressToStorage())}highlightElement(t){t.classList.add("tutorial-highlight"),this.highlightedElement=t}clearHighlight(){this.highlightedElement&&(this.highlightedElement.classList.remove("tutorial-highlight"),this.highlightedElement=null)}completeTutorial(){const t=Be(Ra);console.log(`🎉 Tutorial completed: ${t}`),this.endTutorial(),this.showCompletionMessage()}endTutorial(){Ps.set(!1),Ra.set(null),fa.set(0),this.clearHighlight()}goToStep(t){const a=Be(Ka);!a||t<0||t>=a.steps.length||(fa.set(t),this.applyCurrentStep())}getTutorialProgress(t){return Be(Qa)[t]||0}isTutorialCompleted(t){const a=Ls(t);return a?this.getTutorialProgress(t)>=a.steps.length-1:!1}saveProgressToStorage(){const t=Be(Qa);localStorage.setItem("xln-tutorial-progress",JSON.stringify(t))}loadProgressFromStorage(){try{const t=localStorage.getItem("xln-tutorial-progress");if(t){const a=JSON.parse(t);Qa.set(a)}}catch(t){console.warn("Failed to load tutorial progress:",t)}}showCompletionMessage(){console.log("🎉 Tutorial completed! Great job!"),window.dispatchEvent(new CustomEvent("tutorial-completed",{detail:{tutorialId:Be(Ra)}}))}getAvailableTutorials(){return Ns}getTutorialsByDifficulty(t){return Ns.filter(a=>a.difficulty===t)}}const On=new Mn;On.loadProgressFromStorage();var Fn=T('<span class="j-status-item svelte-1lqo3oe" title="J-Watcher Proposer Status"> </span>'),qn=T('<div class="modal-overlay svelte-1lqo3oe"><div class="modal-content svelte-1lqo3oe"><div class="modal-header svelte-1lqo3oe"><h3 class="svelte-1lqo3oe">⚙️ Settings</h3> <button class="modal-close svelte-1lqo3oe">&times;</button></div> <div class="modal-body svelte-1lqo3oe"><div class="setting-group svelte-1lqo3oe"><label for="dropdownModeToggle" class="svelte-1lqo3oe"><strong class="svelte-1lqo3oe">Dropdown Hierarchy Mode</strong> <br class="svelte-1lqo3oe"/><small class="svelte-1lqo3oe">Toggle between Jurisdiction→Signer→Entity vs Jurisdiction→Entity→Signers</small></label> <div class="toggle-switch svelte-1lqo3oe"><input type="checkbox" id="dropdownModeToggle" class="svelte-1lqo3oe"/> <span class="toggle-slider svelte-1lqo3oe"></span></div> <div class="toggle-labels svelte-1lqo3oe"><span class="svelte-1lqo3oe">Jur→Signer→Entity</span> <span class="svelte-1lqo3oe">Jur→Entity→Signers</span></div></div> <div class="setting-group svelte-1lqo3oe"><label for="serverDelaySlider" class="svelte-1lqo3oe"><strong class="svelte-1lqo3oe">Server Processing Delay</strong> <br class="svelte-1lqo3oe"/><small class="svelte-1lqo3oe">Simulate network delay in consensus processing (0ms = instant)</small></label> <div class="slider-container svelte-1lqo3oe"><input type="range" id="serverDelaySlider" min="0" max="1000" class="svelte-1lqo3oe"/> <div class="slider-value svelte-1lqo3oe"><span class="svelte-1lqo3oe"> </span> ms</div></div></div></div></div></div>'),Rn=T('<div class="admin-topbar svelte-1lqo3oe"><div class="admin-logo svelte-1lqo3oe"><span class="logo-text svelte-1lqo3oe">xln</span> <div class="j-machine-status svelte-1lqo3oe"><span class="j-status-item svelte-1lqo3oe" title="Last Synced J-machine Block"> </span> <span class="j-status-item svelte-1lqo3oe" title="Pending J-machine Events"> </span> <span class="j-status-item svelte-1lqo3oe" title="Server Height (E-machine Frames)"> </span> <!> <div class="scale-control svelte-1lqo3oe" title="Adjust portfolio bar scale for better comparison"><span class="scale-label svelte-1lqo3oe"> </span> <input type="range" min="1000" max="10000" step="500" class="scale-slider svelte-1lqo3oe"/></div></div></div> <div class="admin-navigation svelte-1lqo3oe"></div> <div class="admin-controls svelte-1lqo3oe"><button class="admin-btn svelte-1lqo3oe" title="Run Demo"><span class="svelte-1lqo3oe">▶️</span></button> <button class="admin-btn svelte-1lqo3oe" title="Prepopulate Network"><span class="svelte-1lqo3oe">🌐</span></button> <button class="admin-btn svelte-1lqo3oe" title="Clear Database"><span class="svelte-1lqo3oe">🗑️</span></button> <button class="admin-btn svelte-1lqo3oe" title="Create New Entity"><span class="svelte-1lqo3oe">➕</span></button> <button class="admin-btn admin-btn-tutorial svelte-1lqo3oe" title="Start Interactive Tutorial"><span class="svelte-1lqo3oe">🎯</span></button> <button class="admin-btn svelte-1lqo3oe" title="Add Entity Panel"><span class="svelte-1lqo3oe">📋</span></button> <button class="admin-btn svelte-1lqo3oe" title="Toggle theme"><span id="theme-icon" class="svelte-1lqo3oe"> </span></button> <button class="admin-btn svelte-1lqo3oe" title="Settings"><span class="svelte-1lqo3oe">⚙️</span></button> <button class="admin-btn svelte-1lqo3oe" title="Toggle Dropdown Mode"><span class="svelte-1lqo3oe">🔄</span></button></div></div> <!>  <!> <!>',1);function Un(s,t){Ke(t,!1);const[a,d]=Xt(),l=()=>Ge(zt,"$settings",a),c=()=>Ge(Ct,"$xlnEnvironment",a),u=()=>Ge(Ps,"$isActiveTutorial",a),b=()=>Ge(Ka,"$currentTutorial",a),r=()=>Ge(Ds,"$currentStep",a),g=re(),y=re(),m=re();let x=re(!1),k=re(!1),f=re(0);setInterval(()=>{h(f,Math.floor((1e3-Date.now()%1e3)/100)/10)},100);async function C(){try{console.log("🎯 Running XLN demo...");const ge=await St(),X=c()||await ge.main();console.log("🔍 Environment before demo:",{replicas:X?.replicas?.size||0,height:X?.height||0});const te=await ge.runDemo(X);if(console.log("🔍 Environment after demo:",{replicas:te?.replicas?.size||0,height:te?.height||0,entity1Reserves:te?.replicas?.get("0x0000000000000000000000000000000000000000000000000000000000000001:s1")?.state?.reserves?.size||0,entity2Reserves:te?.replicas?.get("0x0000000000000000000000000000000000000000000000000000000000000002:s2")?.state?.reserves?.size||0}),te?.replicas?.get("0x0000000000000000000000000000000000000000000000000000000000000001:s1")?.state?.reserves){const ke=te.replicas.get("0x0000000000000000000000000000000000000000000000000000000000000001:s1").state.reserves;console.log("🔍 Entity 1 reserves after demo:");for(const[Ae,Ne]of ke.entries())console.log(`  Token ${Ae}: ${Ne.toString()}`)}Ct.set(te),console.log("✅ Demo completed successfully"),console.log(`📸 History snapshots: ${te.history.length}`),console.log("🔍 Store updated, UI should refresh automatically")}catch(ge){console.error("❌ Demo failed:",ge),alert(`Demo failed: ${ge.message}`)}}async function w(){try{console.log("🌐 Starting XLN Prepopulation...");const ge=await St(),X=c()||await ge.main();console.log("🔍 Environment before prepopulation:",{replicas:X?.replicas?.size||0,height:X?.height||0}),await ge.prepopulate(X,ge.processUntilEmpty),console.log("🔍 Environment after prepopulation:",{replicas:X?.replicas?.size||0,height:X?.height||0,accounts:Array.from(X?.replicas?.values()||[]).map(te=>te.state?.accounts?.size||0).reduce((te,ke)=>te+ke,0)}),console.log("✅ Prepopulation completed successfully"),console.log("🔍 Store updated, UI should refresh automatically")}catch(ge){console.error("❌ Prepopulation failed:",ge),alert(`Prepopulation failed: ${ge.message}`)}}async function I(){if(confirm("Are you sure you want to clear the database? This will reset all data."))try{if(await(await St()).clearDatabaseAndHistory(),localStorage.clear(),sessionStorage.clear(),typeof indexedDB<"u"){const X=["db","level-js-db","level-db","xln-db"];for(const te of X)try{await new Promise((ke,Ae)=>{const Ne=indexedDB.deleteDatabase(te);Ne.onsuccess=()=>ke(),Ne.onerror=()=>Ae(Ne.error),Ne.onblocked=()=>ke()}),console.log(`✅ Cleared IndexedDB: ${te}`)}catch(ke){console.log(`⚠️ Could not clear IndexedDB: ${te}`,ke)}}console.log("✅ All storage cleared successfully"),window.location.reload()}catch(ge){console.error("❌ Clear database failed:",ge),alert(`Clear database failed: ${ge.message}`)}}function O(){alert("Entity Creator coming soon! Use the Controls section in any panel for now.")}function H(){h(k,!0)}function F(){Ha.toggleTheme()}function A(){h(x,!0)}function S(){h(x,!1)}function $(){Ha.toggleDropdownMode()}function J(){Ia.addTab()}function fe(ge){const X=ge.target;Ha.setServerDelay(parseInt(X.value))}Pe(()=>l(),()=>{h(g,l().theme==="dark"?"🌙":"☀️")}),Pe(()=>c(),()=>{h(y,c()?{block:Math.max(0,...Array.from(c().replicas?.values()||[]).map(X=>X.state?.jBlock||0)),events:c().serverInput?.entityInputs?.length||0,height:c().height||0}:{block:0,events:0,height:0})}),Pe(()=>c(),()=>{h(m,(()=>{if(!c())return null;try{return{proposers:Array.from(c().replicas?.entries()||[]).filter(([X,te])=>te.isProposer).map(([X,te])=>{const[ke,Ae]=X.split(":");return{entityId:ke.slice(0,10)+"...",signerId:Ae,jBlock:te.state.jBlock}}),nextSyncIn:Math.floor((1e3-Date.now()%1e3)/100)/10}}catch{return null}})())}),Ft(),ot();var ee=Rn(),L=Ce(ee),ve=n(L),P=o(n(ve),2),E=n(P),N=n(E);i(E);var K=o(E,2),be=n(K);i(K);var se=o(K,2),Z=n(se);i(se);var R=o(se,2);{var q=ge=>{var X=Fn(),te=n(X);i(X),W((ke,Ae)=>M(te,`🔄 Proposers: ${ke??""} | Next: ${Ae??""}s`),[()=>(e(m),v(()=>e(m).proposers.map(ke=>`${ke.signerId}@${ke.jBlock}`).join(", "))),()=>(e(f),v(()=>e(f).toFixed(1)))]),p(ge,X)};B(R,ge=>{e(m),v(()=>e(m)&&e(m).proposers.length>0)&&ge(q)})}var ce=o(R,2),me=n(ce),$e=n(me);i(me);var je=o(me,2);ft(je),i(ce),i(P),i(ve);var ae=o(ve,4),V=n(ae),U=o(V,2),ie=o(U,2),pe=o(ie,2),we=o(pe,2),G=o(we,2),de=o(G,2),Se=n(de),le=n(Se,!0);i(Se),i(de);var ne=o(de,2),Ie=o(ne,2);i(ae),i(L);var D=o(L,2);{var _=ge=>{var X=qn(),te=n(X),ke=n(te),Ae=o(n(ke),2);i(ke);var Ne=o(ke,2),Ve=n(Ne),Q=o(n(Ve),2),oe=n(Q);ft(oe),Et(2),i(Q),Et(2),i(Ve);var xe=o(Ve,2),Te=o(n(xe),2),_e=n(Te);ft(_e);var Ee=o(_e,2),Me=n(Ee),et=n(Me,!0);i(Me),Et(),i(Ee),i(Te),i(xe),i(Ne),i(te),i(X),W(()=>{mi(oe,(l(),v(()=>l().dropdownMode==="entity-first"))),Fs(_e,(l(),v(()=>l().serverDelay))),M(et,(l(),v(()=>l().serverDelay)))}),ue("click",Ae,S),ue("change",oe,$),ue("input",_e,fe),ue("click",te,wi(function(it){qs.call(this,t,it)})),ue("click",X,S),p(ge,X)};B(D,ge=>{e(x)&&ge(_)})}var he=o(D,2);Cn(he,{get isVisible(){return e(k)},set isVisible(ge){h(k,ge)},$$legacy:!0});var De=o(he,2);{var Le=ge=>{{let X=Ot(()=>[r()]);Nn(ge,{get isVisible(){return u()},currentStep:0,get totalSteps(){return b(),v(()=>b().steps.length)},get tutorialData(){return e(X)}})}};B(De,ge=>{u()&&b()&&r()&&ge(Le)})}W(()=>{M(N,`🔭 J-Block: ${e(y),v(()=>e(y).block)??""}`),M(be,`⚡ J-Events: ${e(y),v(()=>e(y).events)??""}`),M(Z,`📊 S-Block: ${e(y),v(()=>e(y).height)??""}`),M($e,`📊 Scale: $${l(),v(()=>l().portfolioScale)??""}`),M(le,e(g))}),wt(je,()=>l().portfolioScale,ge=>nn(zt,v(l).portfolioScale=ge,v(l))),ue("input",je,ge=>Ha.setPortfolioScale(Number(ge.target.value))),ue("click",V,C),ue("click",U,w),ue("click",ie,I),ue("click",pe,O),ue("click",we,H),ue("click",G,J),ue("click",de,F),ue("click",ne,A),ue("click",Ie,$),p(s,ee),Ze(),d()}var Bn=T('<div class="time-machine svelte-1gai71c"><div class="time-machine-main svelte-1gai71c"><div><span> </span> <span> </span> <span> </span></div> <div class="time-nav-controls svelte-1gai71c"><button class="time-btn-compact svelte-1gai71c" title="Step Back (← arrow)">⏪</button> <button class="time-btn-compact svelte-1gai71c" title="Step Forward (→ arrow)">⏩</button> <button class="time-btn-compact live svelte-1gai71c" title="Go to Current (End key)">⚡ LIVE</button></div> <div class="time-utility-controls svelte-1gai71c"><button class="time-btn-mini svelte-1gai71c" title="Go to Start (Home key)">⏮️</button></div></div> <div class="time-slider-container svelte-1gai71c"><input type="range" id="timeSlider" class="time-slider svelte-1gai71c" min="0"/></div></div>');function Hn(s,t){Ke(t,!1);const[a,d]=Xt(),l=()=>Ge(Mt,"$timeState",a),c=()=>Ge(ha,"$history",a),u=()=>Ge(xi,"$currentHeight",a),b=re(),r=re(),g=re();function y(q,ce){if(q.isLive)return{status:"⚡ LIVE",description:"Current time",frameInfo:`Height: ${u()}`,totalFrames:`${ce.length} snapshots`};{const me=Sa.getCurrentSnapshot();return{status:`📸 ${q.currentTimeIndex+1}/${ce.length}`,description:me?.description||"Historical snapshot",frameInfo:`Height: ${me?.height||0}`,totalFrames:me?.description||""}}}function m(q,ce){return q.isLive?q.maxTimeIndex+1:q.currentTimeIndex}function x(q,ce){if(q.isLive)return 100;const me=q.maxTimeIndex+1;return me>0?q.currentTimeIndex/me*100:0}function k(q){const ce=q.target,me=parseInt(ce.value),$e=l().maxTimeIndex;me>$e?Sa.goToLive():Sa.goToTimeIndex(me)}function f(){Sa.stepBackward()}function C(){Sa.stepForward()}function w(){Sa.goToHistoryStart()}function I(){Sa.goToLive()}function O(q){if(!(q.target&&q.target.tagName==="INPUT")&&!(q.target&&q.target.tagName==="TEXTAREA"))switch(q.key){case"ArrowLeft":q.preventDefault(),f();break;case"ArrowRight":q.preventDefault(),C();break;case"Home":q.preventDefault(),w();break;case"End":q.preventDefault(),I();break}}Pe(()=>(l(),c()),()=>{h(b,y(l(),c()))}),Pe(()=>(l(),c()),()=>{h(r,m(l(),c()))}),Pe(()=>(l(),c()),()=>{h(g,x(l(),c()))}),Ft(),ot();var H=Bn();ue("keydown",rs,O);var F=n(H),A=n(F);let S;var $=n(A),J=n($,!0);i($);var fe=o($,2),ee=n(fe,!0);i(fe);var L=o(fe,2),ve=n(L,!0);i(L),i(A);var P=o(A,2),E=n(P),N=o(E,2),K=o(N,2);i(P);var be=o(P,2),se=n(be);i(be),i(F);var Z=o(F,2),R=n(Z);ft(R),i(Z),i(H),W(q=>{S=He(A,1,"time-info-compact svelte-1gai71c",null,S,q),M(J,(e(b),v(()=>e(b).status))),M(ee,(e(b),v(()=>e(b).frameInfo))),M(ve,(e(b),v(()=>e(b).totalFrames))),vt(Z,`--progress: ${e(g)??""}%`),qe(R,"max",(l(),v(()=>l().maxTimeIndex+1))),Fs(R,e(r)),R.disabled=(c(),v(()=>c().length===0))},[()=>({current:l().isLive})]),ue("click",E,f),ue("click",N,C),ue("click",K,I),ue("click",se,w),ue("input",R,k),p(s,H),Ze(),d()}function We(s){if(!s||s==="0x"||s==="0x0")return 0;try{const t=parseInt(s,16);return isNaN(t)?0:t}catch{return 0}}function Vn(s){const t=We(s);return t>0?`${t}`:"Unknown"}var Jn=T('<div><button class="unified-dropdown-btn svelte-jommf9" style="width: 100%;"><span class="dropdown-icon svelte-jommf9">🏛️</span> <span class="dropdown-text svelte-jommf9"> </span> <span class="dropdown-arrow svelte-jommf9">▼</span></button> <div></div></div>');function Wn(s,t){Ke(t,!1);const[a,d]=Xt(),l=()=>Ge(vs,"$replicas",a),c=()=>Ge(zt,"$settings",a),u=()=>Ge(ki,"$visibleReplicas",a),b=re();let r=Y(t,"tab",8);const g=Pa();let y=re(!1),m=re();function x(P){if(P.entityId&&P.signer&&P.jurisdiction){const E=We(P.entityId);return`${P.jurisdiction} → ${P.signer} → Entity #${E}`}else return P.signer&&P.jurisdiction?`${P.jurisdiction} → ${P.signer} → Select Entity`:P.jurisdiction?`${P.jurisdiction} → Select Signer → Entity`:"Select Jurisdiction → Signer → Entity"}function k(){h(y,!e(y)),e(y)&&f()}function f(){if(!e(m))return;Dt(m,e(m).innerHTML=`
      <div class="dropdown-search-container">
        <input type="text" class="dropdown-search-input" placeholder="🔍 Search jurisdictions, signers, entities..." />
      </div>
      <div class="dropdown-results" id="dropdownResults">
        <!-- Results will be populated here -->
      </div>
    `);const P=e(m).querySelector(".dropdown-search-input"),E=e(m).querySelector(".dropdown-results");P&&(P.addEventListener("input",N=>{const K=N.target;C(E,K.value)}),P.addEventListener("click",N=>{N.stopPropagation()})),C(E,"")}function C(P,E){if(!P)return;P.innerHTML="",console.log(`🔍 EntityDropdown: Total replicas available: ${l().size}`),console.log("🔍 EntityDropdown: Replica keys:",Array.from(l().keys()));const N=[{name:"All Entities",id:"all"}];c().dropdownMode==="signer-first"?w(N,P,E):I(N,P,E)}function w(P,E,N){P.forEach((K,be)=>{const se=Array.from(l().values());if(se.length===0)return;const Z={};se.forEach(ce=>{const me=ce.signerId;Z[me]||(Z[me]=[]),Z[me].push(ce)});const R=O(`📊 ${K.name}`,"",0,!1,!1,N);E.appendChild(R);const q=Object.keys(Z);q.forEach((ce,me)=>{const $e=Z[ce],je=me===q.length-1,ae=O(`👤 ${ce}`,"",1,!1,je,N);E.appendChild(ae),$e.forEach((V,U)=>{const ie=U===$e.length-1,we=`Entity #${We(V.entityId)}`,G=O(`🏢 ${we}`,`${K.name}:${ce}:${V.entityId}`,2,!0,ie&&je,N);G.addEventListener("click",()=>F(K.name,ce,V.entityId)),E.appendChild(G)})})})}function I(P,E,N){P.forEach((K,be)=>{const se=u()||l(),Z=Array.from(se.values());if(console.log(`🔍 EntityDropdown: ${K.name} has ${Z.length} replicas`),Z.forEach(me=>{console.log(`  📋 Entity: #${We(me.entityId)} (${me.signerId})`)}),Z.length===0)return;const R={};Z.forEach(me=>{const $e=me.entityId;R[$e]||(R[$e]=[]),R[$e].push(me)});const q=O(`📊 ${K.name}`,"",0,!1,!1,N);E.appendChild(q);const ce=Object.keys(R);ce.forEach((me,$e)=>{const je=R[me],ae=$e===ce.length-1,U=`Entity #${We(me)}`,ie=O(`🏢 ${U}`,"",1,!1,ae,N);E.appendChild(ie),je.forEach((pe,we)=>{const G=we===je.length-1,de=O(`👤 ${pe.signerId}`,`${K.name}:${pe.signerId}:${pe.entityId}`,2,!0,G&&ae,N);de.addEventListener("click",()=>F(K.name,pe.signerId,pe.entityId)),E.appendChild(de)})})})}function O(P,E,N,K,be,se){const Z=document.createElement("div");Z.className=`dropdown-item ${N>0?`indent-${N}`:""}`;let R="";return N===1?R="├─ ":N===2&&(R="│  └─ "),Z.innerHTML=`
      <span class="tree-prefix" style="color: #666; font-family: monospace;">${R}</span>
      <span class="item-text">${P}</span>
    `,K?(Z.style.cursor="pointer",Z.dataset.value=E):(Z.style.cursor="default",Z.style.color="#9d9d9d"),se&&P.toLowerCase().includes(se.toLowerCase())&&H(Z,se),Z}function H(P,E){const N=P.querySelector(".item-text");if(N&&E){const K=N.textContent||"",be=new RegExp(`(${E})`,"gi");N.innerHTML=K.replace(be,'<mark style="background: #ffd700; color: #000; padding: 2px;">$1</mark>')}}function F(P,E,N){g("entitySelect",{jurisdiction:P,signer:E,entityId:N}),h(y,!1)}function A(P){P.target.closest(".unified-dropdown")||h(y,!1)}Pe(()=>z(r()),()=>{h(b,x(r()))}),Ft(),ot();var S=Jn();ue("click",rs,A);let $;var J=n(S),fe=o(n(J),2),ee=n(fe,!0);i(fe),Et(2),i(J);var L=o(J,2);let ve;wa(L,P=>h(m,P),()=>e(m)),i(S),W((P,E)=>{$=He(S,1,"unified-dropdown svelte-jommf9",null,$,P),M(ee,e(b)),ve=He(L,1,"unified-dropdown-content svelte-jommf9",null,ve,E)},[()=>({open:e(y)}),()=>({show:e(y)})]),ue("click",J,k),p(s,S),Ze(),d()}var Xn=T('<div><button class="unified-dropdown-btn svelte-189xybw" style="width: 100%;"><span class="dropdown-icon svelte-189xybw">📋</span> <span class="dropdown-text svelte-189xybw"> </span> <span class="dropdown-arrow svelte-189xybw">▼</span></button> <div></div></div>');function Gn(s,t){Ke(t,!1);const a=re(),d=re();let l=Y(t,"replica",8);const c=Pa();let u=re(!1),b=re();function r(){h(u,!e(u)),e(u)&&g()}function g(){if(!e(b))return;Dt(b,e(b).innerHTML=`
      <div class="dropdown-search-container">
        <input type="text" class="dropdown-search-input" placeholder="🔍 Search accounts..." />
      </div>
      <div class="dropdown-results" id="dropdownResults">
        <!-- Results will be populated here -->
      </div>
    `);const A=e(b).querySelector(".dropdown-search-input"),S=e(b).querySelector("#dropdownResults");A&&S&&(y(""),A.addEventListener("input",$=>{const J=$.target;y(J.value)}))}function y(A){const S=e(b).querySelector("#dropdownResults");if(!S)return;const $=e(a).filter(J=>J.displayName.toLowerCase().includes(A.toLowerCase())||J.entityId.toLowerCase().includes(A.toLowerCase()));if($.length===0){S.innerHTML='<div class="dropdown-no-results">No accounts found</div>';return}S.innerHTML=$.map(J=>{const fe=x(J.account);return`
        <div class="dropdown-option" data-entity-id="${J.entityId}">
          <div class="option-content">
            <div class="option-main">
              <span class="option-icon">🏢</span>
              <span class="option-text">${J.displayName}</span>
            </div>
            <div class="option-details">
              <span class="account-status ${fe.status.toLowerCase()}">${fe.status}</span>
              <small>${fe.tokenCount} tokens • Frame #${J.account.currentFrame?.frameId||0}</small>
            </div>
          </div>
        </div>
      `}).join(""),S.querySelectorAll(".dropdown-option").forEach(J=>{J.addEventListener("click",()=>{const fe=J.dataset.entityId;fe&&m(fe,e(a).find(ee=>ee.entityId===fe)?.account)})})}function m(A,S){h(u,!1),c("accountSelect",{entityId:A,account:S})}function x(A){const S=A.deltas?A.deltas.size:0,$=A.mempool?A.mempool.length:0,J=$>0?"Pending":"Synced";return{tokenCount:S,mempoolSize:$,status:J}}function k(A){A.target.closest(".unified-dropdown")||h(u,!1)}Pe(()=>(z(l()),We),()=>{h(a,l()?.state?.accounts?Array.from(l().state.accounts.entries()).map(([A,S])=>({entityId:A,entityNumber:We(A),displayName:`Entity #${We(A)}`,account:S})):[])}),Pe(()=>(z(l()),e(a)),()=>{console.log(`🔍 AccountDropdown: replica exists: ${!!l()}`),console.log(`🔍 AccountDropdown: replica.state exists: ${!!l()?.state}`),console.log(`🔍 AccountDropdown: replica.state.accounts exists: ${!!l()?.state?.accounts}`),l()?.state?.accounts&&(console.log(`🔍 AccountDropdown: accounts size: ${l().state.accounts.size}`),console.log("🔍 AccountDropdown: account keys:",Array.from(l().state.accounts.keys()))),console.log(`🔍 AccountDropdown: availableAccounts length: ${e(a).length}`)}),Pe(()=>e(a),()=>{h(d,e(a).length>0?`📋 Accounts (${e(a).length})`:"📋 No Accounts")}),Pe(()=>e(u),()=>{typeof window<"u"&&(e(u)?window.addEventListener("click",k):window.removeEventListener("click",k))}),Ft(),ot();var f=Xn();let C;var w=n(f),I=o(n(w),2),O=n(I,!0);i(I),Et(2),i(w);var H=o(w,2);let F;wa(H,A=>h(b,A),()=>e(b)),i(f),W((A,S)=>{C=He(f,1,"unified-dropdown svelte-189xybw",null,C,A),w.disabled=(e(a),v(()=>e(a).length===0)),M(O,e(d)),F=He(H,1,"unified-dropdown-content svelte-189xybw",null,F,S)},[()=>({open:e(u)}),()=>({show:e(u)})]),ue("click",w,r),p(s,f),Ze()}var Yn=T('<div class="entity-profile svelte-18sk6vh"><div class="profile-info svelte-18sk6vh"><div class="profile-name svelte-18sk6vh"> </div> <div class="profile-details svelte-18sk6vh"> </div></div></div>'),Kn=T('<div class="empty-state svelte-18sk6vh">- select entity to view profile</div>'),Zn=T('<div class="entity-profile-section svelte-18sk6vh"><!></div>');function Qn(s,t){Ke(t,!1);let a=Y(t,"replica",8);Y(t,"tab",8),ot();var d=Zn(),l=n(d);{var c=b=>{var r=Yn(),g=n(r),y=n(g),m=n(y);i(y);var x=o(y,2),k=n(x);i(x),i(g),i(r),W(f=>{M(m,`Entity #${f??""}`),M(k,`Signer: ${z(a()),v(()=>a().signerId)??""}`)},[()=>(z(We),z(a()),v(()=>We(a().entityId)))]),p(b,r)},u=b=>{var r=Kn();p(b,r)};B(l,b=>{a()?b(c):b(u,!1)})}i(d),p(s,d),Ze()}var eo=T('<div class="consensus-item svelte-eq2k0o"><span class="consensus-label svelte-eq2k0o">Status:</span> <span class="consensus-value consensus-status-unlocked svelte-eq2k0o">🔓 Unlocked</span></div> <div class="consensus-item svelte-eq2k0o"><span class="consensus-label svelte-eq2k0o">Role:</span> <span class="consensus-value svelte-eq2k0o">👁️ Validator</span></div> <div class="consensus-item svelte-eq2k0o"><span class="consensus-label svelte-eq2k0o">Frame Height:</span> <span class="consensus-value svelte-eq2k0o"> </span></div> <div class="consensus-item svelte-eq2k0o"><span class="consensus-label svelte-eq2k0o">J-Block:</span> <span class="consensus-value consensus-jblock svelte-eq2k0o"> </span></div> <div class="consensus-item svelte-eq2k0o"><span class="consensus-label svelte-eq2k0o">Messages:</span> <span class="consensus-value svelte-eq2k0o"> </span></div> <div class="consensus-item svelte-eq2k0o"><span class="consensus-label svelte-eq2k0o">Proposals:</span> <span class="consensus-value svelte-eq2k0o"> </span></div>',1),to=T('<div class="empty-state svelte-eq2k0o">- select entity to view consensus state</div>'),ao=T('<div class="consensus-state svelte-eq2k0o"><!></div>');function so(s,t){Ke(t,!1);let a=Y(t,"replica",8);ot();var d=ao(),l=n(d);{var c=b=>{var r=eo(),g=o(Ce(r),4),y=o(n(g),2),m=n(y,!0);i(y),i(g);var x=o(g,2),k=o(n(x),2),f=n(k);i(k),i(x);var C=o(x,2),w=o(n(C),2),I=n(w,!0);i(w),i(C);var O=o(C,2),H=o(n(O),2),F=n(H,!0);i(H),i(O),W(()=>{M(m,(z(a()),v(()=>a().state?.height||0))),M(f,`🔭 ${z(a()),v(()=>a().state?.jBlock||0)??""}`),M(I,(z(a()),v(()=>a().state?.messages?.length||0))),M(F,(z(a()),v(()=>a().state?.proposals?.size||0)))}),p(b,r)},u=b=>{var r=to();p(b,r)};B(l,b=>{a()?b(c):b(u,!1)})}i(d),p(s,d),Ze()}var io=T('<div class="time-machine-indicator svelte-1c0y46i">🕰️ Viewing historical state - auto-scroll disabled</div>'),no=T('<span class="event-type svelte-1c0y46i">J-EVENT</span>'),oo=T('<span class="event-type svelte-1c0y46i">RESERVE</span>'),ro=T('<span class="detail-item svelte-1c0y46i"> </span>'),lo=T('<span class="detail-item svelte-1c0y46i"> </span>'),co=T('<span class="detail-item svelte-1c0y46i"> </span>'),vo=T('<span class="detail-item svelte-1c0y46i"> </span>'),uo=T('<div class="event-details svelte-1c0y46i"><!> <!> <!> <!></div>'),po=T('<div><div class="chat-meta svelte-1c0y46i"><span class="message-number svelte-1c0y46i"></span> <span class="signer-id svelte-1c0y46i"> </span> <!></div> <div class="chat-content svelte-1c0y46i"><div class="main-content svelte-1c0y46i"> </div> <!></div></div>'),fo=T('<div class="empty-state svelte-1c0y46i">- no messages</div>'),mo=T('<div class="scrollable-component chat-messages svelte-1c0y46i"><!> <!></div>');function ho(s,t){Ke(t,!1);let a=Y(t,"replica",8),d=Y(t,"tab",8),l=Y(t,"currentTimeIndex",24,()=>-1),c=re(),u=!0,b=0,r=re(!0);$i(()=>{if(a()?.state?.messages&&e(c)&&u&&e(r)){const I=a().state.messages.length;I>b&&(Dt(c,e(c).scrollTop=e(c).scrollHeight),b=I)}});function g(){if(!e(c))return;const{scrollTop:I,scrollHeight:O,clientHeight:H}=e(c);u=Math.abs(O-H-I)<10}function y(I){if(I.includes("observed j-event:")){const O=I.match(/(\w+) observed j-event: (\w+) \(block (\d+), tx (0x\w+)\)/);if(O){const[,H,F,A,S]=O;return{type:"j-event",content:`${H} observed J-event: ${F}`,details:{block:A,tx:S.slice(0,10)+"..."}}}}if(I.includes("Reserve updated")){const O=I.match(/Reserve updated for (.+?): Token (\d+) new balance is (.+)/);if(O){const[,H,F,A]=O;return{type:"reserve-update",content:`Reserve Updated: Token ${F}`,details:{entity:H.slice(0,10)+"...",balance:(Number(A)/1e18).toFixed(4)+" ETH"}}}}return{type:"message",content:I,details:null}}ga(()=>{a()?.state?.messages&&(b=a().state.messages.length)}),Pe(()=>z(l()),()=>{h(r,l()===-1)}),Ft(),ot();var m=mo(),x=n(m);{var k=I=>{var O=io();p(I,O)};B(x,I=>{e(r)||I(k)})}var f=o(x,2);{var C=I=>{var O=ze(),H=Ce(O);Je(H,1,()=>(z(a()),v(()=>a().state.messages)),nt,(F,A,S)=>{const $=Ot(()=>(e(A),v(()=>y(e(A)))));var J=po();let fe;var ee=n(J),L=n(ee);L.textContent=`#${S+1}`;var ve=o(L,2),P=n(ve,!0);i(ve);var E=o(ve,2);{var N=ce=>{var me=no();p(ce,me)},K=ce=>{var me=ze(),$e=Ce(me);{var je=ae=>{var V=oo();p(ae,V)};B($e,ae=>{z(e($)),v(()=>e($).type==="reserve-update")&&ae(je)},!0)}p(ce,me)};B(E,ce=>{z(e($)),v(()=>e($).type==="j-event")?ce(N):ce(K,!1)})}i(ee);var be=o(ee,2),se=n(be),Z=n(se,!0);i(se);var R=o(se,2);{var q=ce=>{var me=uo(),$e=n(me);{var je=G=>{var de=ro(),Se=n(de);i(de),W(()=>M(Se,`Block: ${z(e($)),v(()=>e($).details.block)??""}`)),p(G,de)};B($e,G=>{z(e($)),v(()=>e($).details.block)&&G(je)})}var ae=o($e,2);{var V=G=>{var de=lo(),Se=n(de);i(de),W(()=>M(Se,`Tx: ${z(e($)),v(()=>e($).details.tx)??""}`)),p(G,de)};B(ae,G=>{z(e($)),v(()=>e($).details.tx)&&G(V)})}var U=o(ae,2);{var ie=G=>{var de=co(),Se=n(de);i(de),W(()=>M(Se,`Entity: ${z(e($)),v(()=>e($).details.entity)??""}`)),p(G,de)};B(U,G=>{z(e($)),v(()=>e($).details.entity)&&G(ie)})}var pe=o(U,2);{var we=G=>{var de=vo(),Se=n(de);i(de),W(()=>M(Se,`Balance: ${z(e($)),v(()=>e($).details.balance)??""}`)),p(G,de)};B(pe,G=>{z(e($)),v(()=>e($).details.balance)&&G(we)})}i(me),p(ce,me)};B(R,ce=>{z(e($)),v(()=>e($).details)&&ce(q)})}i(be),i(J),W(ce=>{fe=He(J,1,"chat-message svelte-1c0y46i",null,fe,ce),M(P,(z(a()),v(()=>a().signerId))),M(Z,(z(e($)),v(()=>e($).content)))},[()=>({"j-event":e($).type==="j-event","reserve-update":e($).type==="reserve-update"})]),p(F,J)}),p(I,O)},w=I=>{var O=fo();p(I,O)};B(f,I=>{z(a()),v(()=>a()&&a().state?.messages?.length>0)?I(C):I(w,!1)})}i(m),wa(m,I=>h(c,I),()=>e(c)),W(()=>qe(m,"id",`chat-content-${z(d()),v(()=>d().id)??""}`)),ue("scroll",m,g),p(s,m),Ze()}var go=T('<span class="needs-votes svelte-1i7x9uv"> </span>'),yo=T('<span class="vote-comment svelte-1i7x9uv"> </span>'),bo=T('<div class="vote-item svelte-1i7x9uv"><span class="voter svelte-1i7x9uv"> </span> <span> </span> <!></div>'),_o=T('<div class="vote-details svelte-1i7x9uv"></div>'),wo=T('<div class="proposal-item svelte-1i7x9uv"><div class="proposal-header svelte-1i7x9uv"><div class="proposal-title svelte-1i7x9uv"> </div> <div> </div></div> <div class="proposal-meta svelte-1i7x9uv"><span> </span></div> <div class="voting-info svelte-1i7x9uv"><div class="vote-counts svelte-1i7x9uv"><span class="vote-yes svelte-1i7x9uv"> </span> <span class="vote-no svelte-1i7x9uv"> </span> <span class="vote-abstain svelte-1i7x9uv"> </span></div> <div class="threshold-info svelte-1i7x9uv"><span> </span> <!></div></div> <!></div>'),xo=T('<div class="empty-state svelte-1i7x9uv">- no proposals</div>'),ko=T('<div class="scrollable-component proposals-list svelte-1i7x9uv"><!></div>');function So(s,t){Ke(t,!1);let a=Y(t,"replica",8);Y(t,"tab",8);function d(y){return typeof y=="bigint"?Number(y):typeof y=="number"?y:parseInt(y)||0}function l(y){return typeof y=="object"&&y.choice?y.choice:y===!0?"yes":y===!1?"no":y}function c(y,m){const x=y.votes?Array.from(y.votes.entries()):[],k=x.filter(([F,A])=>l(A)==="yes"),f=x.filter(([F,A])=>l(A)==="no"),C=x.filter(([F,A])=>l(A)==="abstain"),w=d(m?.threshold||1),I=m?.shares||{},O=k.reduce((F,[A,S])=>{const $=d(I[A]||0);return F+$},0),H=O>=w?"APPROVED":"PENDING";return{yesCount:k.length,noCount:f.length,abstainCount:C.length,yesVotingPower:O,threshold:w,status:H,votes:x}}ot();var u=ko(),b=n(u);{var r=y=>{var m=ze(),x=Ce(m);Je(x,1,()=>(z(a()),v(()=>Array.from(a().state.proposals.entries()))),nt,(k,f)=>{var C=bt(()=>ls(e(f),2));let w=()=>e(C)[1];const I=Ot(()=>(w(),z(a()),v(()=>c(w(),a().state?.config))));var O=wo(),H=n(O),F=n(H),A=n(F,!0);i(F);var S=o(F,2);let $;var J=n(S,!0);i(S),i(H);var fe=o(H,2),ee=n(fe),L=n(ee);i(ee),i(fe);var ve=o(fe,2),P=n(ve),E=n(P),N=n(E);i(E);var K=o(E,2),be=n(K);i(K);var se=o(K,2),Z=n(se);i(se),i(P);var R=o(P,2),q=n(R),ce=n(q);i(q);var me=o(q,2);{var $e=V=>{var U=go(),ie=n(U);i(U),W(()=>M(ie,`(${z(e(I)),v(()=>e(I).threshold-e(I).yesVotingPower)??""} more needed)`)),p(V,U)};B(me,V=>{z(e(I)),v(()=>e(I).status==="PENDING")&&V($e)})}i(R),i(ve);var je=o(ve,2);{var ae=V=>{var U=_o();Je(U,5,()=>(z(e(I)),v(()=>e(I).votes)),nt,(ie,pe)=>{var we=bt(()=>ls(e(pe),2));let G=()=>e(we)[0],de=()=>e(we)[1];const Se=Ot(()=>(de(),v(()=>l(de()))));var le=bo(),ne=n(le),Ie=n(ne);i(ne);var D=o(ne,2);let _;var he=n(D,!0);i(D);var De=o(D,2);{var Le=ge=>{var X=yo(),te=n(X);i(X),W(()=>M(te,`"${de(),v(()=>de().comment)??""}"`)),p(ge,X)};B(De,ge=>{de(),v(()=>typeof de()=="object"&&de().comment)&&ge(Le)})}i(le),W((ge,X)=>{M(Ie,`${G()??""}:`),_=He(D,1,"choice svelte-1i7x9uv",null,_,ge),M(he,X)},[()=>({yes:e(Se)==="yes",no:e(Se)==="no",abstain:e(Se)==="abstain"}),()=>(z(e(Se)),v(()=>e(Se).toUpperCase()))]),p(ie,le)}),i(U),p(V,U)};B(je,V=>{z(e(I)),v(()=>e(I).votes.length>0)&&V(ae)})}i(O),W(V=>{M(A,(w(),v(()=>w().action?.data?.message||"Unknown proposal"))),$=He(S,1,"proposal-status svelte-1i7x9uv",null,$,V),M(J,(z(e(I)),v(()=>e(I).status))),M(L,`By: ${w(),v(()=>w().proposer||"Unknown")??""}`),M(N,`✅ ${z(e(I)),v(()=>e(I).yesCount)??""} yes`),M(be,`❌ ${z(e(I)),v(()=>e(I).noCount)??""} no`),M(Z,`⚪ ${z(e(I)),v(()=>e(I).abstainCount)??""} abstain`),M(ce,`Voting Power: ${z(e(I)),v(()=>e(I).yesVotingPower)??""}/${z(e(I)),v(()=>e(I).threshold)??""}`)},[()=>({approved:e(I).status==="APPROVED"})]),p(k,O)}),p(y,m)},g=y=>{var m=xo();p(y,m)};B(b,y=>{z(a()),v(()=>a()&&a().state?.proposals?.size>0)?y(r):y(g,!1)})}i(u),p(s,u),Ze()}function Zs(s){return new Date(s).toLocaleTimeString()}function To(s,t){return console.log("🔍 [ServerFrameProcessor] getServerFrames called:",{historyLength:s?.length||0,historyExists:!!s,replicaExists:!!t,replicaId:t?.signerId+":"+t?.entityId}),!s||s.length===0?(console.log("❌ [ServerFrameProcessor] No server history available:",{history:s,historyLength:s?.length}),[]):t?(console.log(`🗂️ [ServerFrameProcessor] Processing history for replica ${t.signerId}:${t.entityId}, total frames: ${s.length}`),console.log("🗂️ [ServerFrameProcessor] First few snapshots:",s.slice(0,3).map((a,d)=>({frame:d,keys:Object.keys(a),serverInput:a.serverInput?Object.keys(a.serverInput):"missing",entityInputsCount:a.serverInput?.entityInputs?.length||0,serverOutputsCount:a.serverOutputs?.length||0,timestamp:a.timestamp}))),s.map((a,d)=>{const l=a.serverInput?.entityInputs||[],c=a.serverOutputs||[],u=l.filter(x=>x.entityId===t.entityId&&x.signerId===t.signerId),b=c.filter(x=>x.entityId===t.entityId&&x.signerId===t.signerId),r=a.serverInput?.serverTxs||[],g=r.filter(x=>x.type==="importReplica"?x.entityId===t.entityId&&x.data?.signerId===t.signerId:!1),y=r.filter(x=>x.entityId===t.entityId||x.data?.from===t.signerId),m=u.length>0||b.length>0||g.length>0;return{frameIndex:d,snapshot:a,inputs:u,outputs:b,imports:g,serverTxs:y,timestamp:a.timestamp||Date.now()-(s.length-d)*1e3,hasActivity:m}})):(console.log("❌ [ServerFrameProcessor] No replica provided"),[])}function Si(s,t=50){try{const a=typeof s=="string"?s:JSON.stringify(s);return a.length>t?a.slice(0,t)+"...":a}catch{return"[object]"}}function Qs(s){let t="Entity Input",a="",d="";if(s.entityTxs&&s.entityTxs.length>0)if(s.entityTxs.length===1){const l=s.entityTxs[0];l.type==="chat"?(t="💬 Chat Message",a=`"${l.data.message}" from ${l.data.from}`):l.type==="propose"?(t="📝 Proposal",a=`${l.data.action?.data?.message||"New proposal"} by ${l.data.proposer}`):l.type==="vote"?(t="🗳️ Vote",a=`${l.data.choice} on ${l.data.proposalId?.slice(0,8)}... from ${l.data.voter||"unknown"}`):(t=`⚙️ ${l.type}`,a=Si(l.data,40))}else t=`📦 ${s.entityTxs.length} Transactions`,a=`Types: ${s.entityTxs.map(c=>c.type).join(", ")}`,d=`${s.entityTxs.length} txs`;if(s.precommits&&s.precommits.size>0){const l=Array.from(s.precommits.keys()).join(", ");t==="Entity Input"?(t="🔐 Precommits",a=`${s.precommits.size} signatures from ${l}`):d=`${s.precommits.size} precommits`}return s.proposedFrame&&t==="Entity Input"&&(t="📋 Frame Proposal",a=`${s.proposedFrame.hash?.slice(0,12)}... from ${s.signerId}`),{type:"input",icon:"📥",primaryInfo:t,secondaryInfo:a,amount:d}}function ei(s){let t="Entity Output",a="",d="";if(s.entityTxs&&s.entityTxs.length>0)if(s.entityTxs.length===1){const l=s.entityTxs[0],c=s.destinations?.join(", ")||"network";l.type==="chat"?(t="💬 Chat Sent",a=`"${l.data.message}" to ${c}`):l.type==="propose"?(t="📝 Proposal Sent",a=`${l.data.action?.data?.message||"New proposal"} to ${c}`):l.type==="vote"?(t="🗳️ Vote Sent",a=`${l.data.choice} on ${l.data.proposalId?.slice(0,8)}... to ${c}`):(t=`⚙️ ${l.type} Sent`,a=`${Si(l.data,30)} to ${c}`)}else{t=`📦 ${s.entityTxs.length} Transactions Sent`;const l=s.entityTxs.map(u=>u.type).join(", "),c=s.destinations?.join(", ")||"network";a=`Types: ${l} to ${c}`,d=`${s.entityTxs.length} txs`}return s.precommits&&s.precommits.size>0&&(t==="Entity Output"?(t="🔐 Precommits Sent",a=`${s.precommits.size} signatures to ${s.destinations?.join(", ")||"validators"}`):d=`${s.precommits.size} precommits`),s.proposedFrame&&t==="Entity Output"&&(t="📋 Frame Sent",a=`${s.proposedFrame.hash?.slice(0,12)}... to ${s.destinations?.join(", ")||"network"}`),{type:"output",icon:"📤",primaryInfo:t,secondaryInfo:a,amount:d}}function ti(s){let t="🔄 Replica Import",a="Imported from server",d="";return s.type==="importReplica"&&(t="🔄 Replica Import",a=`Server imported ${s.data?.signerId} (proposer: ${s.data?.isProposer?"Yes":"No"})`,d="IMPORT"),{type:"import",icon:"🔄",primaryInfo:t,secondaryInfo:a,amount:d}}var Io=T('<div><div class="transaction-icon svelte-tiqhhw"> </div> <div class="transaction-details svelte-tiqhhw"><div class="transaction-primary svelte-tiqhhw"> </div> <div class="transaction-secondary svelte-tiqhhw"> </div></div> <div class="transaction-amount svelte-tiqhhw"> </div></div>');function ks(s,t){Ke(t,!1);let a=Y(t,"transaction",8);ot();var d=Io(),l=n(d),c=n(l,!0);i(l);var u=o(l,2),b=n(u),r=n(b,!0);i(b);var g=o(b,2),y=n(g,!0);i(g),i(u);var m=o(u,2),x=n(m,!0);i(m),i(d),W(()=>{He(d,1,`banking-transaction-item banking-${z(a()),v(()=>a().type)??""}`,"svelte-tiqhhw"),M(c,(z(a()),v(()=>a().icon))),M(r,(z(a()),v(()=>a().primaryInfo))),M(y,(z(a()),v(()=>a().secondaryInfo))),M(x,(z(a()),v(()=>a().amount)))}),p(s,d),Ze()}var Eo=T('<div class="frame-content svelte-5xmos6"><div class="banking-transactions svelte-5xmos6"><!> <!> <!></div></div>'),Co=T('<div class="frame-inactive svelte-5xmos6">No activity from this replica in this frame</div>'),$o=T('<div><div class="frame-header svelte-5xmos6"><span class="frame-index-title"> </span> <span class="frame-time svelte-5xmos6"> </span> <span class="activity-badge svelte-5xmos6"> </span></div> <!></div>');function jo(s,t){Ke(t,!1);let a=Y(t,"frame",8),d=Y(t,"isCurrentFrame",8,!1);ot();var l=$o();let c;var u=n(l),b=n(u),r=n(b);i(b);var g=o(b,2),y=n(g,!0);i(g);var m=o(g,2),x=n(m,!0);i(m),i(u);var k=o(u,2);{var f=w=>{var I=Eo(),O=n(I),H=n(O);Je(H,1,()=>(z(a()),v(()=>a().imports)),nt,(S,$)=>{{let J=Ot(()=>(z(ti),e($),v(()=>ti(e($)))));ks(S,{get transaction(){return e(J)}})}});var F=o(H,2);Je(F,1,()=>(z(a()),v(()=>a().inputs)),nt,(S,$)=>{{let J=Ot(()=>(z(Qs),e($),v(()=>Qs(e($)))));ks(S,{get transaction(){return e(J)}})}});var A=o(F,2);Je(A,1,()=>(z(a()),v(()=>a().outputs)),nt,(S,$)=>{{let J=Ot(()=>(z(ei),e($),v(()=>ei(e($)))));ks(S,{get transaction(){return e(J)}})}}),i(O),i(I),p(w,I)},C=w=>{var I=Co();p(w,I)};B(k,w=>{z(a()),v(()=>a().hasActivity)?w(f):w(C,!1)})}i(l),W((w,I)=>{c=He(l,1,"frame-item svelte-5xmos6",null,c,w),qe(l,"data-frame",(z(a()),v(()=>a().frameIndex))),M(r,`Server Frame ${z(a()),v(()=>a().frameIndex)??""}`),M(y,I),M(x,(z(a()),v(()=>a().hasActivity?"🟢":"⚪")))},[()=>({"current-frame":d(),"has-activity":a().hasActivity,"no-activity":!a().hasActivity}),()=>(z(Zs),z(a()),v(()=>Zs(a().timestamp)))]),p(s,l),Ze()}var Ao=T('<div class="history-summary svelte-g4kw0a"> </div> <!>',1),No=T('<div class="empty-state svelte-g4kw0a">- no server history available</div>'),Lo=T('<div class="scrollable-component transaction-history svelte-g4kw0a"><!></div>');function Po(s,t){Ke(t,!1);const a=re(),d=re();let l=Y(t,"replica",8),c=Y(t,"tab",8),u=Y(t,"serverHistory",24,()=>[]),b=Y(t,"currentTimeIndex",8,void 0),r=re();function g(){typeof b()<"u"&&b()>=0&&e(r)&&setTimeout(()=>{const f=e(r).querySelector(`[data-frame="${b()}"]`);f&&(f.scrollIntoView({behavior:"smooth",block:"center"}),console.log(`🎯 Auto-focused frame ${b()}`))},100)}Pe(()=>(z(u()),z(l()),z(b()),z(c())),()=>{console.log("📊 [TransactionHistory] Props updated:",{serverHistoryLength:u()?.length||0,replicaExists:!!l(),replicaDetails:l()?{signerId:l().signerId,entityId:l().entityId}:null,currentTimeIndex:b(),tabId:c()?.id})}),Pe(()=>(z(u()),z(l())),()=>{h(a,To(u(),l()))}),Pe(()=>e(a),()=>{console.log("📊 [TransactionHistory] Server frames computed:",{totalFrames:e(a).length,framesWithActivity:e(a).filter(f=>f.hasActivity).length,frameIndexes:e(a).map(f=>f.frameIndex)})}),Pe(()=>e(a),()=>{h(d,e(a).filter(f=>f.hasActivity).length)}),Pe(()=>(z(b()),e(r)),()=>{b()!==void 0&&e(r)&&g()}),Ft(),ot();var y=Lo(),m=n(y);{var x=f=>{var C=Ao(),w=Ce(C),I=n(w);i(w);var O=o(w,2);Je(O,1,()=>(e(a),v(()=>e(a).slice().reverse())),H=>H.frameIndex,(H,F)=>{const A=Ot(()=>(z(b()),e(F),v(()=>b()!==void 0&&e(F).frameIndex===b())));jo(H,{get frame(){return e(F)},get isCurrentFrame(){return e(A)}})}),W(()=>M(I,`Found ${e(d)??""} frames with activity out of ${e(a),v(()=>e(a).length)??""} total`)),p(f,C)},k=f=>{var C=No();p(f,C)};B(m,f=>{e(a),v(()=>e(a).length>0)?f(x):f(k,!1)})}i(y),wa(y,f=>h(r,f),()=>e(r)),p(s,y),Ze()}var Do=T('<div class="empty-controls svelte-10swub5"><div class="empty-message svelte-10swub5"><h4 class="svelte-10swub5">🎯 Select Entity & Signer First</h4> <p>Please use the dropdown above to select:</p> <ul class="svelte-10swub5"><li class="svelte-10swub5">📍 <strong>Jurisdiction</strong> (network)</li> <li class="svelte-10swub5">👤 <strong>Signer</strong> (your identity)</li> <li class="svelte-10swub5">🏢 <strong>Entity</strong> (which entity to control)</li></ul> <small class="svelte-10swub5">Once selected, controls will appear here for chat, proposals, voting, etc.</small></div></div>'),zo=T('<div class="form-group svelte-10swub5"><label class="form-label svelte-10swub5">Message:</label> <textarea class="form-textarea svelte-10swub5" placeholder="Enter your message..."></textarea></div> <button class="form-button svelte-10swub5">Send Message</button>',1),Mo=T('<div class="form-group svelte-10swub5"><label class="form-label svelte-10swub5">Proposal Title:</label> <input class="form-input svelte-10swub5" type="text" placeholder="Enter proposal title..."/></div> <div class="form-group svelte-10swub5"><label class="form-label svelte-10swub5">Description:</label> <textarea class="form-textarea svelte-10swub5" placeholder="Enter proposal description..."></textarea></div> <button class="form-button svelte-10swub5">Create Proposal</button>',1),Oo=T("<option> </option>"),Fo=T('<div class="form-group svelte-10swub5"><label class="form-label svelte-10swub5">Select Proposal:</label> <select class="form-input svelte-10swub5"><option>Select a proposal...</option><!></select></div> <div class="form-group svelte-10swub5"><label class="form-label svelte-10swub5">Vote:</label> <select class="form-input svelte-10swub5"><option>Select your vote...</option><option>✅ Yes</option><option>❌ No</option><option>🤷 Abstain</option></select></div> <div class="form-group svelte-10swub5"><label class="form-label svelte-10swub5">Comment (optional):</label> <textarea class="form-textarea svelte-10swub5" placeholder="Add a comment to your vote..."></textarea></div> <button class="form-button svelte-10swub5">Submit Vote</button>',1),qo=T("<option> </option>"),Ro=T('<div class="form-group svelte-10swub5"><label class="form-label svelte-10swub5">Recipient Entity:</label> <input class="form-input svelte-10swub5" type="text" placeholder="Entity number (e.g., 2, 3) or full entity ID..."/> <div class="form-hint svelte-10swub5">💡 Tip: Try entity number "2" to transfer to Entity #2</div></div> <div class="form-group svelte-10swub5"><label class="form-label svelte-10swub5">Token:</label> <select class="form-input svelte-10swub5"><option>Select a token...</option><!></select></div> <div class="form-group svelte-10swub5"><label class="form-label svelte-10swub5">Amount:</label> <input class="form-input svelte-10swub5" type="number" placeholder="0.0"/></div> <button class="form-button svelte-10swub5">Send Transfer</button>',1),Uo=T('<div class="form-group svelte-10swub5"><label class="form-label svelte-10swub5">Counterparty Entity:</label> <input class="form-input svelte-10swub5" type="text" placeholder="Entity number (e.g., 2, 3) or full entity ID..."/> <div class="form-hint svelte-10swub5">💡 Tip: Try entity number "2" to open account with Entity #2</div></div> <button class="form-button svelte-10swub5">Open Account</button>',1),Bo=T('<div class="form-group svelte-10swub5"><label class="form-label svelte-10swub5">Action:</label> <div class="form-input svelte-10swub5" style="padding: 12px; background: #1e1e1e; border-radius: 4px; color: #666;"> </div></div>'),Ho=T('<select class="controls-dropdown svelte-10swub5"><option selected>💬 Create chat message</option><option>📋 Add proposal</option><option>🗳️ Vote on proposal</option><option>💳 Open account</option><option>🏛️ Form new entity</option><option>💸 Send J-tx</option><option>⚙️ Update settings</option></select> <div class="controls-form svelte-10swub5"><!></div>',1),Vo=T('<div class="controls-section svelte-10swub5"><!></div>');function Jo(s,t){Ke(t,!1);const[a,d]=Xt(),l=()=>Ge(Ct,"$xlnEnvironment",a),c=re(),u=re();let b=Y(t,"replica",8),r=Y(t,"tab",8),g=re("chat"),y=re(""),m=re(""),x=re(""),k=re(""),f=re(""),C=re(""),w=re("2"),I=re(.1),O=re("1"),H=re("2");async function F(){if(!(!r().entityId||!r().signer||!e(y).trim()))try{const E=await St(),N=l();if(!N)throw new Error("XLN environment not ready");await E.processUntilEmpty(N,[{entityId:r().entityId,signerId:r().signer,entityTxs:[{type:"chat",data:{from:r().signer,message:e(y).trim()}}]}]),console.log("💬 Chat message sent and processed:",e(y)),h(y,"")}catch(E){console.error("Failed to send chat message:",E),alert(`Failed to send message: ${E.message}`)}}async function A(){if(!(!r().entityId||!r().signer||!e(m).trim()))try{const E=await St(),N=l();if(!N)throw new Error("XLN environment not ready");const K=e(m).trim()+(e(x).trim()?": "+e(x).trim():"");await E.processUntilEmpty(N,[{entityId:r().entityId,signerId:r().signer,entityTxs:[{type:"propose",data:{action:{type:"collective_message",data:{message:K}},proposer:r().signer}}]}]),console.log("📝 Proposal sent and processed:",K),h(m,""),h(x,"")}catch(E){console.error("Failed to send proposal:",E),alert(`Failed to send proposal: ${E.message}`)}}async function S(){if(!(!r().entityId||!r().signer||!e(k)||!e(f)))try{const E=await St(),N=l();if(!N)throw new Error("XLN environment not ready");const K=b()?.state?.proposals?.get(e(k));if(K&&K.votes.has(r().signer)){alert(`You have already voted on this proposal as "${K.votes.get(r().signer)}".`);return}const be=e(f)==="yes"?"yes":e(f)==="no"?"no":"abstain",se={entityId:r().entityId,signerId:r().signer,entityTxs:[{type:"vote",data:{proposalId:e(k),voter:r().signer,choice:be,comment:e(C).trim()||void 0}}]};console.log("🗳️ FRONTEND-DEBUG: About to submit vote:",{entityId:r().entityId,signerId:r().signer,proposalId:e(k),choice:be,txType:"vote"}),await E.processUntilEmpty(N,[se]),console.log("✅ Vote submitted and processed successfully"),h(k,""),h(f,""),h(C,"")}catch(E){console.error("Failed to submit vote:",E),alert(`Failed to submit vote: ${E.message}`)}}async function $(){if(!(!r().entityId||!r().signer||!e(H).trim()))try{const E=await St(),N=l();if(!N)throw new Error("XLN environment not ready");const K=J(e(H)),be={entityId:r().entityId,signerId:r().signer,entityTxs:[{type:"accountInput",data:{fromEntityId:r().entityId,toEntityId:K,accountTx:{type:"initial_ack",data:{message:"Account opening request"}}}}]};console.log("💳 Opening account with entity:",K),await E.processUntilEmpty(N,[be]),console.log("✅ Account opened successfully"),h(H,"")}catch(E){console.error("Failed to open account:",E),alert(`Failed to open account: ${E.message}`)}}function J(E){return/^\d+$/.test(E)?"0x"+BigInt(E).toString(16).padStart(64,"0"):E}async function fe(){if(!r().entityId||!r().signer||!e(w).trim()||!e(I)||!e(O)){alert("Please fill in all fields for the transfer.");return}const E=J(e(w).trim()),N=Number(e(O));if(console.log("🔍 R2R Transfer Debug:"),console.log("  From Entity:",r().entityId),console.log("  To Entity:",E),console.log("  Token ID:",N),console.log("  Amount:",e(I)),isNaN(N)){alert("Invalid token selected. Please ensure the dropdown value is a number.");return}if(e(I)<=0){alert("Amount must be greater than zero.");return}if(r().entityId===E){alert(`Cannot transfer to yourself!

You are Entity #1 (${r().entityId})
Trying to send to: ${E}

Tip: Try entering "2" to send to Entity #2 instead.`);return}try{const K=await St();if(!l())throw new Error("XLN environment not ready");const se={reserveToReserve:[{receivingEntity:E,tokenId:N,amount:e(I)}],reserveToExternalToken:[],externalTokenToReserve:[],reserveToCollateral:[],settlements:[],cooperativeUpdate:[],cooperativeDisputeProof:[],initialDisputeProof:[],finalDisputeProof:[],flashloans:[],hub_id:0};console.log("💸 Submitting SIMPLE reserveToReserve to blockchain..."),console.log("🔍 Getting ethereum jurisdiction...");const Z=await K.getJurisdictionByAddress("ethereum");if(!Z)throw new Error("Ethereum jurisdiction not found");console.log("🔍 Found jurisdiction:",Z);const R={reserveToReserve:[{receivingEntity:E,tokenId:N,amount:e(I)}],reserveToExternalToken:[],externalTokenToReserve:[],reserveToCollateral:[],settlements:[],cooperativeUpdate:[],cooperativeDisputeProof:[],initialDisputeProof:[],finalDisputeProof:[],flashloans:[],hub_id:0};console.log("🔍 Simple R2R batch:",R);const q=BigInt(Math.floor(e(I)*1e18)).toString(),ce=await K.submitReserveToReserve(Z,r().entityId,E,N,q);console.log("✅ Direct R2R function call confirmed:",ce.txHash),console.log("⏳ Waiting for j-watcher to process events..."),await new Promise(me=>setTimeout(me,1e3)),console.log("💸 Reserve transfer sent successfully to",E),h(w,""),h(I,0),h(O,"")}catch(K){console.error("Failed to send J-tx:",K),alert(`Failed to send J-tx: ${K.message}`)}}Pe(()=>z(b()),()=>{h(c,b()?.state?.proposals?Array.from(b().state.proposals.entries()).map(([E,N])=>({id:E,...N})):[])}),Pe(()=>z(b()),()=>{h(u,b()?.state?.reserves?Array.from(b().state.reserves.entries()).map(([E,N])=>({id:E,name:N.name||`Token #${E}`,amount:N.amount})):[])}),Ft(),ot();var ee=Vo(),L=n(ee);{var ve=E=>{var N=Do();p(E,N)},P=E=>{var N=Ho(),K=Ce(N);W(()=>{e(g),Jt(()=>{})});var be=n(K);be.value=be.__value="chat";var se=o(be);se.value=se.__value="proposal";var Z=o(se);Z.value=Z.__value="vote";var R=o(Z);R.value=R.__value="account";var q=o(R);q.value=q.__value="entity";var ce=o(q);ce.value=ce.__value="jtx";var me=o(ce);me.value=me.__value="settings",i(K);var $e=o(K,2),je=n($e);{var ae=U=>{var ie=zo(),pe=Ce(ie),we=o(n(pe),2);Ya(we),i(pe);var G=o(pe,2);wt(we,()=>e(y),de=>h(y,de)),ue("click",G,F),p(U,ie)},V=U=>{var ie=ze(),pe=Ce(ie);{var we=de=>{var Se=Mo(),le=Ce(Se),ne=o(n(le),2);ft(ne),i(le);var Ie=o(le,2),D=o(n(Ie),2);Ya(D),i(Ie);var _=o(Ie,2);wt(ne,()=>e(m),he=>h(m,he)),wt(D,()=>e(x),he=>h(x,he)),ue("click",_,A),p(de,Se)},G=de=>{var Se=ze(),le=Ce(Se);{var ne=D=>{var _=Fo(),he=Ce(_),De=o(n(he),2);W(()=>{e(k),Jt(()=>{e(c)})});var Le=n(De);Le.value=Le.__value="";var ge=o(Le);Je(ge,1,()=>e(c),nt,(Te,_e)=>{var Ee=Oo(),Me=n(Ee,!0);i(Ee);var et={};W(()=>{M(Me,(e(_e),v(()=>e(_e).action?.data?.message||"Proposal "+e(_e).id))),et!==(et=(e(_e),v(()=>e(_e).id)))&&(Ee.value=(Ee.__value=(e(_e),v(()=>e(_e).id)))??"")}),p(Te,Ee)}),i(De),i(he);var X=o(he,2),te=o(n(X),2);W(()=>{e(f),Jt(()=>{})});var ke=n(te);ke.value=ke.__value="";var Ae=o(ke);Ae.value=Ae.__value="yes";var Ne=o(Ae);Ne.value=Ne.__value="no";var Ve=o(Ne);Ve.value=Ve.__value="abstain",i(te),i(X);var Q=o(X,2),oe=o(n(Q),2);Ya(oe),i(Q);var xe=o(Q,2);ta(De,()=>e(k),Te=>h(k,Te)),ta(te,()=>e(f),Te=>h(f,Te)),wt(oe,()=>e(C),Te=>h(C,Te)),ue("click",xe,S),p(D,_)},Ie=D=>{var _=ze(),he=Ce(_);{var De=ge=>{var X=Ro(),te=Ce(X),ke=o(n(te),2);ft(ke),Et(2),i(te);var Ae=o(te,2),Ne=o(n(Ae),2);W(()=>{e(O),Jt(()=>{e(u)})});var Ve=n(Ne);Ve.value=Ve.__value="";var Q=o(Ve);Je(Q,1,()=>e(u),nt,(_e,Ee)=>{var Me=qo(),et=n(Me);i(Me);var it={};W(()=>{M(et,`${e(Ee),v(()=>e(Ee).name)??""} (Balance: ${e(Ee),v(()=>e(Ee).amount)??""})`),it!==(it=(e(Ee),v(()=>e(Ee).id)))&&(Me.value=(Me.__value=(e(Ee),v(()=>e(Ee).id)))??"")}),p(_e,Me)}),i(Ne),i(Ae);var oe=o(Ae,2),xe=o(n(oe),2);ft(xe),i(oe);var Te=o(oe,2);wt(ke,()=>e(w),_e=>h(w,_e)),ta(Ne,()=>e(O),_e=>h(O,_e)),wt(xe,()=>e(I),_e=>h(I,_e)),ue("click",Te,fe),p(ge,X)},Le=ge=>{var X=ze(),te=Ce(X);{var ke=Ne=>{var Ve=Uo(),Q=Ce(Ve),oe=o(n(Q),2);ft(oe),Et(2),i(Q);var xe=o(Q,2);wt(oe,()=>e(H),Te=>h(H,Te)),ue("click",xe,$),p(Ne,Ve)},Ae=Ne=>{var Ve=Bo(),Q=o(n(Ve),2),oe=n(Q);i(Q),i(Ve),W(()=>M(oe,`${e(g)??""} controls will be implemented here`)),p(Ne,Ve)};B(te,Ne=>{e(g)==="account"?Ne(ke):Ne(Ae,!1)},!0)}p(ge,X)};B(he,ge=>{e(g)==="jtx"?ge(De):ge(Le,!1)},!0)}p(D,_)};B(le,D=>{e(g)==="vote"?D(ne):D(Ie,!1)},!0)}p(de,Se)};B(pe,de=>{e(g)==="proposal"?de(we):de(G,!1)},!0)}p(U,ie)};B(je,U=>{e(g)==="chat"?U(ae):U(V,!1)})}i($e),ta(K,()=>e(g),U=>h(g,U)),p(E,N)};B(L,E=>{z(r()),v(()=>!r().entityId||!r().signer)?E(ve):E(P,!1)})}i(ee),p(s,ee),Ze(),d()}const ka=s=>s<0n?0n:s;function zs(s,t){const a=s.ondelta+s.offdelta,d=ka(s.collateral);let l=s.leftCreditLimit,c=s.rightCreditLimit,u=a>0n?ka(d-a):d,b=a>0n?a>d?d:a:0n,r=ka(-a);r>l&&(r=l);let g=ka(a-d);g>c&&(g=c);let y=ka(l-r),m=ka(c-g),x=s.rightAllowence,k=s.leftAllowence;const f=d+l+c;let C=ka(r+u+m-x),w=ka(g+b+y-k);return t||([u,x,C,b,k,w]=[b,k,w,u,x,C],[l,c]=[c,l],[y,r,g,m]=[m,g,r,y]),{delta:a,collateral:d,inCollateral:u,outCollateral:b,inOwnCredit:r,outPeerCredit:g,inAllowence:x,outAllowence:k,totalCapacity:f,ownCreditLimit:l,peerCreditLimit:c,inCapacity:C,outCapacity:w,outOwnCredit:y,inPeerCredit:m}}const Wo={0:{symbol:"NULL",name:"Null Token",decimals:18,color:"#777"},1:{symbol:"ETH",name:"Ethereum",decimals:18,color:"#627eea"},2:{symbol:"USDT",name:"Tether USD",decimals:18,color:"#26a17b"},3:{symbol:"USDC",name:"USD Coin",decimals:18,color:"#2775ca"},4:{symbol:"ACME",name:"ACME Corp Shares",decimals:18,color:"#ff6b6b"},5:{symbol:"BTC",name:"Bitcoin Shares",decimals:8,color:"#f7931a"}};function Va(s){return Wo[s]||{symbol:`TKN${s}`,name:`Token ${s}`,decimals:18,color:"#999"}}function ut(s,t){const a=Va(s),d=BigInt(10)**BigInt(a.decimals),l=t/d,c=t%d;if(c===0n)return`${l} ${a.symbol}`;const u=c.toString().padStart(a.decimals,"0");return`${l}.${u} ${a.symbol}`}var Xo=T('<span class="status-badge pending svelte-1su1p96"> </span>'),Go=T('<span class="status-badge synced svelte-1su1p96">Synced</span>'),Yo=T('<div class="bar-segment unused-credit svelte-1su1p96"></div>'),Ko=T('<div class="bar-segment collateral svelte-1su1p96"></div>'),Zo=T('<div class="bar-segment used-credit svelte-1su1p96"></div>'),Qo=T('<div class="bar-segment unused-credit svelte-1su1p96"></div>'),er=T('<div class="bar-segment collateral svelte-1su1p96"></div>'),tr=T('<div class="bar-segment used-credit svelte-1su1p96"></div>'),ar=T('<div class="token-row svelte-1su1p96"><span class="token-label svelte-1su1p96"> </span> <div class="delta-bar svelte-1su1p96"><div class="bar-section left-side svelte-1su1p96"><!> <!> <!></div> <div class="bar-separator svelte-1su1p96">|</div> <div class="bar-section right-side svelte-1su1p96"><!> <!> <!></div></div> <div class="capacity-labels svelte-1su1p96"><span class="capacity-out svelte-1su1p96" title="Can send"> </span> <span class="capacity-in svelte-1su1p96" title="Can receive"> </span></div></div>'),sr=T('<div role="button" tabindex="0"><div class="account-header svelte-1su1p96"><div class="entity-info svelte-1su1p96"><span class="entity-name svelte-1su1p96"> </span></div> <div class="account-status svelte-1su1p96"><!></div></div> <div class="utilization-indicator svelte-1su1p96"><div class="utilization-bar svelte-1su1p96"><div class="utilization-fill svelte-1su1p96"></div></div> <span class="utilization-text svelte-1su1p96"> </span></div> <div class="delta-bars svelte-1su1p96"></div></div>');function ir(s,t){Ke(t,!1);const a=re(),d=re();let l=Y(t,"account",8),c=Y(t,"counterpartyId",8),u=Y(t,"isSelected",8,!1);const b=Pa();function r(){if(!l().deltas||l().deltas.size===0)return 0;let ee=0n,L=0n;for(const[ve,P]of l().deltas.entries()){const E=zs(P,l().isProposer);ee+=E.outCapacity+E.inCapacity;const N=P.rightCreditLimit>0n?P.rightCreditLimit-(E.outCapacity-P.collateral):0n;L+=N+P.collateral}return ee>0n?Number(L*100n/ee):0}function g(){b("select",{accountId:c()})}Pe(()=>{},()=>{h(a,r())}),Pe(()=>(z(l()),Va),()=>{h(d,Array.from(l().deltas?.entries()||[]).map(([ee,L])=>{const ve=zs(L,l().isProposer),P=Va(ee),E=ve.inPeerCredit,N=ve.inCollateral,K=ve.inOwnCredit,be=ve.outOwnCredit,se=ve.outCollateral,Z=ve.outPeerCredit,R=ve.totalCapacity;return{tokenId:ee,tokenInfo:P,theirUnusedCredit:E,ourCollateralLocked:N,theirUsedCredit:K,ourUnusedCredit:be,theirCollateralLocked:se,ourUsedCredit:Z,totalCapacity:R,derived:ve}}))}),Ft(),ot();var y=sr();let m;var x=n(y),k=n(x),f=n(k),C=n(f);i(f),i(k);var w=o(k,2),I=n(w);{var O=ee=>{var L=Xo(),ve=n(L);i(L),W(()=>M(ve,`${z(l()),v(()=>l().mempool.length)??""} pending`)),p(ee,L)},H=ee=>{var L=Go();p(ee,L)};B(I,ee=>{z(l()),v(()=>l().mempool.length>0)?ee(O):ee(H,!1)})}i(w),i(x);var F=o(x,2),A=n(F),S=n(A);i(A);var $=o(A,2),J=n($);i($),i(F);var fe=o(F,2);Je(fe,5,()=>e(d),ee=>ee.tokenId,(ee,L)=>{var ve=ar(),P=n(ve),E=n(P,!0);i(P);var N=o(P,2),K=n(N),be=n(K);{var se=le=>{var ne=Yo();W((Ie,D)=>{vt(ne,`width: ${Ie??""}%`),qe(ne,"title",`Our unused credit: ${D??""}`)},[()=>(e(L),v(()=>Number(e(L).ourUnusedCredit*100n/e(L).totalCapacity))),()=>(z(ut),e(L),v(()=>ut(e(L).tokenId,e(L).ourUnusedCredit)))]),p(le,ne)};B(be,le=>{e(L),v(()=>e(L).ourUnusedCredit>0n)&&le(se)})}var Z=o(be,2);{var R=le=>{var ne=Ko();W((Ie,D)=>{vt(ne,`width: ${Ie??""}%`),qe(ne,"title",`Their collateral: ${D??""}`)},[()=>(e(L),v(()=>Number(e(L).theirCollateralLocked*100n/e(L).totalCapacity))),()=>(z(ut),e(L),v(()=>ut(e(L).tokenId,e(L).theirCollateralLocked)))]),p(le,ne)};B(Z,le=>{e(L),v(()=>e(L).theirCollateralLocked>0n)&&le(R)})}var q=o(Z,2);{var ce=le=>{var ne=Zo();W((Ie,D)=>{vt(ne,`width: ${Ie??""}%`),qe(ne,"title",`Credit they're using: ${D??""}`)},[()=>(e(L),v(()=>Number(e(L).ourUsedCredit*100n/e(L).totalCapacity))),()=>(z(ut),e(L),v(()=>ut(e(L).tokenId,e(L).ourUsedCredit)))]),p(le,ne)};B(q,le=>{e(L),v(()=>e(L).ourUsedCredit>0n)&&le(ce)})}i(K);var me=o(K,4),$e=n(me);{var je=le=>{var ne=Qo();W((Ie,D)=>{vt(ne,`width: ${Ie??""}%`),qe(ne,"title",`Their unused credit: ${D??""}`)},[()=>(e(L),v(()=>Number(e(L).theirUnusedCredit*100n/e(L).totalCapacity))),()=>(z(ut),e(L),v(()=>ut(e(L).tokenId,e(L).theirUnusedCredit)))]),p(le,ne)};B($e,le=>{e(L),v(()=>e(L).theirUnusedCredit>0n)&&le(je)})}var ae=o($e,2);{var V=le=>{var ne=er();W((Ie,D)=>{vt(ne,`width: ${Ie??""}%`),qe(ne,"title",`Our collateral: ${D??""}`)},[()=>(e(L),v(()=>Number(e(L).ourCollateralLocked*100n/e(L).totalCapacity))),()=>(z(ut),e(L),v(()=>ut(e(L).tokenId,e(L).ourCollateralLocked)))]),p(le,ne)};B(ae,le=>{e(L),v(()=>e(L).ourCollateralLocked>0n)&&le(V)})}var U=o(ae,2);{var ie=le=>{var ne=tr();W((Ie,D)=>{vt(ne,`width: ${Ie??""}%`),qe(ne,"title",`Credit we're using: ${D??""}`)},[()=>(e(L),v(()=>Number(e(L).theirUsedCredit*100n/e(L).totalCapacity))),()=>(z(ut),e(L),v(()=>ut(e(L).tokenId,e(L).theirUsedCredit)))]),p(le,ne)};B(U,le=>{e(L),v(()=>e(L).theirUsedCredit>0n)&&le(ie)})}i(me),i(N);var pe=o(N,2),we=n(pe),G=n(we);i(we);var de=o(we,2),Se=n(de);i(de),i(pe),i(ve),W((le,ne)=>{vt(P,`color: ${e(L),v(()=>e(L).tokenInfo.color)??""}`),M(E,(e(L),v(()=>e(L).tokenInfo.symbol))),M(G,`OUT ${le??""}`),M(Se,`IN ${ne??""}`)},[()=>(z(ut),e(L),v(()=>ut(e(L).tokenId,e(L).derived.outCapacity))),()=>(z(ut),e(L),v(()=>ut(e(L).tokenId,e(L).derived.inCapacity)))]),p(ee,ve)}),i(fe),i(y),W((ee,L)=>{m=He(y,1,"account-preview svelte-1su1p96",null,m,ee),M(C,`Entity #${L??""}`),vt(S,`width: ${e(a)??""}%`),M(J,`${e(a)??""}% utilized`)},[()=>({selected:u()}),()=>(z(We),z(c()),v(()=>We(c())))]),ue("click",y,g),ue("keydown",y,ee=>ee.key==="Enter"&&g()),p(s,y),Ze()}var nr=T('<span class="status-badge pending svelte-1ji6xdj"> </span>'),or=T('<span class="status-badge synced svelte-1ji6xdj">Synced</span>'),rr=T('<div class="bar-segment unused-credit svelte-1ji6xdj"><span class="segment-label svelte-1ji6xdj"> </span></div>'),lr=T('<div class="bar-segment collateral svelte-1ji6xdj"><span class="segment-label svelte-1ji6xdj"> </span></div>'),cr=T('<div class="bar-segment used-credit svelte-1ji6xdj"><span class="segment-label svelte-1ji6xdj"> </span></div>'),dr=T('<div class="bar-segment unused-credit svelte-1ji6xdj"><span class="segment-label svelte-1ji6xdj"> </span></div>'),vr=T('<div class="bar-segment used-credit svelte-1ji6xdj"><span class="segment-label svelte-1ji6xdj"> </span></div>'),ur=T('<div class="token-detail-card svelte-1ji6xdj"><div class="token-header svelte-1ji6xdj"><span class="token-name svelte-1ji6xdj"> </span> <span> </span></div> <div class="balance-visualization svelte-1ji6xdj"><div class="balance-row svelte-1ji6xdj"><span class="row-label svelte-1ji6xdj">Our Side</span> <div class="detailed-bar svelte-1ji6xdj"><!> <!> <!></div></div> <div class="balance-row svelte-1ji6xdj"><span class="row-label svelte-1ji6xdj">Their Side</span> <div class="detailed-bar svelte-1ji6xdj"><!> <!></div></div></div> <div class="capacity-summary svelte-1ji6xdj"><div class="capacity-item svelte-1ji6xdj"><span class="capacity-label svelte-1ji6xdj">Can Send:</span> <span class="capacity-value outbound svelte-1ji6xdj"> </span></div> <div class="capacity-item svelte-1ji6xdj"><span class="capacity-label svelte-1ji6xdj">Can Receive:</span> <span class="capacity-value inbound svelte-1ji6xdj"> </span></div> <div class="capacity-item svelte-1ji6xdj"><span class="capacity-label svelte-1ji6xdj">Total Capacity:</span> <span class="capacity-value svelte-1ji6xdj"> </span></div></div> <div class="credit-details svelte-1ji6xdj"><div class="credit-row svelte-1ji6xdj"><span class="svelte-1ji6xdj">Our Credit Limit:</span> <span class="svelte-1ji6xdj"> </span></div> <div class="credit-row svelte-1ji6xdj"><span class="svelte-1ji6xdj">Their Credit Limit:</span> <span class="svelte-1ji6xdj"> </span></div> <div class="credit-row svelte-1ji6xdj"><span class="svelte-1ji6xdj">Our Collateral:</span> <span class="svelte-1ji6xdj"> </span></div></div></div>'),pr=T("<option> </option>"),fr=T("<option> </option>"),mr=T('<span class="tx-amount svelte-1ji6xdj"> </span>'),hr=T('<div class="mempool-item svelte-1ji6xdj"><span class="tx-index svelte-1ji6xdj"></span> <span class="tx-type svelte-1ji6xdj"> </span> <!></div>'),gr=T('<div class="section svelte-1ji6xdj"><h3 class="svelte-1ji6xdj">Pending Transactions</h3> <div class="mempool-list svelte-1ji6xdj"></div></div>'),yr=T('<div class="account-panel svelte-1ji6xdj"><div class="panel-header svelte-1ji6xdj"><button class="back-button svelte-1ji6xdj">← Back to Accounts</button> <div class="account-title svelte-1ji6xdj"><span class="entity-pair svelte-1ji6xdj"> </span> <div class="consensus-status svelte-1ji6xdj"><span class="frame-badge svelte-1ji6xdj"> </span> <!></div></div></div> <div class="panel-content svelte-1ji6xdj"><div class="section svelte-1ji6xdj"><h3 class="svelte-1ji6xdj">Token Balances</h3> <!></div> <div class="section svelte-1ji6xdj"><h3 class="svelte-1ji6xdj">Quick Actions</h3> <div class="action-card svelte-1ji6xdj"><h4 class="svelte-1ji6xdj">Send Payment</h4> <div class="action-form svelte-1ji6xdj"><select class="form-select svelte-1ji6xdj"></select> <input type="number" step="0.01" placeholder="Amount" class="form-input svelte-1ji6xdj"/> <input type="text" placeholder="Description (optional)" class="form-input svelte-1ji6xdj"/> <button class="action-button primary svelte-1ji6xdj">Send Payment</button></div></div> <div class="action-card svelte-1ji6xdj"><h4 class="svelte-1ji6xdj">Adjust Credit Limit</h4> <div class="action-form svelte-1ji6xdj"><select class="form-select svelte-1ji6xdj"></select> <input type="number" step="0.1" placeholder="New credit limit" class="form-input svelte-1ji6xdj"/> <button class="action-button secondary svelte-1ji6xdj">Update Credit</button></div></div> <div class="action-card svelte-1ji6xdj"><h4 class="svelte-1ji6xdj">Account Management</h4> <div class="management-buttons svelte-1ji6xdj"><button class="action-button settle svelte-1ji6xdj">Settle On-Chain</button> <button class="action-button dispute svelte-1ji6xdj">Initiate Dispute</button> <button class="action-button close svelte-1ji6xdj">Close Account</button></div></div></div> <!></div></div>');function Ti(s,t){Ke(t,!1);const[a,d]=Xt(),l=()=>Ge(Ct,"$xlnEnvironment",a),c=re();let u=Y(t,"account",8),b=Y(t,"counterpartyId",8),r=Y(t,"entityId",8);const g=Pa();let y=re(1),m=re(0),x=re(0),k=re("");async function f(){try{const D=await St(),_=l();if(!_)throw new Error("XLN environment not ready");const he={entityId:r(),signerId:r(),entityTxs:[{type:"direct-payment",data:{recipientEntityId:b(),tokenId:e(y),amount:BigInt(Math.floor(e(x)*1e18)),description:e(k)||void 0}}]};await D.processUntilEmpty(_,[he]),console.log(`✅ Payment sent: ${e(x)} ${Va(e(y)).symbol}`),h(x,0),h(k,"")}catch(D){console.error("Failed to send payment:",D),alert(`Failed to send payment: ${D.message}`)}}async function C(){try{const D=await St(),_=l();if(!_)throw new Error("XLN environment not ready");const he={entityId:r(),signerId:r(),entityTxs:[{type:"adjust-credit",data:{counterpartyEntityId:b(),tokenId:e(y),newCreditLimit:BigInt(Math.floor(e(m)*1e18))}}]};await D.processUntilEmpty(_,[he]),console.log(`✅ Credit adjusted to: ${e(m)}`),h(m,0)}catch(D){console.error("Failed to adjust credit:",D),alert(`Failed to adjust credit: ${D.message}`)}}async function w(){if(confirm("Are you sure you want to settle this account on-chain?"))try{const D=await St(),_=await D.getJurisdictionByAddress("ethereum");if(!_)throw new Error("Ethereum jurisdiction not found");for(const he of e(c))(he.delta.ondelta!==0n||he.delta.offdelta!==0n)&&await D.submitSettle(_,r()<b()?r():b(),r()<b()?b():r(),[{tokenId:he.tokenId,leftDiff:0n,rightDiff:0n,collateralDiff:0n}]);console.log("✅ Settlement submitted")}catch(D){console.error("Failed to settle:",D),alert(`Failed to settle: ${D.message}`)}}async function I(){confirm("Are you sure you want to initiate a dispute? This will freeze the account.")&&(console.log("🚨 Dispute initiated"),alert("Dispute functionality coming soon"))}async function O(){confirm("Are you sure you want to close this account? All balances must be settled first.")&&(console.log("❌ Closing account"),alert("Account closure functionality coming soon"))}function H(){g("back")}Pe(()=>(z(u()),Va),()=>{h(c,Array.from(u().deltas?.entries()||[]).map(([D,_])=>{const he=zs(_,u().isProposer),De=Va(D),Le=_.rightCreditLimit,ge=Le>0n?Math.max(0,Number(Le)-Number(he.inCapacity-_.collateral)):0,X=Number(Le)-ge,te=_.leftCreditLimit,ke=te>0n?Math.max(0,Number(te)-Number(he.outCapacity)):0,Ae=Number(te)-ke;return{tokenId:D,tokenInfo:De,delta:_,derived:he,theirCreditLimit:Number(Le)/1e18,theirUsedCredit:ge/1e18,theirUnusedCredit:X/1e18,ourCreditLimit:Number(te)/1e18,ourUsedCredit:ke/1e18,ourUnusedCredit:Ae/1e18,ourCollateral:Number(_.collateral)/1e18,theirCollateral:0}}))}),Ft(),ot();var F=yr(),A=n(F),S=n(A),$=o(S,2),J=n($),fe=n(J);i(J);var ee=o(J,2),L=n(ee),ve=n(L);i(L);var P=o(L,2);{var E=D=>{var _=nr(),he=n(_);i(_),W(()=>M(he,`${z(u()),v(()=>u().mempool.length)??""} pending`)),p(D,_)},N=D=>{var _=or();p(D,_)};B(P,D=>{z(u()),v(()=>u().mempool.length>0)?D(E):D(N,!1)})}i(ee),i($),i(A);var K=o(A,2),be=n(K),se=o(n(be),2);Je(se,1,()=>e(c),D=>D.tokenId,(D,_)=>{var he=ur(),De=n(he),Le=n(De),ge=n(Le);i(Le);var X=o(Le,2);let te;var ke=n(X);i(X),i(De);var Ae=o(De,2),Ne=n(Ae),Ve=o(n(Ne),2),Q=n(Ve);{var oe=tt=>{var Re=rr(),mt=n(Re),xt=n(mt,!0);i(mt),i(Re),W((Lt,$t)=>{vt(Re,`flex: ${e(_),v(()=>e(_).ourUnusedCredit)??""}`),qe(Re,"title",`Unused credit we gave: ${Lt??""}`),M(xt,$t)},[()=>(e(_),v(()=>e(_).ourUnusedCredit.toFixed(4))),()=>(e(_),v(()=>e(_).ourUnusedCredit.toFixed(2)))]),p(tt,Re)};B(Q,tt=>{e(_),v(()=>e(_).ourUnusedCredit>0)&&tt(oe)})}var xe=o(Q,2);{var Te=tt=>{var Re=lr(),mt=n(Re),xt=n(mt,!0);i(mt),i(Re),W((Lt,$t)=>{vt(Re,`flex: ${e(_),v(()=>e(_).ourCollateral)??""}`),qe(Re,"title",`Our collateral: ${Lt??""}`),M(xt,$t)},[()=>(e(_),v(()=>e(_).ourCollateral.toFixed(4))),()=>(e(_),v(()=>e(_).ourCollateral.toFixed(2)))]),p(tt,Re)};B(xe,tt=>{e(_),v(()=>e(_).ourCollateral>0)&&tt(Te)})}var _e=o(xe,2);{var Ee=tt=>{var Re=cr(),mt=n(Re),xt=n(mt,!0);i(mt),i(Re),W((Lt,$t)=>{vt(Re,`flex: ${e(_),v(()=>e(_).ourUsedCredit)??""}`),qe(Re,"title",`Used credit we gave: ${Lt??""}`),M(xt,$t)},[()=>(e(_),v(()=>e(_).ourUsedCredit.toFixed(4))),()=>(e(_),v(()=>e(_).ourUsedCredit.toFixed(2)))]),p(tt,Re)};B(_e,tt=>{e(_),v(()=>e(_).ourUsedCredit>0)&&tt(Ee)})}i(Ve),i(Ne);var Me=o(Ne,2),et=o(n(Me),2),it=n(et);{var Tt=tt=>{var Re=dr(),mt=n(Re),xt=n(mt,!0);i(mt),i(Re),W((Lt,$t)=>{vt(Re,`flex: ${e(_),v(()=>e(_).theirUnusedCredit)??""}`),qe(Re,"title",`Unused credit they gave: ${Lt??""}`),M(xt,$t)},[()=>(e(_),v(()=>e(_).theirUnusedCredit.toFixed(4))),()=>(e(_),v(()=>e(_).theirUnusedCredit.toFixed(2)))]),p(tt,Re)};B(it,tt=>{e(_),v(()=>e(_).theirUnusedCredit>0)&&tt(Tt)})}var At=o(it,2);{var Nt=tt=>{var Re=vr(),mt=n(Re),xt=n(mt,!0);i(mt),i(Re),W((Lt,$t)=>{vt(Re,`flex: ${e(_),v(()=>e(_).theirUsedCredit)??""}`),qe(Re,"title",`Used credit they gave: ${Lt??""}`),M(xt,$t)},[()=>(e(_),v(()=>e(_).theirUsedCredit.toFixed(4))),()=>(e(_),v(()=>e(_).theirUsedCredit.toFixed(2)))]),p(tt,Re)};B(At,tt=>{e(_),v(()=>e(_).theirUsedCredit>0)&&tt(Nt)})}i(et),i(Me),i(Ae);var Ye=o(Ae,2),It=n(Ye),qt=o(n(It),2),ra=n(qt,!0);i(qt),i(It);var Ht=o(It,2),Ea=o(n(Ht),2),Ca=n(Ea,!0);i(Ea),i(Ht);var $a=o(Ht,2),Da=o(n($a),2),ja=n(Da,!0);i(Da),i($a),i(Ye);var Rt=o(Ye,2),ya=n(Rt),aa=o(n(ya),2),rt=n(aa);i(aa),i(ya);var Kt=o(ya,2),da=o(n(Kt),2),sa=n(da);i(da),i(Kt);var va=o(Kt,2),ia=o(n(va),2),xa=n(ia);i(ia),i(va),i(Rt),i(he),W((tt,Re,mt,xt,Lt,$t,ba,za)=>{vt(Le,`color: ${e(_),v(()=>e(_).tokenInfo.color)??""}`),M(ge,`${e(_),v(()=>e(_).tokenInfo.symbol)??""} (Token #${e(_),v(()=>e(_).tokenId)??""})`),te=He(X,1,"net-position svelte-1ji6xdj",null,te,tt),M(ke,`Net: ${Re??""}`),M(ra,mt),M(Ca,xt),M(ja,Lt),M(rt,`${$t??""} ${e(_),v(()=>e(_).tokenInfo.symbol)??""}`),M(sa,`${ba??""} ${e(_),v(()=>e(_).tokenInfo.symbol)??""}`),M(xa,`${za??""} ${e(_),v(()=>e(_).tokenInfo.symbol)??""}`)},[()=>({positive:e(_).derived.delta>0n,negative:e(_).derived.delta<0n}),()=>(z(ut),e(_),v(()=>ut(e(_).tokenId,e(_).derived.delta))),()=>(z(ut),e(_),v(()=>ut(e(_).tokenId,e(_).derived.outCapacity))),()=>(z(ut),e(_),v(()=>ut(e(_).tokenId,e(_).derived.inCapacity))),()=>(z(ut),e(_),v(()=>ut(e(_).tokenId,e(_).derived.totalCapacity))),()=>(e(_),v(()=>e(_).ourCreditLimit.toFixed(4))),()=>(e(_),v(()=>e(_).theirCreditLimit.toFixed(4))),()=>(e(_),v(()=>e(_).ourCollateral.toFixed(4)))]),p(D,he)}),i(be);var Z=o(be,2),R=o(n(Z),2),q=o(n(R),2),ce=n(q);W(()=>{e(y),Jt(()=>{e(c)})}),Je(ce,5,()=>e(c),nt,(D,_)=>{var he=pr(),De=n(he,!0);i(he);var Le={};W(()=>{M(De,(e(_),v(()=>e(_).tokenInfo.symbol))),Le!==(Le=(e(_),v(()=>e(_).tokenId)))&&(he.value=(he.__value=(e(_),v(()=>e(_).tokenId)))??"")}),p(D,he)}),i(ce);var me=o(ce,2);ft(me);var $e=o(me,2);ft($e);var je=o($e,2);i(q),i(R);var ae=o(R,2),V=o(n(ae),2),U=n(V);W(()=>{e(y),Jt(()=>{e(c)})}),Je(U,5,()=>e(c),nt,(D,_)=>{var he=fr(),De=n(he,!0);i(he);var Le={};W(()=>{M(De,(e(_),v(()=>e(_).tokenInfo.symbol))),Le!==(Le=(e(_),v(()=>e(_).tokenId)))&&(he.value=(he.__value=(e(_),v(()=>e(_).tokenId)))??"")}),p(D,he)}),i(U);var ie=o(U,2);ft(ie);var pe=o(ie,2);i(V),i(ae);var we=o(ae,2),G=o(n(we),2),de=n(G),Se=o(de,2),le=o(Se,2);i(G),i(we),i(Z);var ne=o(Z,2);{var Ie=D=>{var _=gr(),he=o(n(_),2);Je(he,5,()=>(z(u()),v(()=>u().mempool)),nt,(De,Le,ge)=>{var X=hr(),te=n(X);te.textContent=`#${ge+1}`;var ke=o(te,2),Ae=n(ke,!0);i(ke);var Ne=o(ke,2);{var Ve=Q=>{var oe=mr(),xe=n(oe,!0);i(oe),W(Te=>M(xe,Te),[()=>(e(Le),v(()=>(Number(e(Le).data.amount)/1e18).toFixed(4)))]),p(Q,oe)};B(Ne,Q=>{e(Le),v(()=>e(Le).data.amount)&&Q(Ve)})}i(X),W(()=>M(Ae,(e(Le),v(()=>e(Le).type)))),p(De,X)}),i(he),i(_),p(D,_)};B(ne,D=>{z(u()),v(()=>u().mempool.length>0)&&D(Ie)})}i(K),i(F),W((D,_)=>{M(fe,`Entity #${D??""} ⟷ Entity #${_??""}`),M(ve,`Frame #${z(u()),v(()=>u().currentFrame.frameId)??""}`)},[()=>(z(We),z(r()),v(()=>We(r()))),()=>(z(We),z(b()),v(()=>We(b())))]),ue("click",S,H),ta(ce,()=>e(y),D=>h(y,D)),wt(me,()=>e(x),D=>h(x,D)),wt($e,()=>e(k),D=>h(k,D)),ue("click",je,f),ta(U,()=>e(y),D=>h(y,D)),wt(ie,()=>e(m),D=>h(m,D)),ue("click",pe,C),ue("click",de,w),ue("click",Se,I),ue("click",le,O),p(s,F),Ze(),d()}var br=T('<div class="no-accounts svelte-1cp6n4q"><p class="svelte-1cp6n4q">No accounts established</p> <small class="svelte-1cp6n4q">Select an entity below to open an account</small></div>'),_r=T('<div class="scrollable-component accounts-list svelte-1cp6n4q"></div>'),wr=T("<option> </option>"),xr=T('<div class="accounts-list-view svelte-1cp6n4q"><!> <div class="add-account-section svelte-1cp6n4q"><h5 class="svelte-1cp6n4q">➕ Open New Account</h5> <select class="entity-select svelte-1cp6n4q"><option>Select an entity...</option><!></select> <button class="open-account-button svelte-1cp6n4q">📝 Open Account</button></div></div>'),kr=T('<div class="account-channels svelte-1cp6n4q" data-testid="account-channels"><!></div>');function Sr(s,t){Ke(t,!1);const[a,d]=Xt(),l=()=>Ge(vs,"$replicas",a),c=()=>Ge(Ct,"$xlnEnvironment",a),u=re(),b=re(),r=re();let g=Y(t,"replica",8),y=re(null),m=re(!1),x=re("");function k(){if(!g()||!l())return[];const A=g().entityId,S=new Set(g().state?.accounts?Array.from(g().state.accounts.keys()):[]),$=new Set;for(const[J]of l().entries()){const[fe]=J.split(":");fe!==A&&$.add(fe)}return Array.from($).map(J=>{const fe=We(J),ee=S.has(J);return{entityId:J,displayName:`Entity #${fe}`,shortId:Vn(J),hasAccount:ee}}).sort((J,fe)=>We(J.entityId)-We(fe.entityId))}async function f(A){if(g())try{console.log(`💳 NEW-FLOW: Opening account with Entity #${We(A)} via entity transaction`);const S=await St(),$=c();if(!$)throw new Error("XLN environment not ready");const J={entityId:g().entityId,signerId:g().signerId,entityTxs:[{type:"openAccount",data:{targetEntityId:A}}]};await S.processUntilEmpty($,[J]),console.log(`✅ Account request sent to local e-machine for Entity #${We(A)}`)}catch(S){console.error("Failed to send account request:",S),alert(`Failed to send account request: ${S.message}`)}}function C(A){h(y,A.detail.accountId),h(m,!0)}function w(){h(m,!1),h(y,null)}Pe(()=>z(g()),()=>{h(u,g()?.state?.accounts?Array.from(g().state.accounts.entries()).map(([A,S])=>({counterpartyId:A,...S})):[])}),Pe(()=>(e(y),z(g())),()=>{h(b,e(y)&&g()?.state?.accounts?g().state.accounts.get(e(y)):null)}),Pe(()=>(z(g()),l(),e(u)),()=>{h(r,g()&&l()&&e(u)?k():[])}),Ft(),ot();var I=kr(),O=n(I);{var H=A=>{Ti(A,{get account(){return e(b)},get counterpartyId(){return e(y)},get entityId(){return z(g()),v(()=>g().entityId)},$$events:{back:w}})},F=A=>{var S=xr(),$=n(S);{var J=N=>{var K=br();p(N,K)},fe=N=>{var K=_r();Je(K,5,()=>e(u),be=>be.counterpartyId,(be,se)=>{{let Z=Ot(()=>(e(y),e(se),v(()=>e(y)===e(se).counterpartyId)));ir(be,{get account(){return e(se)},get counterpartyId(){return e(se),v(()=>e(se).counterpartyId)},get isSelected(){return e(Z)},$$events:{select:C}})}}),i(K),p(N,K)};B($,N=>{e(u),v(()=>e(u).length===0)?N(J):N(fe,!1)})}var ee=o($,2),L=o(n(ee),2);W(()=>{e(x),Jt(()=>{e(r)})});var ve=n(L);ve.value=ve.__value="";var P=o(ve);Je(P,1,()=>(e(r),v(()=>e(r).filter(N=>!N.hasAccount))),nt,(N,K)=>{var be=wr(),se=n(be);i(be);var Z={};W(()=>{M(se,`${e(K),v(()=>e(K).displayName)??""} (${e(K),v(()=>e(K).shortId)??""})`),Z!==(Z=(e(K),v(()=>e(K).entityId)))&&(be.value=(be.__value=(e(K),v(()=>e(K).entityId)))??"")}),p(N,be)}),i(L);var E=o(L,2);i(ee),i(S),ta(L,()=>e(x),N=>h(x,N)),ue("click",E,()=>{e(x)&&(f(e(x)),h(x,""))}),p(A,S)};B(O,A=>{e(m)&&e(b)?A(H):A(F,!1)})}i(I),p(s,I),Ze(),d()}var Tr=T("<option> </option>"),Ir=T('<div class="route-warning svelte-1dg1zwb"> </div>'),Er=T('<label class="route-option svelte-1dg1zwb"><input type="radio" class="svelte-1dg1zwb"/> <div class="route-details svelte-1dg1zwb"><div class="route-path svelte-1dg1zwb"> </div> <div class="route-info svelte-1dg1zwb"><span class="hops svelte-1dg1zwb"> </span> <span class="fee svelte-1dg1zwb"> </span> <span class="probability svelte-1dg1zwb"> </span></div> <!></div></label>'),Cr=T('<div class="routes-section svelte-1dg1zwb"><h4 class="svelte-1dg1zwb"> </h4> <div class="routes-list svelte-1dg1zwb"></div> <button class="btn-send svelte-1dg1zwb"><!></button></div>'),$r=T('<div class="payment-panel svelte-1dg1zwb"><h3 class="svelte-1dg1zwb">Send Payment</h3> <div class="form-group svelte-1dg1zwb"><label for="target" class="svelte-1dg1zwb">Target Entity</label> <select id="target" class="svelte-1dg1zwb"><option>Select entity...</option><!></select></div> <div class="form-row svelte-1dg1zwb"><div class="form-group svelte-1dg1zwb"><label for="amount" class="svelte-1dg1zwb">Amount</label> <input id="amount" type="number" placeholder="0.00" min="0" step="0.01" class="svelte-1dg1zwb"/></div> <div class="form-group svelte-1dg1zwb"><label for="token" class="svelte-1dg1zwb">Token</label> <select id="token" class="svelte-1dg1zwb"><option>ETH</option><option>USDT</option><option>USDC</option></select></div></div> <div class="form-group svelte-1dg1zwb"><label for="description" class="svelte-1dg1zwb">Description (optional)</label> <input id="description" type="text" placeholder="Payment for..." class="svelte-1dg1zwb"/></div> <button class="btn-primary svelte-1dg1zwb"><!></button> <!></div>');function jr(s,t){Ke(t,!1);const[a,d]=Xt(),l=()=>Ge(vs,"$replicas",a),c=()=>Ge(Ct,"$xlnEnvironment",a),u=re(),b=[];let r=Y(t,"entityId",8),g=re(""),y=re(""),m=re(2),x=re(""),k=re(!1),f=re(!1),C=re([]),w=re(-1);async function I(){if(!(!e(g)||!e(y))){h(k,!0),h(C,[]),h(w,-1);try{const ae=await St(),V=c();if(!V)throw new Error("Environment not ready");let U=null;for(const[Ie,D]of V.replicas.entries())if(Ie.startsWith(r()+":")){U=D;break}const ie=U?.state?.accounts?.has(e(g)),pe=18,G=String(e(y)).split("."),de=BigInt(G[0]||0),le=(G[1]||"").padEnd(pe,"0").slice(0,pe),ne=de*BigInt(10**pe)+BigInt(le||0);ie?h(C,[{path:[r(),e(g)],hops:[{from:r(),to:e(g),fee:0n,feePPM:0}],totalFee:0n,totalAmount:ne,probability:1}]):h(C,[{path:[r(),e(g)],hops:[{from:r(),to:e(g),fee:0n,feePPM:100}],totalFee:0n,totalAmount:ne,probability:.5,warning:"No direct account - payment may fail"}]),e(C).length>0&&h(w,0)}catch(ae){console.error("Failed to find routes:",ae),alert(`Failed to find routes: ${ae.message}`)}finally{h(k,!1)}}}async function O(){if(!(e(w)<0||!e(C)[e(w)])){h(f,!0);try{const ae=await St(),V=c();if(!V)throw new Error("Environment not ready");const U=e(C)[e(w)];let ie="s1";for(const we of V.replicas.keys())if(we.startsWith(r()+":")){ie=we.split(":")[1];break}const pe={entityId:r(),signerId:ie,entityTxs:[{type:"directPayment",data:{targetEntityId:e(g),tokenId:e(m),amount:U.totalAmount,route:U.path,description:e(x)||void 0}}]};await ae.processUntilEmpty(V,[pe]),console.log(`✅ Payment sent via route: ${U.path.join(" → ")}`),h(g,""),h(y,""),h(x,""),h(C,[]),h(w,-1)}catch(ae){console.error("Failed to send payment:",ae),alert(`Failed to send payment: ${ae.message}`)}finally{h(f,!1)}}}function H(ae){return ae.path.map(V=>`E${We(V)}`).join(" → ")}function F(ae){return`${(ae/1e4).toFixed(2)}%`}Pe(()=>(l(),z(r())),()=>{h(u,l()?Array.from(l().keys()).map(ae=>ae.split(":")[0]).filter((ae,V,U)=>U.indexOf(ae)===V&&ae!==r()).sort():[])}),Ft(),ot();var A=$r(),S=o(n(A),2),$=o(n(S),2);W(()=>{e(g),Jt(()=>{e(k),e(f),e(u)})});var J=n($);J.value=J.__value="";var fe=o(J);Je(fe,1,()=>e(u),nt,(ae,V)=>{var U=Tr(),ie=n(U);i(U);var pe={};W(we=>{M(ie,`Entity #${we??""}`),pe!==(pe=e(V))&&(U.value=(U.__value=e(V))??"")},[()=>(z(We),e(V),v(()=>We(e(V))))]),p(ae,U)}),i($),i(S);var ee=o(S,2),L=n(ee),ve=o(n(L),2);ft(ve),i(L);var P=o(L,2),E=o(n(P),2);W(()=>{e(m),Jt(()=>{e(k),e(f)})});var N=n(E);N.value=N.__value=1;var K=o(N);K.value=K.__value=2;var be=o(K);be.value=be.__value=3,i(E),i(P),i(ee);var se=o(ee,2),Z=o(n(se),2);ft(Z),i(se);var R=o(se,2),q=n(R);{var ce=ae=>{var V=pt("Finding Routes...");p(ae,V)},me=ae=>{var V=pt("Find Routes");p(ae,V)};B(q,ae=>{e(k)?ae(ce):ae(me,!1)})}i(R);var $e=o(R,2);{var je=ae=>{var V=Cr(),U=n(V),ie=n(U);i(U);var pe=o(U,2);Je(pe,5,()=>e(C),nt,(le,ne,Ie)=>{var D=Er(),_=n(D);ft(_),_.value=_.__value=Ie;var he=o(_,2),De=n(he),Le=n(De,!0);i(De);var ge=o(De,2),X=n(ge),te=n(X);i(X);var ke=o(X,2),Ae=n(ke);i(ke);var Ne=o(ke,2),Ve=n(Ne);i(Ne),i(ge);var Q=o(ge,2);{var oe=xe=>{var Te=Ir(),_e=n(Te);i(Te),W(()=>M(_e,`⚠️ ${e(ne),v(()=>e(ne).warning)??""}`)),p(xe,Te)};B(Q,xe=>{e(ne),v(()=>e(ne).warning)&&xe(oe)})}i(he),i(D),W((xe,Te,_e)=>{_.disabled=e(f),M(Le,xe),M(te,`${e(ne),v(()=>e(ne).hops.length)??""} hop${e(ne),v(()=>e(ne).hops.length!==1?"s":"")??""}`),M(Ae,`Fee: ${Te??""}`),M(Ve,`Success: ${_e??""}%`)},[()=>(e(ne),v(()=>H(e(ne)))),()=>(e(ne),v(()=>F(e(ne).hops[0]?.feePPM||0))),()=>(e(ne),v(()=>(e(ne).probability*100).toFixed(0)))]),gn(b,[],_,()=>e(w),xe=>h(w,xe)),p(le,D)}),i(pe);var we=o(pe,2),G=n(we);{var de=le=>{var ne=pt("Sending Payment...");p(le,ne)},Se=le=>{var ne=pt("Send Payment");p(le,ne)};B(G,le=>{e(f)?le(de):le(Se,!1)})}i(we),i(V),W(()=>{M(ie,`Available Routes (${e(C),v(()=>e(C).length)??""})`),we.disabled=e(w)<0||e(f)}),ue("click",we,O),p(ae,V)};B($e,ae=>{e(C),v(()=>e(C).length>0)&&ae(je)})}i(A),W(()=>{$.disabled=e(k)||e(f),ve.disabled=e(k)||e(f),E.disabled=e(k)||e(f),Z.disabled=e(k)||e(f),R.disabled=!e(g)||!e(y)||e(k)||e(f)}),ta($,()=>e(g),ae=>h(g,ae)),wt(ve,()=>e(y),ae=>h(y,ae)),ta(E,()=>e(m),ae=>h(m,ae)),wt(Z,()=>e(x),ae=>h(x,ae)),ue("click",R,I),p(s,A),Ze(),d()}var Ar=T('<button class="panel-add-btn svelte-1ybwuc0" title="Add Entity Panel">➕</button>'),Nr=T('<button class="panel-close-btn svelte-1ybwuc0" title="Close panel">×</button>'),Lr=T(`<div class="empty-panel-state svelte-1ybwuc0"><div class="empty-panel-message svelte-1ybwuc0"><h3 class="svelte-1ybwuc0">Select Entity to View Profile</h3> <p class="svelte-1ybwuc0">Use the dropdown above to select:</p> <div class="selection-steps svelte-1ybwuc0"><div class="step svelte-1ybwuc0"><strong>Jurisdiction</strong> - Network/Port</div> <div class="step svelte-1ybwuc0"><strong>Signer</strong> - Your Identity</div> <div class="step svelte-1ybwuc0"><strong>Entity</strong> - Which Entity</div></div> <small class="svelte-1ybwuc0">Once selected, you'll see consensus, chat, proposals, and controls.</small></div></div>`),Pr=T('<div class="reserve-card svelte-1ybwuc0"><div class="reserve-info svelte-1ybwuc0"><span class="reserve-symbol svelte-1ybwuc0"> </span> <span class="reserve-amount svelte-1ybwuc0"> </span> <span class="reserve-value svelte-1ybwuc0"> </span></div> <div class="reserve-bar svelte-1ybwuc0"><div class="reserve-fill svelte-1ybwuc0"></div></div></div>'),Dr=T('<div class="entity-reserves-section svelte-1ybwuc0"><div class="reserves-header svelte-1ybwuc0"><h3 class="svelte-1ybwuc0">Reserves</h3> <div class="portfolio-summary svelte-1ybwuc0"><strong class="svelte-1ybwuc0"> </strong></div></div> <div class="reserves-grid svelte-1ybwuc0"></div></div>'),zr=T('<div class="entity-reserves-section svelte-1ybwuc0"><div class="reserves-header svelte-1ybwuc0"><h3 class="svelte-1ybwuc0">Reserves</h3></div> <p class="empty-reserves svelte-1ybwuc0">No reserves yet - deposit assets via Depository.sol</p></div>'),Mr=T('<!> <!> <div class="entity-accounts-section svelte-1ybwuc0"><div class="accounts-header svelte-1ybwuc0"><h3 class="svelte-1ybwuc0">Accounts</h3></div> <div class="accounts-content svelte-1ybwuc0"><!></div></div> <div class="panel-component svelte-1ybwuc0"><div role="button" tabindex="0"><div class="component-title svelte-1ybwuc0"><span>⚖️</span> <span>Consensus State</span></div> <div class="component-toggle svelte-1ybwuc0">▼</div></div> <div style="max-height: 200px;"><!></div></div> <div class="panel-component svelte-1ybwuc0"><div role="button" tabindex="0"><div class="component-title svelte-1ybwuc0"><span>💬</span> <span>Chat</span></div> <div class="component-toggle svelte-1ybwuc0">▼</div></div> <div style="max-height: 25vh;"><!></div></div> <div class="panel-component svelte-1ybwuc0"><div role="button" tabindex="0"><div class="component-title svelte-1ybwuc0"><span>📋</span> <span>Proposals</span></div> <div class="component-toggle svelte-1ybwuc0">▼</div></div> <div style="max-height: 25vh;"><!></div></div> <div class="panel-component entity-history-panel svelte-1ybwuc0"><div role="button" tabindex="0"><div class="component-title svelte-1ybwuc0"><span>🗂️</span> <span>History</span></div> <div class="component-toggle svelte-1ybwuc0">▼</div></div> <div style="max-height: 50vh;"><!></div></div> <div class="panel-component svelte-1ybwuc0"><div role="button" tabindex="0"><div class="component-title svelte-1ybwuc0"><span>⚙️</span> <span>Controls</span></div> <div class="component-toggle svelte-1ybwuc0">▼</div></div> <div style="max-height: 400px;"><!></div></div> <div class="panel-component svelte-1ybwuc0"><div class="component-header svelte-1ybwuc0" role="button" tabindex="0"><div class="component-title svelte-1ybwuc0"><span>💸</span> <span>Payments</span></div> <div class="component-toggle svelte-1ybwuc0">▼</div></div> <div class="component-content svelte-1ybwuc0" style="max-height: 600px;"><!></div></div>',1),Or=T('<div class="entity-panel svelte-1ybwuc0"><div class="panel-header svelte-1ybwuc0"><div class="panel-header-dropdowns svelte-1ybwuc0"><div class="dropdown-group svelte-1ybwuc0"><label class="dropdown-label svelte-1ybwuc0">Entity:</label> <!></div> <div class="dropdown-group svelte-1ybwuc0"><label class="dropdown-label svelte-1ybwuc0">Account:</label> <!></div></div> <div class="panel-header-controls svelte-1ybwuc0"><!> <!></div></div> <!></div>');function Fr(s,t){Ke(t,!1);const[a,d]=Xt(),l=()=>Ge(ki,"$visibleReplicas",a),c=()=>Ge(zt,"$settings",a),u=()=>Ge(xn,"$currentTimeIndex",a),b=()=>Ge(ha,"$history",a),r=re(),g=re(),y=re(),m=re(),x=re(),k=re();let f=Y(t,"tab",8),C=Y(t,"isLast",8,!1),w=re(null),I=re(null);function O(V){Ha.toggleComponentState(V)}const H={0:{symbol:"NULL",name:"Null Token",decimals:18,price:0},1:{symbol:"ETH",name:"Ethereum",decimals:18,price:2500},2:{symbol:"USDT",name:"Tether USD",decimals:18,price:1},3:{symbol:"USDC",name:"USD Coin",decimals:18,price:1},4:{symbol:"ACME",name:"ACME Corp Shares",decimals:18,price:15.5},5:{symbol:"BTC",name:"Bitcoin Shares",decimals:8,price:45e3}},F=V=>H[V]||{symbol:`TKN${V}`,decimals:18,price:0};function A(V,U){const ie=F(V),pe=BigInt(10)**BigInt(ie.decimals),we=U/pe,G=U%pe;if(G===0n)return`${we.toString()} ${ie.symbol}`;const de=G.toString().padStart(ie.decimals,"0").replace(/0+$/,"");return`${we.toString()}.${de} ${ie.symbol}`}function S(V,U){const ie=F(V),pe=BigInt(10)**BigInt(ie.decimals);return Number(U)/Number(pe)*ie.price}function $(V){let U=0;for(const[ie,pe]of V.entries())U+=S(ie,pe);return U}function J(V){const{jurisdiction:U,signer:ie,entityId:pe}=V.detail;h(I,null),Ia.updateTab(f().id,{jurisdiction:U,signer:ie,entityId:pe,title:`Entity #${We(pe)}`})}function fe(V){const{entityId:U,account:ie}=V.detail;h(I,U),console.log("📋 Account selected: Entity #",We(U),ie)}function ee(){Ia.closeTab(f().id)}function L(){Ia.addTab()}ga(()=>{Ia.getActiveTab();const V=U=>{console.log("🕰️ EntityPanel received time change event:",U.detail.timeIndex),f().entityId&&f().signer&&console.log(`🔄 Panel ${f().id} updating for time index:`,U.detail.timeIndex)};return window.addEventListener("timeChanged",V),()=>{window.removeEventListener("timeChanged",V)}}),Pe(()=>(z(f()),l()),()=>{if(f().entityId&&f().signer){const V=`${f().entityId}:${f().signer}`,U=l()?.get?.(V);h(w,U)}else h(w,null)}),Pe(()=>(c(),z(f())),()=>{h(r,c().componentStates[`consensus-${f().id}`]??!0)}),Pe(()=>(c(),z(f())),()=>{h(g,c().componentStates[`chat-${f().id}`]??!0)}),Pe(()=>(c(),z(f())),()=>{h(y,c().componentStates[`proposals-${f().id}`]??!1)}),Pe(()=>(c(),z(f())),()=>{h(m,c().componentStates[`history-${f().id}`]??!1)}),Pe(()=>(c(),z(f())),()=>{h(x,c().componentStates[`controls-${f().id}`]??!1)}),Pe(()=>(e(I),e(w)),()=>{h(k,e(I)&&e(w)?.state?.accounts?e(w).state.accounts.get(e(I)):null)}),Ft(),ot();var ve=Or(),P=n(ve),E=n(P),N=n(E),K=o(n(N),2);Wn(K,{get tab(){return f()},$$events:{entitySelect:J}}),i(N);var be=o(N,2),se=o(n(be),2);Gn(se,{get replica(){return e(w)},$$events:{accountSelect:fe}}),i(be),i(E);var Z=o(E,2),R=n(Z);{var q=V=>{var U=Ar();ue("click",U,L),p(V,U)};B(R,V=>{C()&&V(q)})}var ce=o(R,2);{var me=V=>{var U=Nr();ue("click",U,ee),p(V,U)};B(ce,V=>{V(me)})}i(Z),i(P);var $e=o(P,2);{var je=V=>{var U=Lr();p(V,U)},ae=V=>{var U=ze(),ie=Ce(U);{var pe=G=>{Ti(G,{get account(){return e(k)},get counterpartyId(){return e(I)},get entityId(){return z(f()),v(()=>f().entityId)},$$events:{back:()=>h(I,null)}})},we=G=>{var de=Mr(),Se=Ce(de);Qn(Se,{get replica(){return e(w)},get tab(){return f()}});var le=o(Se,2);{var ne=rt=>{var Kt=Dr(),da=n(Kt),sa=o(n(da),2),va=n(sa),ia=n(va);i(va),i(sa),i(da);var xa=o(da,2);Je(xa,5,()=>(e(w),v(()=>Array.from(e(w).state.reserves.entries()))),nt,(tt,Re)=>{var mt=bt(()=>ls(e(Re),2));let xt=()=>e(mt)[0],Lt=()=>e(mt)[1];const $t=Ot(()=>(xt(),v(()=>F(xt())))),ba=Ot(()=>(xt(),Lt(),v(()=>S(xt(),Lt())))),za=Ot(()=>(e(w),v(()=>$(e(w).state.reserves)))),j=Ot(()=>(c(),z(e(ba)),v(()=>c().portfolioScale>0?Math.min(e(ba)/c().portfolioScale*100,100):0))),ye=Ot(()=>e(za)>0?e(ba)/e(za)*100:0);var Oe=Pr(),Qe=n(Oe),lt=n(Qe),Fe=n(lt,!0);i(lt);var Ue=o(lt,2),at=n(Ue,!0);i(Ue);var Ut=o(Ue,2),la=n(Ut);i(Ut),i(Qe);var ct=o(Qe,2),dt=n(ct);i(ct),i(Oe),W((ca,ht,st)=>{vt(lt,`color: ${z(e($t)),v(()=>e($t).symbol==="ETH"?"#627eea":e($t).symbol==="USDT"?"#26a17b":"#007acc")??""}`),M(Fe,(z(e($t)),v(()=>e($t).symbol))),M(at,ca),M(la,`$${ht??""} (${st??""}% of entity)`),vt(dt,`width: ${e(j)??""}%`),qe(dt,"title",`Relative to global scale: $${c(),v(()=>c().portfolioScale)??""}`)},[()=>(xt(),Lt(),v(()=>A(xt(),Lt()))),()=>(z(e(ba)),v(()=>e(ba).toFixed(2))),()=>(z(e(ye)),v(()=>e(ye).toFixed(1)))]),p(tt,Oe)}),i(xa),i(Kt),W(tt=>M(ia,`Portfolio Value: $${tt??""}`),[()=>(e(w),v(()=>$(e(w).state.reserves).toFixed(2)))]),p(rt,Kt)},Ie=rt=>{var Kt=zr();p(rt,Kt)};B(le,rt=>{e(w),v(()=>e(w)?.state?.reserves&&e(w).state.reserves.size>0)?rt(ne):rt(Ie,!1)})}var D=o(le,2),_=o(n(D),2),he=n(_);Sr(he,{get replica(){return e(w)}}),i(_),i(D);var De=o(D,2),Le=n(De);let ge;var X=o(Le,2);let te;var ke=n(X);so(ke,{get replica(){return e(w)}}),i(X),i(De);var Ae=o(De,2),Ne=n(Ae);let Ve;var Q=o(Ne,2);let oe;var xe=n(Q);ho(xe,{get replica(){return e(w)},get tab(){return f()},get currentTimeIndex(){return u()}}),i(Q),i(Ae);var Te=o(Ae,2),_e=n(Te);let Ee;var Me=o(_e,2);let et;var it=n(Me);So(it,{get replica(){return e(w)},get tab(){return f()}}),i(Me),i(Te);var Tt=o(Te,2),At=n(Tt);let Nt;var Ye=o(At,2);let It;var qt=n(Ye);Po(qt,{get replica(){return e(w)},get tab(){return f()},get serverHistory(){return b()},get currentTimeIndex(){return u()}}),i(Ye),i(Tt);var ra=o(Tt,2),Ht=n(ra);let Ea;var Ca=o(Ht,2);let $a;var Da=n(Ca);Jo(Da,{get replica(){return e(w)},get tab(){return f()}}),i(Ca),i(ra);var ja=o(ra,2),Rt=n(ja),ya=o(Rt,2),aa=n(ya);{let rt=Ot(()=>(e(w),z(f()),v(()=>e(w)?.entityId||f().entityId)));jr(aa,{get entityId(){return e(rt)}})}i(ya),i(ja),W((rt,Kt,da,sa,va,ia,xa,tt,Re,mt)=>{qe(De,"id",`consensus-${z(f()),v(()=>f().id)??""}`),ge=He(Le,1,"component-header svelte-1ybwuc0",null,ge,rt),te=He(X,1,"component-content svelte-1ybwuc0",null,te,Kt),qe(Ae,"id",`chat-${z(f()),v(()=>f().id)??""}`),Ve=He(Ne,1,"component-header svelte-1ybwuc0",null,Ve,da),oe=He(Q,1,"component-content svelte-1ybwuc0",null,oe,sa),qe(Te,"id",`proposals-${z(f()),v(()=>f().id)??""}`),Ee=He(_e,1,"component-header svelte-1ybwuc0",null,Ee,va),et=He(Me,1,"component-content svelte-1ybwuc0",null,et,ia),qe(Tt,"id",`history-${z(f()),v(()=>f().id)??""}`),Nt=He(At,1,"component-header svelte-1ybwuc0",null,Nt,xa),It=He(Ye,1,"component-content svelte-1ybwuc0",null,It,tt),qe(ra,"id",`controls-${z(f()),v(()=>f().id)??""}`),Ea=He(Ht,1,"component-header svelte-1ybwuc0",null,Ea,Re),$a=He(Ca,1,"component-content svelte-1ybwuc0",null,$a,mt),qe(ja,"id",`payment-${z(f()),v(()=>f().id)??""}`)},[()=>({collapsed:!e(r)}),()=>({collapsed:!e(r)}),()=>({collapsed:!e(g)}),()=>({collapsed:!e(g)}),()=>({collapsed:!e(y)}),()=>({collapsed:!e(y)}),()=>({collapsed:!e(m)}),()=>({collapsed:!e(m)}),()=>({collapsed:!e(x)}),()=>({collapsed:!e(x)})]),ue("click",Le,()=>O(`consensus-${f().id}`)),ue("keydown",Le,rt=>rt.key==="Enter"&&O(`consensus-${f().id}`)),ue("click",Ne,()=>O(`chat-${f().id}`)),ue("keydown",Ne,rt=>rt.key==="Enter"&&O(`chat-${f().id}`)),ue("click",_e,()=>O(`proposals-${f().id}`)),ue("keydown",_e,rt=>rt.key==="Enter"&&O(`proposals-${f().id}`)),ue("click",At,()=>O(`history-${f().id}`)),ue("keydown",At,rt=>rt.key==="Enter"&&O(`history-${f().id}`)),ue("click",Ht,()=>O(`controls-${f().id}`)),ue("keydown",Ht,rt=>rt.key==="Enter"&&O(`controls-${f().id}`)),ue("click",Rt,()=>O(`payment-${f().id}`)),ue("keydown",Rt,rt=>rt.key==="Enter"&&O(`payment-${f().id}`)),p(G,de)};B(ie,G=>{e(k)&&e(I)?G(pe):G(we,!1)})}p(V,U)};B($e,V=>{z(f()),v(()=>!f().entityId||!f().signer)?V(je):V(ae,!1)})}i(ve),W(()=>qe(ve,"data-panel-id",(z(f()),v(()=>f().id)))),p(s,ve),Ze(),d()}var qr=T('<div class="input-item svelte-1fv6y8l"><strong> </strong> </div>'),Rr=T('<div class="no-inputs svelte-1fv6y8l">No server transactions</div>'),Ur=T("<br/> ",1),Br=T("<br/>📝 <strong> </strong> <!>",1),Hr=T('<div class="input-item svelte-1fv6y8l"><strong> </strong> <!></div>'),Vr=T('<div class="no-inputs svelte-1fv6y8l">No entity inputs</div>'),Jr=T("<br/> ",1),Wr=T("<br/>📝 <strong> </strong> <!>",1),Xr=T('<div class="input-item svelte-1fv6y8l"><strong> </strong> <!></div>'),Gr=T('<div class="no-inputs svelte-1fv6y8l">No entity outputs</div>'),Yr=T(`<div class="history-content svelte-1fv6y8l"><div class="server-io-container svelte-1fv6y8l"><div class="server-column svelte-1fv6y8l"><div class="server-column-header svelte-1fv6y8l">📨 Server Input (What's happening this tick) <span class="status-indicator svelte-1fv6y8l"> </span></div> <div class="server-section svelte-1fv6y8l"><h4 class="svelte-1fv6y8l">🖥️ Server Transactions</h4> <div class="server-txs-list"><!></div></div> <div class="server-section svelte-1fv6y8l"><h4 class="svelte-1fv6y8l">🔄 Entity Inputs</h4> <div class="entity-inputs-list"><!></div></div></div> <div class="server-column svelte-1fv6y8l"><div class="server-column-header svelte-1fv6y8l">📤 Server Output (What's being sent and where) <span class="status-indicator svelte-1fv6y8l"> </span></div> <div class="server-section svelte-1fv6y8l"><h4 class="svelte-1fv6y8l">🚀 Entity Outputs</h4> <div class="entity-outputs-list"><!></div></div></div></div></div>`),Kr=T('<div class="history-io-section svelte-1fv6y8l"><div class="history-header svelte-1fv6y8l"><h3 class="svelte-1fv6y8l">📊 Transaction History & I/O</h3> <button> </button></div> <!></div>');function Zr(s,t){Ke(t,!1);const[a,d]=Xt(),l=()=>Ge(Mt,"$timeState",a),c=()=>Ge(Ct,"$xlnEnvironment",a),u=re(),b=re(),r=re();let g=re(!1);function y(){h(g,!e(g))}Pe(()=>(l(),c()),()=>{h(u,l().isLive?null:c()?.history?.[l().currentTimeIndex])}),Pe(()=>e(u),()=>{h(b,e(u)?.serverInput||{serverTxs:[],entityInputs:[]})}),Pe(()=>e(u),()=>{h(r,e(u)?.serverOutputs||[])}),Ft(),ot();var m=Kr(),x=n(m),k=o(n(x),2);let f;var C=n(k,!0);i(k),i(x);var w=o(x,2);{var I=O=>{var H=Yr(),F=n(H),A=n(F),S=n(A),$=o(n(S)),J=n($,!0);i($),i(S);var fe=o(S,2),ee=o(n(fe),2),L=n(ee);{var ve=U=>{var ie=ze(),pe=Ce(ie);Je(pe,1,()=>(e(b),v(()=>e(b).serverTxs)),nt,(we,G)=>{var de=qr(),Se=n(de),le=n(Se);i(Se);var ne=o(Se);i(de),W(()=>{M(le,`🖥️ ${e(G),v(()=>e(G).type)??""}`),M(ne,`: ${e(G),v(()=>e(G).entityId)??""}:${e(G),v(()=>e(G).signerId)??""}
                    ${e(G),v(()=>e(G).data.isProposer?" (👑 Proposer)":" (✅ Validator)")??""}`)}),p(we,de)}),p(U,ie)},P=U=>{var ie=Rr();p(U,ie)};B(L,U=>{e(b),v(()=>e(b).serverTxs.length>0)?U(ve):U(P,!1)})}i(ee),i(fe);var E=o(fe,2),N=o(n(E),2),K=n(N);{var be=U=>{var ie=ze(),pe=Ce(ie);Je(pe,1,()=>(e(b),v(()=>e(b).entityInputs)),nt,(we,G)=>{var de=Hr(),Se=n(de),le=n(Se);i(Se);var ne=o(Se,2);{var Ie=D=>{var _=Br(),he=o(Ce(_),2),De=n(he);i(he);var Le=o(he,2);Je(Le,1,()=>(e(G),v(()=>e(G).entityTxs)),nt,(ge,X,te)=>{var ke=Ur(),Ae=o(Ce(ke));W(()=>M(Ae,` ${te+1}. ${e(X),v(()=>e(X).type==="chat"?`💬 Chat: "${e(X).data.message}"`:e(X).type==="propose"?`📝 Propose: "${e(X).data.action.data.message}"`:e(X).type==="vote"?`🗳️ Vote: ${e(X).data.choice}`:`⚙️ ${e(X).type}`)??""}`)),p(ge,ke)}),W(()=>M(De,`${e(G),v(()=>e(G).entityTxs.length)??""} transactions:`)),p(D,_)};B(ne,D=>{e(G),v(()=>e(G).entityTxs&&e(G).entityTxs.length>0)&&D(Ie)})}i(de),W(D=>M(le,`Entity #${D??""}:${e(G),v(()=>e(G).signerId)??""}`),[()=>(z(We),e(G),v(()=>We(e(G).entityId)))]),p(we,de)}),p(U,ie)},se=U=>{var ie=Vr();p(U,ie)};B(K,U=>{e(b),v(()=>e(b).entityInputs.length>0)?U(be):U(se,!1)})}i(N),i(E),i(A);var Z=o(A,2),R=n(Z),q=o(n(R)),ce=n(q,!0);i(q),i(R);var me=o(R,2),$e=o(n(me),2),je=n($e);{var ae=U=>{var ie=ze(),pe=Ce(ie);Je(pe,1,()=>e(r),nt,(we,G,de)=>{var Se=Xr(),le=n(Se),ne=n(le);i(le);var Ie=o(le,2);{var D=_=>{var he=Wr(),De=o(Ce(he),2),Le=n(De);i(De);var ge=o(De,2);Je(ge,1,()=>(e(G),v(()=>e(G).entityTxs)),nt,(X,te,ke)=>{var Ae=Jr(),Ne=o(Ce(Ae));W(()=>M(Ne,` ${ke+1}. ${e(te),v(()=>e(te).type==="chat"?`💬 Chat: "${e(te).data.message}"`:e(te).type==="propose"?`📝 Propose: "${e(te).data.action.data.message}"`:e(te).type==="vote"?`🗳️ Vote: ${e(te).data.choice}`:e(te).type==="accountInput"?`💳 AccountInput: ${e(te).data.accountTx?.type||"unknown"}`:`⚙️ ${e(te).type}`)??""}`)),p(X,Ae)}),W(()=>M(Le,`${e(G),v(()=>e(G).entityTxs.length)??""} transactions:`)),p(_,he)};B(Ie,_=>{e(G),v(()=>e(G).entityTxs&&e(G).entityTxs.length>0)&&_(D)})}i(Se),W(_=>M(ne,`📤 ${de+1}. → Entity #${_??""}:${e(G),v(()=>e(G).signerId)??""}`),[()=>(z(We),e(G),v(()=>We(e(G).entityId)))]),p(we,Se)}),p(U,ie)},V=U=>{var ie=Gr();p(U,ie)};B(je,U=>{e(r),v(()=>e(r).length>0)?U(ae):U(V,!1)})}i($e),i(me),i(Z),i(F),i(H),W(()=>{M(J,(l(),v(()=>l().isLive?"⚡ Current":"🕰️ Historical"))),M(ce,(l(),v(()=>l().isLive?"⚡ Current":"🕰️ Historical")))}),p(O,H)};B(w,O=>{e(g)||O(I)})}i(m),W(O=>{f=He(k,1,"collapse-btn svelte-1fv6y8l",null,f,O),M(C,e(g)?"▶":"▼")},[()=>({collapsed:e(g)})]),ue("click",k,y),p(s,m),Ze(),d()}const Qr=Wt(null),el=Wt(!1);let es=null,Ss=null;async function Ii(){return Ss?(console.log("🔍 JURISDICTIONS: Returning cached data (no fetch)"),Ss):es?(console.log("🔍 JURISDICTIONS: Reusing existing load promise"),es):(es=(async()=>{try{console.log("🔍 JURISDICTIONS: Loading ONCE from server (single source)");const{getXLN:s}=await on(async()=>{const{getXLN:l}=await Promise.resolve().then(()=>_n);return{getXLN:l}},[],import.meta.url),a=await(await s()).getAvailableJurisdictions(),d={version:"1.0.0",lastUpdated:new Date().toISOString(),jurisdictions:{},defaults:{timeout:3e4,retryAttempts:3,gasLimit:1e6}};return a.forEach(l=>{const c=l.address.split(":").pop();d.jurisdictions[l.name.toLowerCase()]={name:l.name,chainId:l.chainId,rpc:l.address,contracts:{entityProvider:l.entityProviderAddress,depository:l.depositoryAddress},explorer:l.address,currency:l.name==="Ethereum"?"ETH":"TOKEN",status:"active"}}),console.log("🔍 SINGLE LOAD: Loaded contracts from server:",d.jurisdictions?.ethereum?.contracts),Ss=d,Qr.set(d),el.set(!0),d}catch(s){throw console.error("❌ Failed to load jurisdictions from server:",s),s}})(),es)}var tl=T("<button><!></button>");function Ts(s,t){let a=Y(t,"variant",8,"primary"),d=Y(t,"size",8,"medium"),l=Y(t,"disabled",8,!1),c=Y(t,"type",8,"button");var u=tl(),b=n(u);vn(b,t,"default",{}),i(u),W(()=>{He(u,1,`btn btn-${a()??""} btn-${d()??""}`,"svelte-1ygej4b"),u.disabled=l(),qe(u,"type",c())}),ue("click",u,function(r){qs.call(this,t,r)}),p(s,u)}var al=T("<option> </option>"),sl=T("<strong>🔒 Lazy:</strong> Free to create, entityId = hash(validators), works immediately.",1),il=T("<strong>🔢 Numbered:</strong> Small gas cost, get sequential number like #42, on-chain registered. <strong>✨ PREFUNDED with 1M tokens for testing!</strong>",1),nl=T('<strong>🏷️ Named:</strong> Premium gas + admin approval, get custom name like "coinbase".',1),ol=T('<button type="button" class="btn btn-danger btn-small svelte-mp6wtl">❌</button>'),rl=T('<div class="validator-row svelte-mp6wtl"><select class="validator-name svelte-mp6wtl"><option>Select signer...</option><option>s1 (Default)</option><option>s2</option><option>s3</option><option>s4</option><option>s5</option></select> <input type="number" class="validator-weight svelte-mp6wtl" min="1" placeholder="1"/> <!></div>'),ll=T('<div class="threshold-section svelte-mp6wtl"><label for="thresholdSlider" class="svelte-mp6wtl"> </label> <input type="range" id="thresholdSlider" min="1" class="threshold-slider svelte-mp6wtl"/> <div class="threshold-info svelte-mp6wtl"><span>Total Weight: <strong class="svelte-mp6wtl"> </strong></span> <span>Required: <strong class="svelte-mp6wtl"> </strong></span></div></div>'),cl=T('<div class="quorum-hash-section svelte-mp6wtl"><h4 class="svelte-mp6wtl">🔐 Quorum Hash</h4> <div class="hash-display svelte-mp6wtl"><code class="svelte-mp6wtl"> </code></div> <small class="svelte-mp6wtl">This hash is calculated from your validators and threshold. It will be your entity ID.</small></div>'),dl=T('<div class="error-message svelte-mp6wtl"> </div>'),vl=T('<div class="entity-formation svelte-mp6wtl"><div class="formation-panel svelte-mp6wtl"><div class="formation-group svelte-mp6wtl"><label for="jurisdictionSelect" class="svelte-mp6wtl">🏛️ Jurisdiction:</label> <select id="jurisdictionSelect" class="svelte-mp6wtl"></select> <div class="jurisdiction-info svelte-mp6wtl"><small class="svelte-mp6wtl"><strong>📡 Network:</strong> <br/> <strong>🔗 RPC Port:</strong> </small></div></div> <div class="formation-group svelte-mp6wtl"><label for="entityTypeSelect" class="svelte-mp6wtl">🆔 Entity Type:</label> <select id="entityTypeSelect" class="svelte-mp6wtl"><option>🔢 Numbered Entity (Gas Required - Sequential ID) [PREFUNDED]</option><option>🔒 Lazy Entity (Free - ID = Quorum Hash)</option><option>🏷️ Named Entity (Premium Gas + Admin Approval)</option></select> <div class="entity-type-info svelte-mp6wtl"><small class="svelte-mp6wtl"><!></small></div></div> <div class="formation-group svelte-mp6wtl"><label for="entityNameInput" class="svelte-mp6wtl">🏷️ Entity Name:</label> <input type="text" id="entityNameInput" placeholder="e.g., trading, chat, governance" class="svelte-mp6wtl"/> <small class="svelte-mp6wtl">Display name for your entity</small></div> <div class="validators-section svelte-mp6wtl"><h4 class="svelte-mp6wtl">👥 Validators:</h4> <div class="validators-list svelte-mp6wtl"></div> <button type="button" class="btn btn-secondary svelte-mp6wtl">➕ Add Validator</button> <small class="svelte-mp6wtl">💡 Start with a single signer for personal use, or add more for multisig/corporate entities</small></div> <!> <!> <div class="expected-id-section svelte-mp6wtl"><h4 class="svelte-mp6wtl">🆔 Expected Entity ID</h4> <div class="id-display svelte-mp6wtl"><code class="svelte-mp6wtl"> </code></div> <small class="svelte-mp6wtl"><!></small></div> <!> <div class="button-group svelte-mp6wtl"><button class="btn btn-primary svelte-mp6wtl"> </button> <button class="btn btn-secondary svelte-mp6wtl">🗑️ Clear Form</button></div></div></div>');function ul(s,t){Ke(t,!1);const[a,d]=Xt(),l=()=>Ge(Ct,"$xlnEnvironment",a),c=re(),u=re(),b=re();let r=re({jurisdiction:"",entityType:"numbered",entityName:"ACME",validators:[{name:"s1",weight:1}],threshold:1}),g=re(!1),y=re(""),m=re(!1);ga(async()=>{const Q=e(r).validators.reduce((oe,xe)=>oe+xe.weight,0);Dt(r,e(r).threshold=Q),await J()});function x(){Dt(r,e(r).validators=[...e(r).validators,{name:"",weight:1}]),C()}function k(Q){e(r).validators.length>1&&(Dt(r,e(r).validators=e(r).validators.filter((oe,xe)=>xe!==Q)),e(r).validators.length===1?w():C())}function f(){const Q=e(r).validators.reduce((oe,xe)=>oe+xe.weight,0);e(r).threshold>Q&&Dt(r,e(r).threshold=Q)}function C(){const Q=e(r).validators.reduce((oe,xe)=>oe+xe.weight,0);Dt(r,e(r).threshold=Q),h(m,!1)}function w(){e(r).validators.length===1&&(Dt(r,e(r).threshold=1),h(m,!1))}function I(){h(m,!0)}async function O(){if(!e(g)){h(y,""),h(g,!0);try{if(!e(r).entityName.trim())throw new Error("Entity name is required");if(e(r).validators.some(Ye=>!Ye.name.trim()))throw new Error("All validators must have names");const Q=e(r).validators.reduce((Ye,It)=>Ye+It.weight,0);if(e(r).threshold>Q)throw new Error("Threshold cannot exceed total weight");const oe=await St(),xe=l();if(!xe)throw new Error("XLN environment not ready");const Te=e(r).validators.map(Ye=>Ye.name),_e=BigInt(e(r).threshold),Ee=$[e(r).jurisdiction];if(!Ee)throw new Error("Selected jurisdiction not found");const Me={name:Ee.name,address:Ee.rpc,entityProviderAddress:Ee.contracts.entityProvider,depositoryAddress:Ee.contracts.depository,chainId:Ee.chainId};let et,it;if(e(r).entityType==="lazy"){if(it=oe.generateLazyEntityId(Te,_e),Array.from(xe.replicas.keys()).some(qt=>qt.startsWith(it+":")))throw new Error(`⚠️ This validator configuration already exists! Entity #${We(it)} is already in use. Try different validators or weights to create a unique entity.`);et=oe.createLazyEntity(e(r).entityName,Te,_e,Me),console.log("✅ Lazy entity config created:",et),console.log("✅ Entity ID: #",We(it))}else{const Ye=await oe.createNumberedEntity(e(r).entityName,Te,_e,Me);et=Ye.config,it=Ye.entityId,console.log("✅ Numbered entity config created:",Ye)}console.log(`🔍 Creating serverTxs with entityId: ${it}`);const Tt=Te.map((Ye,It)=>({type:"importReplica",entityId:it,signerId:Ye,data:{config:et,isProposer:It===0}}));console.log(`🔍 Generated ${Tt.length} serverTxs:`,Tt);const At=await oe.applyServerInput(xe,{serverTxs:Tt,entityInputs:[]});console.log("🔥 Processing entity creation through server..."),await oe.processUntilEmpty(xe,At.entityOutbox),console.log("✅ Entity creation complete!"),console.log(`💰 Entity #${We(it)} automatically prefunded by Depository.sol contract during deployment`),console.log("🔄 J-Watcher will sync historical ReserveUpdated events to populate reserves");const Nt=Ee?.name||"Unknown";console.log(`🎯 Auto-creating ${Te.length} panels with entity and signers pre-selected`),console.log(`🌐 Jurisdiction: ${e(r).jurisdiction} → ${Nt}`);for(let Ye=0;Ye<Te.length;Ye++){const It=Te[Ye];console.log(`📋 Creating panel ${Ye+1} for Entity #${We(it)} with signer: ${It} on ${Nt}`),Ia.addTab(it,It,Nt)}console.log(`✅ ${Te.length} panels auto-created with replicas selected!`),H()}catch(Q){h(y,Q instanceof Error?Q.message:"Failed to create entity")}finally{h(g,!1)}}}function H(){h(r,{jurisdiction:"",entityType:"numbered",entityName:"ACME",validators:[{name:"s1",weight:1}],threshold:1}),h(y,""),h(m,!1);const Q=e(r).validators.reduce((oe,xe)=>oe+xe.weight,0);Dt(r,e(r).threshold=Q)}function F(Q,oe){const Te=`${Q.map(Ee=>`${Ee.name}:${Ee.weight}`).sort().join(",")}|${oe}`;let _e=0;for(let Ee=0;Ee<Te.length;Ee++){const Me=Te.charCodeAt(Ee);_e=(_e<<5)-_e+Me,_e=_e&_e}return Math.abs(_e).toString(16).padStart(8,"0")}function A(Q,oe){return Q==="lazy"?`0x${oe}`:Q==="numbered"?"#42":"custom-name"}let S=re([]),$={};async function J(){try{const Q=await Ii();if(h(S,Object.entries(Q.jurisdictions).map(([oe,xe])=>{const Te=xe.rpc.split(":").pop();return $[Te]=xe,{value:Te,label:`${xe.name} (Port ${Te})`}})),e(S).length>0&&!e(r).jurisdiction){const oe=e(S).find(xe=>xe.label.includes("Ethereum"));Dt(r,e(r).jurisdiction=oe?oe.value:e(S)[0].value),console.log("🔍 Defaulted jurisdiction to:",e(r).jurisdiction)}console.log(`✅ Loaded ${e(S).length} jurisdiction options from store:`,e(S))}catch(Q){console.error("❌ Failed to load jurisdiction options:",Q),h(S,[])}}Pe(()=>e(r),()=>{h(c,e(r).validators.reduce((Q,oe)=>Q+oe.weight,0))}),Pe(()=>(e(r),e(c)),()=>{e(r).threshold>e(c)&&Dt(r,e(r).threshold=e(c))}),Pe(()=>(e(r),e(m)),()=>{const Q=e(r).validators.reduce((oe,xe)=>oe+xe.weight,0);!e(m)&&Q>0&&(e(r).validators.length===1?Dt(r,e(r).threshold=1):Dt(r,e(r).threshold=Q))}),Pe(()=>e(r),()=>{h(u,e(r).entityType==="lazy"?F(e(r).validators,e(r).threshold):"")}),Pe(()=>(e(r),e(u)),()=>{h(b,A(e(r).entityType,e(u)))}),Ft(),ot();var fe=vl(),ee=n(fe),L=n(ee),ve=o(n(L),2);W(()=>{e(r),Jt(()=>{e(S)})}),Je(ve,5,()=>e(S),nt,(Q,oe)=>{var xe=al(),Te=n(xe,!0);i(xe);var _e={};W(()=>{M(Te,(e(oe),v(()=>e(oe).label))),_e!==(_e=(e(oe),v(()=>e(oe).value)))&&(xe.value=(xe.__value=(e(oe),v(()=>e(oe).value)))??"")}),p(Q,xe)}),i(ve);var P=o(ve,2),E=n(P),N=o(n(E)),K=o(N,4);i(E),i(P),i(L);var be=o(L,2),se=o(n(be),2);W(()=>{e(r),Jt(()=>{})});var Z=n(se);Z.value=Z.__value="numbered";var R=o(Z);R.value=R.__value="lazy";var q=o(R);q.value=q.__value="named",i(se);var ce=o(se,2),me=n(ce),$e=n(me);{var je=Q=>{var oe=sl();Et(),p(Q,oe)},ae=Q=>{var oe=ze(),xe=Ce(oe);{var Te=Ee=>{var Me=il();Et(2),p(Ee,Me)},_e=Ee=>{var Me=nl();Et(),p(Ee,Me)};B(xe,Ee=>{e(r),v(()=>e(r).entityType==="numbered")?Ee(Te):Ee(_e,!1)},!0)}p(Q,oe)};B($e,Q=>{e(r),v(()=>e(r).entityType==="lazy")?Q(je):Q(ae,!1)})}i(me),i(ce),i(be);var V=o(be,2),U=o(n(V),2);ft(U),Et(2),i(V);var ie=o(V,2),pe=o(n(ie),2);Je(pe,5,()=>(e(r),v(()=>e(r).validators)),nt,(Q,oe,xe)=>{var Te=rl(),_e=n(Te);W(()=>{e(oe),Jt(()=>{})});var Ee=n(_e);Ee.value=Ee.__value="";var Me=o(Ee);Me.value=Me.__value="s1";var et=o(Me);et.value=et.__value="s2";var it=o(et);it.value=it.__value="s3";var Tt=o(it);Tt.value=Tt.__value="s4";var At=o(Tt);At.value=At.__value="s5",i(_e);var Nt=o(_e,2);ft(Nt);var Ye=o(Nt,2);{var It=qt=>{var ra=ol();ue("click",ra,()=>k(xe)),p(qt,ra)};B(Ye,qt=>{e(r),v(()=>e(r).validators.length>1)&&qt(It)})}i(Te),ta(_e,()=>e(oe).name,qt=>(e(oe).name=qt,Jt(()=>e(r)))),wt(Nt,()=>e(oe).weight,qt=>(e(oe).weight=qt,Jt(()=>e(r)))),ue("input",Nt,()=>{f(),e(m)||C()}),p(Q,Te)}),i(pe);var we=o(pe,2);Et(2),i(ie);var G=o(ie,2);{var de=Q=>{var oe=ll(),xe=n(oe),Te=n(xe);i(xe);var _e=o(xe,2);ft(_e);var Ee=o(_e,2),Me=n(Ee),et=o(n(Me)),it=n(et,!0);i(et),i(Me);var Tt=o(Me,2),At=o(n(Tt)),Nt=n(At,!0);i(At),i(Tt),i(Ee),i(oe),W(()=>{M(Te,`🎯 Threshold: ${e(r),v(()=>e(r).threshold)??""}`),qe(_e,"max",e(c)),M(it,e(c)),M(Nt,(e(r),v(()=>e(r).threshold)))}),wt(_e,()=>e(r).threshold,Ye=>Dt(r,e(r).threshold=Ye)),ue("input",_e,I),p(Q,oe)};B(G,Q=>{e(r),v(()=>e(r).validators.length>1)&&Q(de)})}var Se=o(G,2);{var le=Q=>{var oe=cl(),xe=o(n(oe),2),Te=n(xe),_e=n(Te,!0);i(Te),i(xe),Et(2),i(oe),W(()=>M(_e,e(u))),p(Q,oe)};B(Se,Q=>{e(r),v(()=>e(r).entityType==="lazy")&&Q(le)})}var ne=o(Se,2),Ie=o(n(ne),2),D=n(Ie),_=n(D,!0);i(D),i(Ie);var he=o(Ie,2),De=n(he);{var Le=Q=>{var oe=pt("This will be your entity's unique identifier, derived from the quorum hash.");p(Q,oe)},ge=Q=>{var oe=ze(),xe=Ce(oe);{var Te=Ee=>{var Me=pt("This will be your entity's sequential number (actual number may vary).");p(Ee,Me)},_e=Ee=>{var Me=pt("This will be your custom entity name (subject to admin approval).");p(Ee,Me)};B(xe,Ee=>{e(r),v(()=>e(r).entityType==="numbered")?Ee(Te):Ee(_e,!1)},!0)}p(Q,oe)};B(De,Q=>{e(r),v(()=>e(r).entityType==="lazy")?Q(Le):Q(ge,!1)})}i(he),i(ne);var X=o(ne,2);{var te=Q=>{var oe=dl(),xe=n(oe);i(oe),W(()=>M(xe,`❌ ${e(y)??""}`)),p(Q,oe)};B(X,Q=>{e(y)&&Q(te)})}var ke=o(X,2),Ae=n(ke),Ne=n(Ae,!0);i(Ae);var Ve=o(Ae,2);i(ke),i(ee),i(fe),W(Q=>{M(N,` ${Q??""}`),M(K,` ${e(r),v(()=>e(r).jurisdiction)??""}`),M(_,e(b)),Ae.disabled=e(g),M(Ne,e(g)?"🔄 Creating...":"🚀 Create Entity"),Ve.disabled=e(g)},[()=>(e(S),e(r),v(()=>e(S).find(Q=>Q.value===e(r).jurisdiction)?.label.split(" (")[0]||"Unknown"))]),ta(ve,()=>e(r).jurisdiction,Q=>Dt(r,e(r).jurisdiction=Q)),ta(se,()=>e(r).entityType,Q=>Dt(r,e(r).entityType=Q)),wt(U,()=>e(r).entityName,Q=>Dt(r,e(r).entityName=Q)),ue("click",we,x),ue("click",Ae,O),ue("click",Ve,H),p(s,fe),Ze(),d()}var pl=T('<div class="entity-item svelte-eib5f9"><strong> </strong> <div class="entity-type svelte-eib5f9"> </div></div>'),fl=T('<div class="no-entities svelte-eib5f9"> </div>'),ml=T('<div class="jurisdiction-card svelte-eib5f9"><div class="jurisdiction-header svelte-eib5f9"><h4 class="svelte-eib5f9"> </h4> <span><!></span></div> <div class="jurisdiction-details svelte-eib5f9"><div class="detail-row svelte-eib5f9"><span class="svelte-eib5f9">📡 RPC Port:</span> <span class="svelte-eib5f9"> </span></div> <div class="detail-row svelte-eib5f9"><span class="svelte-eib5f9">🔗 Chain ID:</span> <span class="svelte-eib5f9"> </span></div> <div class="detail-row svelte-eib5f9"><span class="svelte-eib5f9">📊 Block Number:</span> <span class="svelte-eib5f9"> </span></div> <div class="detail-row svelte-eib5f9"><span class="svelte-eib5f9">⏰ Last Update:</span> <span class="svelte-eib5f9"> </span></div> <div class="detail-row svelte-eib5f9"><span class="svelte-eib5f9">📝 Contract:</span> <span class="contract-address svelte-eib5f9"> </span></div> <div class="detail-row svelte-eib5f9"><span class="svelte-eib5f9">🔢 Next Entity #:</span> <span class="svelte-eib5f9"> </span></div></div> <div class="entities-section svelte-eib5f9"><h5 class="svelte-eib5f9">📋 Registered Entities:</h5> <div class="entities-list svelte-eib5f9"><!></div></div> <div class="jurisdiction-actions svelte-eib5f9"><!></div></div>'),hl=T('<div class="jurisdictions-panel svelte-eib5f9"><h3 class="svelte-eib5f9">🏛️ Blockchain Jurisdictions Status</h3> <div class="jurisdiction-grid svelte-eib5f9"></div> <div class="global-actions svelte-eib5f9"><!> <!></div></div>');function gl(s,t){Ke(t,!1);let a=re([]);async function d(){try{const x=await Ii();h(a,Object.entries(x.jurisdictions).map(([k,f])=>({port:parseInt(f.rpc.split(":").pop()),name:f.name,icon:k==="ethereum"?"🔷":k==="polygon"?"🟣":"🔵",chainId:f.chainId.toString(),blockNumber:0,contractAddress:f.contracts.entityProvider,nextEntityNumber:1,status:"checking",lastUpdate:"",entities:[]}))),console.log(`✅ Loaded ${e(a).length} jurisdictions from centralized store:`,e(a).map(k=>k.name))}catch(x){console.error("❌ Failed to load jurisdictions from store:",x),h(a,[])}}async function l(x){x.status="checking",x.lastUpdate="Checking...";try{const k=await fetch(`http://localhost:${x.port}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({jsonrpc:"2.0",method:"eth_blockNumber",params:[],id:1})});if(!k.ok)throw new Error("Network unavailable");const f=await k.json();if(f.error)throw new Error(f.error.message);x.blockNumber=parseInt(f.result,16),x.status="connected",x.lastUpdate=new Date().toLocaleTimeString(),x.contractAddress="0x1234...5678",x.nextEntityNumber=Math.floor(Math.random()*100)+1,x.entities=[{id:"#1",name:"Demo Entity",type:"Numbered"},{id:"#2",name:"Test Entity",type:"Numbered"}]}catch{x.status="disconnected",x.lastUpdate="Failed",x.contractAddress="Not available",x.nextEntityNumber=0,x.entities=[]}h(a,[...e(a)])}async function c(){for(const x of e(a))await l(x)}ga(async()=>{await d(),e(a).length>0&&c()});async function u(){alert("Contract deployment feature coming soon! For now, use: cd contracts && npx hardhat ignition deploy ignition/modules/Depository.ts --network localhost")}ot();var b=hl(),r=o(n(b),2);Je(r,5,()=>e(a),nt,(x,k)=>{var f=ml(),C=n(f),w=n(C),I=n(w);i(w);var O=o(w,2),H=n(O);{var F=G=>{var de=pt("✅ Connected");p(G,de)},A=G=>{var de=ze(),Se=Ce(de);{var le=Ie=>{var D=pt("❌ Disconnected");p(Ie,D)},ne=Ie=>{var D=pt("🔄 Checking...");p(Ie,D)};B(Se,Ie=>{e(k).status==="disconnected"?Ie(le):Ie(ne,!1)},!0)}p(G,de)};B(H,G=>{e(k).status==="connected"?G(F):G(A,!1)})}i(O),i(C);var S=o(C,2),$=n(S),J=o(n($),2),fe=n(J,!0);i(J),i($);var ee=o($,2),L=o(n(ee),2),ve=n(L,!0);i(L),i(ee);var P=o(ee,2),E=o(n(P),2),N=n(E,!0);i(E),i(P);var K=o(P,2),be=o(n(K),2),se=n(be,!0);i(be),i(K);var Z=o(K,2),R=o(n(Z),2),q=n(R,!0);i(R),i(Z);var ce=o(Z,2),me=o(n(ce),2),$e=n(me);i(me),i(ce),i(S);var je=o(S,2),ae=o(n(je),2),V=n(ae);{var U=G=>{var de=ze(),Se=Ce(de);Je(Se,1,()=>e(k).entities,nt,(le,ne)=>{var Ie=pl(),D=n(Ie),_=n(D,!0);i(D);var he=o(D),De=o(he),Le=n(De,!0);i(De),i(Ie),W(()=>{M(_,e(ne).id),M(he,`: ${e(ne).name??""} `),M(Le,e(ne).type)}),p(le,Ie)}),p(G,de)},ie=G=>{var de=fl(),Se=n(de,!0);i(de),W(()=>M(Se,e(k).status==="connected"?"No entities registered yet":"Connection required")),p(G,de)};B(V,G=>{e(k).entities.length>0?G(U):G(ie,!1)})}i(ae),i(je);var pe=o(je,2),we=n(pe);{let G=Ot(()=>e(k).status==="checking");Ts(we,{variant:"secondary",size:"small",get disabled(){return e(G)},$$events:{click:()=>l(e(k))},children:(de,Se)=>{Et();var le=pt("🔄 Refresh");p(de,le)},$$slots:{default:!0}})}i(pe),i(f),W(()=>{qe(f,"id",`jurisdiction-${e(k).port??""}`),M(I,`${e(k).icon??""} ${e(k).name??""}`),He(O,1,`connection-status ${e(k).status??""}`,"svelte-eib5f9"),M(fe,e(k).port),M(ve,e(k).chainId),M(N,e(k).blockNumber),M(se,e(k).lastUpdate),M(q,e(k).contractAddress),M($e,`#${e(k).nextEntityNumber??""}`)}),p(x,f)}),i(r);var g=o(r,2),y=n(g);Ts(y,{variant:"primary",$$events:{click:c},children:(x,k)=>{Et();var f=pt("🔄 Refresh All");p(x,f)},$$slots:{default:!0}});var m=o(y,2);Ts(m,{variant:"secondary",$$events:{click:u},children:(x,k)=>{Et();var f=pt("🚀 Deploy Contracts");p(x,f)},$$slots:{default:!0}}),i(g),i(b),p(s,b),Ze()}var yl=T('<div class="hub-badge svelte-1goz6vk">🌟 Hub</div>'),bl=T('<span class="capability-tag svelte-1goz6vk"> </span>'),_l=T('<div class="capabilities-section svelte-1goz6vk"><h4 class="svelte-1goz6vk">🔧 Capabilities</h4> <div class="capabilities-list svelte-1goz6vk"></div></div>'),wl=T('<span class="hub-tag svelte-1goz6vk"> </span>'),xl=T('<div class="hubs-section svelte-1goz6vk"><h4 class="svelte-1goz6vk">🔗 Connected Hubs</h4> <div class="hubs-list svelte-1goz6vk"></div></div>'),kl=T('<div class="metadata-item svelte-1goz6vk"><span class="metadata-key svelte-1goz6vk"> </span> <span class="metadata-value svelte-1goz6vk"> </span></div>'),Sl=T('<div class="metadata-section svelte-1goz6vk"><h4 class="svelte-1goz6vk">📋 Metadata</h4> <div class="metadata-content svelte-1goz6vk"></div></div>'),Tl=T('<span class="text-muted your-hub svelte-1goz6vk">Your Hub</span>'),Il=T('<span class="text-muted already-joined svelte-1goz6vk">✅ Already joined this hub</span>'),El=T('<small class="action-hint svelte-1goz6vk">Select an entity first</small>'),Cl=T('<button class="join-hub-btn svelte-1goz6vk" data-testid="join-hub-button"><!></button> <!>',1),$l=T('<div class="join-error svelte-1goz6vk"> </div>'),jl=T('<div class="profile-card svelte-1goz6vk" data-testid="profile-card"><div class="profile-header svelte-1goz6vk"><div class="entity-id svelte-1goz6vk"><strong> </strong></div> <!></div> <div class="profile-content svelte-1goz6vk"><!> <!> <!></div> <div class="profile-actions svelte-1goz6vk"><!> <!></div></div>');function Al(s,t){Ke(t,!1);const[a,d]=Xt(),l=()=>Ge(Vt,"$tabs",a),c=()=>Ge(Ct,"$xlnEnvironment",a),u=re(),b=re(),r=re(),g=re(),y=re();let m=Y(t,"profile",8),x=re(!1),k=re(null);function f(R){try{return typeof R=="bigint"?R.toString():typeof R=="object"&&R!==null?JSON.stringify(R,(q,ce)=>typeof ce=="bigint"?ce.toString():ce):String(R)}catch{return String(R)}}async function C(R=m().entityId){if(!e(r)||!e(g)){h(k,"No active entity/signer selected");return}if(!R){h(k,"Invalid target entityId");return}if(e(r)===R){h(k,"Cannot join own hub");return}if(!e(u)){h(k,"Target is not a hub");return}try{h(x,!0),h(k,null),console.log(`🚀 Joining hub: ${e(r)} → ${R}`);const q=await St(),ce=c();if(!ce)throw new Error("XLN environment not ready");await q.processUntilEmpty(ce,[{entityId:e(r),signerId:e(g),entityTxs:[{type:"accountInput",data:{fromEntityId:e(r),toEntityId:R,metadata:{purpose:"hub_connection",description:`Joining hub ${R}`}}}]}]),console.log(`✅ Successfully sent join request to ${R}`)}catch(q){console.error("❌ Failed to join hub:",q),h(k,q instanceof Error?q.message:"Failed to join hub")}finally{h(x,!1)}}Pe(()=>z(m()),()=>{h(u,(m().capabilities?.includes("hub")||m().capabilities?.includes("router"))??!1)}),Pe(()=>l(),()=>{h(b,l().find(R=>R.isActive))}),Pe(()=>e(b),()=>{h(r,e(b)?.entityId)}),Pe(()=>e(b),()=>{h(g,e(b)?.signer)}),Pe(()=>(e(r),c(),e(g),z(m())),()=>{h(y,(()=>{if(!e(r)||!c())return!1;const R=`${e(r)}:${e(g)}`,q=c().replicas?.get(R);return q?.state?.channels?q.state.channels.has(m().entityId):!1})())}),Ft(),ot();var w=jl(),I=n(w),O=n(I),H=n(O),F=n(H);i(H),i(O);var A=o(O,2);{var S=R=>{var q=yl();p(R,q)};B(A,R=>{e(u)&&R(S)})}i(I);var $=o(I,2),J=n($);{var fe=R=>{var q=_l(),ce=o(n(q),2);Je(ce,5,()=>(z(m()),v(()=>m().capabilities)),nt,(me,$e)=>{var je=bl(),ae=n(je,!0);i(je),W(()=>M(ae,e($e))),p(me,je)}),i(ce),i(q),p(R,q)};B(J,R=>{z(m()),v(()=>m().capabilities&&m().capabilities.length>0)&&R(fe)})}var ee=o(J,2);{var L=R=>{var q=xl(),ce=o(n(q),2);Je(ce,5,()=>(z(m()),v(()=>m().hubs)),nt,(me,$e)=>{var je=wl(),ae=n(je,!0);i(je),W(()=>M(ae,e($e))),p(me,je)}),i(ce),i(q),p(R,q)};B(ee,R=>{z(m()),v(()=>m().hubs&&m().hubs.length>0)&&R(L)})}var ve=o(ee,2);{var P=R=>{var q=Sl(),ce=o(n(q),2);Je(ce,5,()=>(z(m()),v(()=>Object.entries(m().metadata))),nt,(me,$e)=>{var je=bt(()=>ls(e($e),2));let ae=()=>e(je)[0],V=()=>e(je)[1];var U=kl(),ie=n(U),pe=n(ie);i(ie);var we=o(ie,2),G=n(we,!0);i(we),i(U),W(de=>{M(pe,`${ae()??""}:`),M(G,de)},[()=>(V(),v(()=>f(V())))]),p(me,U)}),i(ce),i(q),p(R,q)};B(ve,R=>{z(m()),v(()=>m().metadata)&&R(P)})}i($);var E=o($,2),N=n(E);{var K=R=>{var q=Tl();p(R,q)},be=R=>{var q=ze(),ce=Ce(q);{var me=$e=>{var je=ze(),ae=Ce(je);{var V=ie=>{var pe=Il();p(ie,pe)},U=ie=>{var pe=Cl(),we=Ce(pe),G=n(we);{var de=Ie=>{var D=pt("🔄 Joining...");p(Ie,D)},Se=Ie=>{var D=pt("🤝 Join Hub");p(Ie,D)};B(G,Ie=>{e(x)?Ie(de):Ie(Se,!1)})}i(we);var le=o(we,2);{var ne=Ie=>{var D=El();p(Ie,D)};B(le,Ie=>{(!e(r)||!e(g))&&Ie(ne)})}W(()=>we.disabled=e(x)||!e(r)||!e(g)),ue("click",we,()=>C(m().entityId)),p(ie,pe)};B(ae,ie=>{e(y)?ie(V):ie(U,!1)})}p($e,je)};B(ce,$e=>{e(u)&&$e(me)},!0)}p(R,q)};B(N,R=>{z(m()),e(r),v(()=>m().entityId===e(r))?R(K):R(be,!1)})}var se=o(N,2);{var Z=R=>{var q=$l(),ce=n(q);i(q),W(()=>M(ce,`❌ ${e(k)??""}`)),p(R,q)};B(se,R=>{e(k)&&R(Z)})}i(E),i(w),W(R=>M(F,`🏢 ${R??""}`),[()=>(e(u),z(m()),z(We),v(()=>e(u)?m().metadata?.name||`Hub #${We(m().entityId)}`:`Entity #${We(m().entityId)}`))]),p(s,w),Ze(),d()}var Nl=T('<div class="svelte-66wdl1"></div>');function Ll(s,t){let a=Y(t,"color",19,()=>"cornflowerblue"),d=Y(t,"duration",19,()=>"1.5s"),l=Y(t,"size",19,()=>"1em");var c=Nl();let u;W(b=>u=vt(c,`--duration: ${d()??""}`,u,b),[()=>({"border-color":`${a()??""} transparent ${a()??""}
  ${a()??""}`,width:l(),height:l()})]),p(s,c)}Wa(["click"]);Wa(["click"]);const Is={Alert:{viewBox:"0 0 16 16",path:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"},Check:{viewBox:"0 0 12 16",path:"M12 5l-8 8l-4-4l1.5-1.5L4 10l6.5-6.5L12 5z"},ChevronExpand:{viewBox:"0 0 16 16",path:"M3.646 9.146a.5.5 0 0 1 .708 0L8 12.793l3.646-3.647a.5.5 0 0 1 .708.708l-4 4a.5.5 0 0 1-.708 0l-4-4a.5.5 0 0 1 0-.708zm0-2.292a.5.5 0 0 0 .708 0L8 3.207l3.646 3.647a.5.5 0 0 0 .708-.708l-4-4a.5.5 0 0 0-.708 0l-4 4a.5.5 0 0 0 0 .708z"},Collapse:{viewBox:"0 0 24 24",path:"M12 7.59L7.05 2.64L5.64 4.05L12 10.41l6.36-6.36l-1.41-1.41L12 7.59zM5.64 19.95l1.41 1.41L12 16.41l4.95 4.95l1.41-1.41L12 13.59l-6.36 6.36z"},Copy:{viewBox:"0 0 16 16",path:"M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 0 1 0 1.5h-1.5a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-1.5a.75.75 0 0 1 1.5 0v1.5A1.75 1.75 0 0 1 9.25 16h-7.5A1.75 1.75 0 0 1 0 14.25Z M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0 1 14.25 11h-7.5A1.75 1.75 0 0 1 5 9.25Zm1.75-.25a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-7.5a.25.25 0 0 0-.25-.25Z"},Cross:{viewBox:"0 0 24 24",path:"M18.3 5.71a.996.996 0 0 0-1.41 0L12 10.59L7.11 5.7A.996.996 0 1 0 5.7 7.11L10.59 12L5.7 16.89a.996.996 0 1 0 1.41 1.41L12 13.41l4.89 4.89a.996.996 0 1 0 1.41-1.41L13.41 12l4.89-4.89c.38-.38.38-1.02 0-1.4z"},Disabled:{viewBox:"0 0 24 24",path:"M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2S2 6.477 2 12s4.477 10 10 10Zm-4.906-3.68L18.32 7.094A8 8 0 0 1 7.094 18.32ZM5.68 16.906A8 8 0 0 1 16.906 5.68L5.68 16.906Z"},Expand:{viewBox:"0 0 24 24",path:"m12 19.24l-4.95-4.95l-1.41 1.42L12 22.07l6.36-6.36l-1.41-1.42L12 19.24zM5.64 8.29l1.41 1.42L12 4.76l4.95 4.95l1.41-1.42L12 1.93L5.64 8.29z"},GitHub:{viewBox:"0 0 24 24",path:"M8.422 20.081c0 .896.01 1.753.016 2.285a.617.617 0 0 0 .422.58c2.078.686 4.317.718 6.414.091l.292-.087a.67.67 0 0 0 .478-.638c.005-.733.017-2.017.017-3.53c0-1.372-.477-2.25-1.031-2.707c3.399-.366 6.97-1.61 6.97-7.227c0-1.61-.592-2.91-1.566-3.934c.153-.366.688-1.866-.153-3.878c0 0-1.28-.403-4.201 1.5a14.76 14.76 0 0 0-3.82-.494c-1.298 0-2.597.165-3.819.494C5.52.65 4.24 1.036 4.24 1.036c-.84 2.012-.306 3.512-.153 3.878a5.565 5.565 0 0 0-1.566 3.934c0 5.598 3.552 6.86 6.951 7.227c-.439.366-.84 1.006-.973 1.957c-.879.384-3.075 1.006-4.45-1.207c-.286-.44-1.146-1.519-2.349-1.5c-1.28.018-.516.695.02.97c.648.347 1.393 1.646 1.565 2.067c.306.823 1.299 2.396 5.137 1.72Z"},StackBlitz:{viewBox:"0 0 24 24",path:"M10.797 14.182H3.635L16.728 0l-3.525 9.818h7.162L7.272 24l3.524-9.818Z"},Svelte:{viewBox:"0 0 24 24",path:"M10.354 21.125a4.44 4.44 0 0 1-4.765-1.767a4.109 4.109 0 0 1-.703-3.107a3.898 3.898 0 0 1 .134-.522l.105-.321l.287.21a7.21 7.21 0 0 0 2.186 1.092l.208.063l-.02.208a1.253 1.253 0 0 0 .226.83a1.337 1.337 0 0 0 1.435.533a1.231 1.231 0 0 0 .343-.15l5.59-3.562a1.164 1.164 0 0 0 .524-.778a1.242 1.242 0 0 0-.211-.937a1.338 1.338 0 0 0-1.435-.533a1.23 1.23 0 0 0-.343.15l-2.133 1.36a4.078 4.078 0 0 1-1.135.499a4.44 4.44 0 0 1-4.765-1.766a4.108 4.108 0 0 1-.702-3.108a3.855 3.855 0 0 1 1.742-2.582l5.589-3.563a4.072 4.072 0 0 1 1.135-.499a4.44 4.44 0 0 1 4.765 1.767a4.109 4.109 0 0 1 .703 3.107a3.943 3.943 0 0 1-.134.522l-.105.321l-.286-.21a7.204 7.204 0 0 0-2.187-1.093l-.208-.063l.02-.207a1.255 1.255 0 0 0-.226-.831a1.337 1.337 0 0 0-1.435-.532a1.231 1.231 0 0 0-.343.15L8.62 9.368a1.162 1.162 0 0 0-.524.778a1.24 1.24 0 0 0 .211.937a1.338 1.338 0 0 0 1.435.533a1.235 1.235 0 0 0 .344-.151l2.132-1.36a4.067 4.067 0 0 1 1.135-.498a4.44 4.44 0 0 1 4.765 1.766a4.108 4.108 0 0 1 .702 3.108a3.857 3.857 0 0 1-1.742 2.583l-5.589 3.562a4.072 4.072 0 0 1-1.135.499m10.358-17.95C18.484-.015 14.082-.96 10.9 1.068L5.31 4.63a6.412 6.412 0 0 0-2.896 4.295a6.753 6.753 0 0 0 .666 4.336a6.43 6.43 0 0 0-.96 2.396a6.833 6.833 0 0 0 1.168 5.167c2.229 3.19 6.63 4.135 9.812 2.108l5.59-3.562a6.41 6.41 0 0 0 2.896-4.295a6.756 6.756 0 0 0-.665-4.336a6.429 6.429 0 0 0 .958-2.396a6.831 6.831 0 0 0-1.167-5.168Z"}};var Pl=en("<svg><path></path></svg>");function ts(s,t){Ke(t,!0);let a=fi(t,["$$slots","$$events","$$legacy","icon"]);const d=bt(()=>t.icon in Is?Is[t.icon]:(console.error(`Icon '${t.icon}' not found`),Is.Alert));var l=Pl();hi(l,()=>({viewBox:e(d).viewBox,fill:"currentColor",...a}),void 0,void 0,"svelte-1nulj1g");var c=n(l);i(l),W(()=>qe(c,"d",e(d).path)),p(s,l),Ze()}function Dl(s){const t=s-1;return t*t*t+1}function zl(s,{from:t,to:a},d={}){var{delay:l=0,duration:c=S=>Math.sqrt(S)*120,easing:u=Dl}=d,b=getComputedStyle(s),r=b.transform==="none"?"":b.transform,[g,y]=b.transformOrigin.split(" ").map(parseFloat);g/=s.clientWidth,y/=s.clientHeight;var m=Ml(s),x=s.clientWidth/a.width/m,k=s.clientHeight/a.height/m,f=t.left+t.width*g,C=t.top+t.height*y,w=a.left+a.width*g,I=a.top+a.height*y,O=(f-w)*x,H=(C-I)*k,F=t.width/a.width,A=t.height/a.height;return{delay:l,duration:typeof c=="function"?c(Math.sqrt(O*O+H*H)):c,easing:u,css:(S,$)=>{var J=$*O,fe=$*H,ee=S+$*F,L=S+$*A;return`transform: ${r} translate(${J}px, ${fe}px) scale(${ee}, ${L});`}}}function Ml(s){if("currentCSSZoom"in s)return s.currentCSSZoom;for(var t=s,a=1;t!==null;)a*=+getComputedStyle(t).zoom,t=t.parentElement;return a}const ea=s=>{if(s instanceof Object){if(s.label===void 0){const t=JSON.stringify(s);console.error(`MultiSelect option ${t} is an object but has no label key`)}return s.label}return`${s}`};function ai(s,t=null){let a="";if(["selected","option",null].includes(t)||console.error(`MultiSelect: Invalid key=${t} for get_style`),typeof s=="object"&&s.style&&(typeof s.style=="string"&&(a=s.style),typeof s.style=="object")){if(t&&t in s.style)return s.style[t]??"";console.error(`Invalid style object for option=${JSON.stringify(s)}`)}return a.trim()&&!a.trim().endsWith(";")&&(a+=";"),a}function si(s,t,a){if(typeof CSS>"u"||!CSS.highlights||!t)return;CSS.highlights.clear();const d=document.createTreeWalker(s,NodeFilter.SHOW_TEXT,{acceptNode:b=>b?.textContent===a?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_ACCEPT}),l=[];let c=d.nextNode();for(;c;)l.push(c),c=d.nextNode();const u=l.map(b=>{const r=b.textContent?.toLowerCase(),g=[];let y=0;for(;r&&y<r.length;){const m=r.indexOf(t,y);if(m===-1)break;g.push(m),y=m+t.length}return g.map(m=>{const x=new Range;return x.setStart(b,m),x.setEnd(b,m+t.length),x})});CSS.highlights.set("sms-search-matches",new Highlight(...u.flat()))}var Ol=(s,t,a)=>t(e(a),s),Fl=T('<button type="button" class="remove svelte-iqpr0d"><!></button>'),ql=T('<li role="option" aria-selected="true"><!> <!></li>'),Rl=T("<span> </span>"),Ul=T('<button type="button" class="remove remove-all svelte-iqpr0d"><!></button>'),Bl=T("<!> <!>",1),Hl=(s,t,a,d,l,c)=>{e(t).disabled||(a()?d(e(l),s):c(e(l),s))},Vl=(s,t,a,d,l,c)=>{!e(t).disabled&&(s.key==="Enter"||s.code==="Space")&&(s.preventDefault(),a()?d(e(l),s):c(e(l),s))},Jl=T('<input type="checkbox" class="option-checkbox svelte-iqpr0d" tabindex="-1"/>'),Wl=T('<li role="option" aria-selected="false"><!> <!></li>'),Xl=(s,t,a,d,l)=>{e(t)==="create"&&a()&&d(l(),s)},Gl=(s,t,a,d,l)=>{e(t)==="create"&&a()&&(s.key==="Enter"||s.code==="Space")&&(s.preventDefault(),d(l(),s))},Yl=(s,t)=>h(t,!0),Kl=(s,t)=>h(t,!1),Zl=T('<li role="option" aria-selected="false"><!></li>'),Ql=T('<ul role="listbox"><!> <!></ul>'),ec=T('<div role="searchbox" tabindex="-1"><input tabindex="-1" aria-hidden="true" aria-label="ignore this, used only to prevent form submission if select is required but empty" class="form-control svelte-iqpr0d"/> <!> <ul aria-label="selected options"><!> <input/> <!></ul> <!> <!> <!></div>');function tc(s,t){Ke(t,!0);let a=Y(t,"activeIndex",15,null),d=Y(t,"activeOption",15,null),l=Y(t,"createOptionMsg",19,()=>"Create this option..."),c=Y(t,"allowUserOptions",3,!1),u=Y(t,"allowEmpty",3,!1),b=Y(t,"autocomplete",19,()=>"off"),r=Y(t,"autoScroll",3,!0),g=Y(t,"breakpoint",3,800),y=Y(t,"defaultDisabledTitle",19,()=>"This option is disabled"),m=Y(t,"disabled",3,!1),x=Y(t,"disabledInputTitle",19,()=>"This input is disabled"),k=Y(t,"duplicateOptionMsg",19,()=>"This option is already selected"),f=Y(t,"duplicates",3,!1),C=Y(t,"keepSelectedInDropdown",3,!1),w=Y(t,"key",3,j=>`${ea(j)}`.toLowerCase()),I=Y(t,"filterFunc",3,(j,ye)=>ye?`${ea(j)}`.toLowerCase().includes(ye.toLowerCase()):!0),O=Y(t,"closeDropdownOnSelect",19,()=>"if-mobile"),H=Y(t,"form_input",15,null),F=Y(t,"highlightMatches",3,!0),A=Y(t,"id",3,null),S=Y(t,"input",15,null),$=Y(t,"inputClass",19,()=>""),J=Y(t,"inputStyle",3,null),fe=Y(t,"inputmode",3,null),ee=Y(t,"invalid",15,!1),L=Y(t,"liActiveOptionClass",19,()=>""),ve=Y(t,"liActiveUserMsgClass",19,()=>""),P=Y(t,"liOptionClass",19,()=>""),E=Y(t,"liOptionStyle",3,null),N=Y(t,"liSelectedClass",19,()=>""),K=Y(t,"liSelectedStyle",3,null),be=Y(t,"liUserMsgClass",19,()=>""),se=Y(t,"loading",3,!1),Z=Y(t,"matchingOptions",31,()=>Cs([])),R=Y(t,"maxOptions",3,void 0),q=Y(t,"maxSelect",3,null),ce=Y(t,"maxSelectMsg",3,(j,ye)=>ye>1?`${j}/${ye}`:""),me=Y(t,"maxSelectMsgClass",19,()=>""),$e=Y(t,"name",3,null),je=Y(t,"noMatchingOptionsMsg",19,()=>"No matching options"),ae=Y(t,"open",15,!1),V=Y(t,"options",15),U=Y(t,"outerDiv",15,null),ie=Y(t,"outerDivClass",19,()=>""),pe=Y(t,"parseLabelsAsHtml",3,!1),we=Y(t,"pattern",3,null),G=Y(t,"placeholder",3,null),de=Y(t,"removeAllTitle",19,()=>"Remove all"),Se=Y(t,"removeBtnTitle",19,()=>"Remove"),le=Y(t,"minSelect",3,null),ne=Y(t,"required",7,!1),Ie=Y(t,"resetFilterOnAdd",3,!0),D=Y(t,"searchText",31,()=>""),_=Y(t,"selected",31,()=>Cs(V()?.filter(j=>j instanceof Object&&j?.preselected).slice(0,q()??void 0)??[])),he=Y(t,"sortSelected",3,!1),De=Y(t,"selectedOptionsDraggable",19,()=>!he()),Le=Y(t,"style",3,null),ge=Y(t,"ulOptionsClass",19,()=>""),X=Y(t,"ulSelectedClass",19,()=>""),te=Y(t,"ulSelectedStyle",3,null),ke=Y(t,"ulOptionsStyle",3,null),Ae=Y(t,"value",15,null),Ne=Y(t,"portal",19,()=>({})),Ve=fi(t,["$$slots","$$events","$$legacy","activeIndex","activeOption","createOptionMsg","allowUserOptions","allowEmpty","autocomplete","autoScroll","breakpoint","defaultDisabledTitle","disabled","disabledInputTitle","duplicateOptionMsg","duplicates","keepSelectedInDropdown","key","filterFunc","closeDropdownOnSelect","form_input","highlightMatches","id","input","inputClass","inputStyle","inputmode","invalid","liActiveOptionClass","liActiveUserMsgClass","liOptionClass","liOptionStyle","liSelectedClass","liSelectedStyle","liUserMsgClass","loading","matchingOptions","maxOptions","maxSelect","maxSelectMsg","maxSelectMsgClass","name","noMatchingOptionsMsg","open","options","outerDiv","outerDivClass","parseLabelsAsHtml","pattern","placeholder","removeAllTitle","removeBtnTitle","minSelect","required","resetFilterOnAdd","searchText","selected","sortSelected","selectedOptionsDraggable","style","ulOptionsClass","ulSelectedClass","ulSelectedStyle","ulOptionsStyle","value","expandIcon","selectedItem","children","removeIcon","afterInput","spinner","disabledIcon","option","userMsg","onblur","onclick","onfocus","onkeydown","onkeyup","onmousedown","onmouseenter","onmouseleave","ontouchcancel","ontouchend","ontouchmove","ontouchstart","onadd","oncreate","onremove","onremoveAll","onchange","onopen","onclose","portal"]);qa(()=>{Ae(q()===1?_()[0]??null:_())}),qa(()=>{q()===1?_(Ae()?[Ae()]:[]):_(Ae()??[])});let Q=_t(!1);V()?.length>0||(c()||se()||m()||u()?V([]):console.error("MultiSelect received no options")),q()!==null&&q()<1&&console.error(`MultiSelect's maxSelect must be null or positive integer, got ${q()}`),Array.isArray(_())||console.error(`MultiSelect's selected prop should always be an array, got ${_()}`),q()&&typeof ne()=="number"&&ne()>q()&&console.error(`MultiSelect maxSelect=${q()} < required=${ne()}, makes it impossible for users to submit a valid form`),pe()&&c()&&console.warn("Don't combine parseLabelsAsHtml and allowUserOptions. It's susceptible to XSS attacks!"),he()&&De()&&console.warn("MultiSelect's sortSelected and selectedOptionsDraggable should not be combined as any user re-orderings of selected options will be undone by sortSelected on component re-renders."),c()&&!l()&&l()!==null&&console.error(`MultiSelect has allowUserOptions=${c()} but createOptionMsg=${l()} is falsy. This prevents the "Add option" <span> from showing up, resulting in a confusing user experience.`),R()&&(typeof R()!="number"||R()<0||R()%1!=0)&&console.error(`MultiSelect's maxOptions must be undefined or a positive integer, got ${R()}`);let oe=_t(!1),xe=_t(0);if(qa(()=>{Z(V().filter(j=>I()(j,D())&&(!_().map(w()).includes(w()(j))||f()||C())))}),a()!==null&&!Z()[a()])throw`Run time error, activeIndex=${a()} is out of bounds, matchingOptions.length=${Z().length}`;ss(()=>{d(Z()[a()??-1]??null)});function Te(j,ye){_().map(w()).includes(w()(j))?(le()===null||_().length>le())&&Ee(j,ye):_e(j,ye)}function _e(j,ye){ye.stopPropagation(),q()!==null&&_().length>=q()&&h(Q,!0),!isNaN(Number(j))&&typeof _().map(ea)[0]=="number"&&(j=Number(j));const Oe=_().map(w()).includes(w()(j));if((q()===null||q()===1||_().length<q())&&(f()||!Oe)){if(!V().includes(j)&&[!0,"append"].includes(c())&&D().length>0&&(typeof V()[0]=="object"?j={label:D()}:["number","undefined"].includes(typeof V()[0])&&!isNaN(Number(D()))?j=Number(D()):j=D(),t.oncreate?.({option:j}),c()==="append"&&V([...V(),j])),Ie()&&D(""),["",void 0,null].includes(j)){console.error(`MultiSelect: encountered falsy option ${j}`);return}q()===1?_([j]):(_([..._(),j]),he()===!0?_(_().sort((Ue,at)=>{const[Ut,la]=[ea(Ue),ea(at)];return`${Ut}`.localeCompare(`${la}`)})):typeof he()=="function"&&_(_().sort(he())));const Qe=_().length>=(q()??1/0),lt=O()===!0||O()==="retain-focus"||O()==="if-mobile"&&e(xe)&&e(xe)<g(),Fe=O()==="retain-focus";Qe||lt?et(ye,Fe):lt||S()?.focus(),t.onadd?.({option:j}),t.onchange?.({option:j,type:"add"}),ee(!1),H()?.setCustomValidity("")}}function Ee(j,ye){if(ye.stopPropagation(),_().length===0)return;const Oe=_().findIndex(lt=>w()(lt)===w()(j));let[Qe]=_().splice(Oe,1);if(Qe===void 0&&c()&&(Qe=typeof V()[0]?{label:j}:j),Qe===void 0)return console.error(`Multiselect can't remove selected option ${JSON.stringify(j)}, not found in selected list`);_([..._()]),ee(!1),H()?.setCustomValidity(""),t.onremove?.({option:Qe}),t.onchange?.({option:Qe,type:"remove"})}function Me(j){j.stopPropagation(),!m()&&(ae(!0),j instanceof FocusEvent||S()?.focus(),t.onopen?.({event:j}))}function et(j,ye=!1){ae(!1),ye||S()?.blur(),a(null),t.onclose?.({event:j})}async function it(j){if(j.key==="Escape"||j.key==="Tab")j.stopPropagation(),et(j),D("");else if(j.key==="Enter")j.stopPropagation(),j.preventDefault(),d()?(_().includes(d())?(le()===null||_().length>le())&&Ee(d(),j):_e(d(),j),D("")):c()&&D().length>0?_e(D(),j):Me(j);else if(["ArrowDown","ArrowUp"].includes(j.key)){if(j.stopPropagation(),a()===null&&Z().length>0){j.preventDefault(),a(0);return}else if(c()&&!Z().length&&D().length>0){j.preventDefault(),h(oe,!e(oe));return}else if(a()===null)return;j.preventDefault();const ye=j.key==="ArrowUp"?-1:1;if(a((a()+ye)%Z().length),a()<0&&a(Z().length-1),r()){await hs();const Oe=document.querySelector("ul.options > li.active");Oe&&Oe.scrollIntoViewIfNeeded?.()}}else j.key==="Backspace"&&_().length>0&&!D()?(j.stopPropagation(),(le()===null||_().length>le())&&Ee(_().at(-1),j)):Z().length>0&&a()===null&&a(0)}function Tt(j){j.stopPropagation();let ye=[];le()===null?(ye=_(),_([]),D("")):_().length>le()&&(ye=_().slice(le()),_(_().slice(0,le())),D("")),t.onremoveAll?.({options:ye}),t.onchange?.({options:_(),type:"removeAll"})}let At=bt(()=>j=>_().map(ea).includes(j));const Nt=j=>ye=>{["Enter","Space"].includes(ye.code)&&(ye.preventDefault(),j(ye))};function Ye(j){U()&&!U().contains(j.target)&&et(j)}let It=_t(null);const qt=j=>ye=>{if(!ye.dataTransfer)return;ye.dataTransfer.dropEffect="move";const Oe=parseInt(ye.dataTransfer.getData("text/plain")),Qe=[..._()];Oe<j?(Qe.splice(j+1,0,Qe[Oe]),Qe.splice(Oe,1)):(Qe.splice(j,0,Qe[Oe]),Qe.splice(Oe+1,1)),_(Qe),h(It,null)},ra=j=>ye=>{ye.dataTransfer&&(ye.dataTransfer.effectAllowed="move",ye.dataTransfer.dropEffect="move",ye.dataTransfer.setData("text/plain",`${j}`))};let Ht=_t(void 0);ss(()=>{e(Ht)&&F()&&(D()?si(e(Ht),D(),je()):typeof CSS<"u"&&CSS.highlights&&CSS.highlights.delete?.("sms-search-matches"))});function Ea(j){if(!F()||!e(Ht))return;const ye=j?.target?.value.trim().toLowerCase();ye&&si(e(Ht),ye,je())}const Ca=j=>{it(j),t.onkeydown?.(j)},$a=j=>{Me(j),t.onfocus?.(j)};ss(()=>{if(!S())return;const j=S().focus.bind(S());return S(S().focus=ye=>{j(ye),!m()&&!ae()&&Me(new FocusEvent("focus",{bubbles:!0}))},!0),()=>{S()&&S(S().focus=j,!0)}});const Da=j=>{if(Ne()?.active){t.onblur?.(j);return}U()?.contains(j.relatedTarget)||et(j),t.onblur?.(j)};qa(()=>{ne(ne()),H()?.setCustomValidity("")});function ja(j,ye){let{target_node:Oe,active:Qe}=ye;if(!Qe)return;let lt=typeof window>"u"||!document.body.contains(j);if(!lt){document.body.appendChild(j),j.style.position="fixed";const Fe=()=>{if(!Oe||!ae())return j.hidden=!0;const Ue=Oe.getBoundingClientRect();j.style.left=`${Ue.left}px`,j.style.top=`${Ue.bottom}px`,j.style.width=`${Ue.width}px`,j.hidden=!1};return ae()&&hs().then(Fe),window.addEventListener("scroll",Fe,!0),window.addEventListener("resize",Fe),qa(()=>{ae()&&Oe?Fe():j.hidden=!0}),{update(Ue){Oe=Ue.target_node,lt=typeof window>"u"||!document.body.contains(j),ae()&&!lt&&Oe?hs().then(Fe):(!ae()||!Oe)&&(j.hidden=!0)},destroy(){lt||j.remove(),window.removeEventListener("scroll",Fe,!0),window.removeEventListener("resize",Fe)}}}}var Rt=ec();ue("click",rs,Ye),ue("touchstart",rs,Ye,void 0,!0);let ya;Rt.__mouseup=Me;var aa=n(Rt);ft(aa),wa(aa,j=>H(j),()=>H());var rt=o(aa,2);{var Kt=j=>{var ye=ze(),Oe=Ce(ye);na(Oe,()=>t.expandIcon,()=>({open:ae()})),p(j,ye)},da=j=>{ts(j,{icon:"ChevronExpand",width:"15px",style:"min-width: 1em; padding: 0 1pt; cursor: pointer"})};B(rt,j=>{t.expandIcon?j(Kt):j(da,!1)})}var sa=o(rt,2),va=n(sa);Je(va,27,_,(j,ye)=>f()?[w()(j),ye]:w()(j),(j,ye,Oe,Qe)=>{const lt=bt(()=>[ai(e(ye),"selected"),K()].filter(Boolean).join(" ")||null);var Fe=ql();let Ue;var at=bt(()=>ra(e(Oe))),Ut=bt(()=>qt(e(Oe))),la=n(Fe);{var ct=st=>{var gt=ze(),jt=Ce(gt);na(jt,()=>t.selectedItem,()=>({option:e(ye),idx:e(Oe)})),p(st,gt)},dt=st=>{var gt=ze(),jt=Ce(gt);{var kt=Zt=>{var Xe=ze(),yt=Ce(Xe);na(yt,()=>t.children,()=>({option:e(ye),idx:e(Oe)})),p(Zt,Xe)},ua=Zt=>{var Xe=ze(),yt=Ce(Xe);{var Qt=Pt=>{var Gt=ze(),_a=Ce(Gt);Xs(_a,()=>ea(e(ye))),p(Pt,Gt)},Bt=Pt=>{var Gt=pt();W(_a=>M(Gt,_a),[()=>ea(e(ye))]),p(Pt,Gt)};B(yt,Pt=>{pe()?Pt(Qt):Pt(Bt,!1)},!0)}p(Zt,Xe)};B(jt,Zt=>{t.children?Zt(kt):Zt(ua,!1)},!0)}p(st,gt)};B(la,st=>{t.selectedItem?st(ct):st(dt,!1)})}var ca=o(la,2);{var ht=st=>{var gt=Fl();gt.__click=[Ol,Ee,ye];var jt=bt(()=>Nt(Xe=>Ee(e(ye),Xe)));gt.__keydown=function(...Xe){e(jt)?.apply(this,Xe)};var kt=n(gt);{var ua=Xe=>{var yt=ze(),Qt=Ce(yt);na(Qt,()=>t.removeIcon),p(Xe,yt)},Zt=Xe=>{ts(Xe,{icon:"Cross",width:"15px"})};B(kt,Xe=>{t.removeIcon?Xe(ua):Xe(Zt,!1)})}i(gt),W(Xe=>qe(gt,"title",`${Se()??""} ${Xe??""}`),[()=>ea(e(ye))]),p(st,gt)};B(ca,st=>{!m()&&(le()===null||_().length>le())&&st(ht)})}i(Fe),W(st=>{Ue=He(Fe,1,rn(N()),"svelte-iqpr0d",Ue,st),qe(Fe,"draggable",De()&&!m()&&_().length>1),vt(Fe,e(lt))},[()=>({active:e(It)===e(Oe)})]),ue("dragstart",Fe,function(...st){e(at)?.apply(this,st)}),ue("dragover",Fe,st=>{st.preventDefault()}),ue("drop",Fe,function(...st){e(Ut)?.apply(this,st)}),ue("dragenter",Fe,()=>h(It,e(Oe),!0)),hn(Fe,()=>zl,()=>({duration:100})),p(j,Fe)});var ia=o(va,2);ft(ia);var xa=()=>!1;hi(ia,()=>({class:$(),style:J(),id:A(),disabled:m(),autocomplete:b(),inputmode:fe(),pattern:we(),placeholder:_().length==0?G():null,"aria-invalid":ee()?"true":null,ondrop:xa,onmouseup:Me,onkeydown:Ca,onfocus:$a,oninput:Ea,onblur:Da,onclick:t.onclick,onkeyup:t.onkeyup,onmousedown:t.onmousedown,onmouseenter:t.onmouseenter,onmouseleave:t.onmouseleave,ontouchcancel:t.ontouchcancel,ontouchend:t.ontouchend,ontouchmove:t.ontouchmove,ontouchstart:t.ontouchstart,...Ve}),void 0,void 0,"svelte-iqpr0d"),wa(ia,j=>S(j),()=>S());var tt=o(ia,2);na(tt,()=>t.afterInput??Ta,()=>({selected:_(),disabled:m(),invalid:ee(),id:A(),placeholder:G(),open:ae(),required:ne()})),i(sa);var Re=o(sa,2);{var mt=j=>{var ye=ze(),Oe=Ce(ye);{var Qe=Fe=>{var Ue=ze(),at=Ce(Ue);na(at,()=>t.spinner),p(Fe,Ue)},lt=Fe=>{Ll(Fe,{})};B(Oe,Fe=>{t.spinner?Fe(Qe):Fe(lt,!1)})}p(j,ye)};B(Re,j=>{se()&&j(mt)})}var xt=o(Re,2);{var Lt=j=>{var ye=ze(),Oe=Ce(ye);{var Qe=Fe=>{var Ue=ze(),at=Ce(Ue);na(at,()=>t.disabledIcon),p(Fe,Ue)},lt=Fe=>{ts(Fe,{icon:"Disabled",width:"14pt",style:"margin: 0 2pt","data-name":"disabled-icon","aria-disabled":"true"})};B(Oe,Fe=>{t.disabledIcon?Fe(Qe):Fe(lt,!1)})}p(j,ye)},$t=j=>{var ye=ze(),Oe=Ce(ye);{var Qe=lt=>{var Fe=Bl(),Ue=Ce(Fe);{var at=ct=>{sc(ct,{angle:20,get wiggle(){return e(Q)},set wiggle(dt){h(Q,dt,!0)},children:(dt,ca)=>{var ht=Rl(),st=n(ht,!0);i(ht),W(gt=>{He(ht,1,`max-select-msg ${me()??""}`,"svelte-iqpr0d"),M(st,gt)},[()=>ce()?.(_().length,q())]),p(dt,ht)},$$slots:{default:!0}})};B(Ue,ct=>{q()&&(q()>1||ce())&&ct(at)})}var Ut=o(Ue,2);{var la=ct=>{var dt=Ul();dt.__click=Tt;var ca=bt(()=>Nt(Tt));dt.__keydown=function(...jt){e(ca)?.apply(this,jt)};var ht=n(dt);{var st=jt=>{var kt=ze(),ua=Ce(kt);na(ua,()=>t.removeIcon),p(jt,kt)},gt=jt=>{ts(jt,{icon:"Cross",width:"15px"})};B(ht,jt=>{t.removeIcon?jt(st):jt(gt,!1)})}i(dt),W(()=>qe(dt,"title",de())),p(ct,dt)};B(Ut,ct=>{q()!==1&&_().length>1&&ct(la)})}p(lt,Fe)};B(Oe,lt=>{_().length>0&&lt(Qe)},!0)}p(j,ye)};B(xt,j=>{m()?j(Lt):j($t,!1)})}var ba=o(xt,2);{var za=j=>{var ye=Ql();let Oe;var Qe=n(ye);Je(Qe,19,()=>Z().slice(0,Math.max(0,R()??0)||1/0),(Ue,at)=>f()?[w()(Ue),at]:w()(Ue),(Ue,at,Ut,la)=>{const ct=bt(()=>{const{label:Xe,disabled:yt=null,title:Qt=null,selectedTitle:Bt=null,disabledTitle:Pt=y()}=e(at)instanceof Object?e(at):{label:e(at)};return{label:Xe,disabled:yt,title:Qt,selectedTitle:Bt,disabledTitle:Pt}}),dt=bt(()=>a()===e(Ut)),ca=bt(()=>[ai(e(at),"option"),E()].filter(Boolean).join(" ")||null);var ht=Wl();ht.__click=[Hl,ct,C,Te,at,_e];let st;ht.__mouseover=()=>{e(ct).disabled||a(e(Ut))},ht.__keydown=[Vl,ct,C,Te,at,_e];var gt=n(ht);{var jt=Xe=>{var yt=Jl();ft(yt),W((Qt,Bt)=>{mi(yt,Qt),qe(yt,"aria-label",`Toggle ${Bt??""}`)},[()=>e(At)(e(ct).label),()=>ea(e(at))]),p(Xe,yt)};B(gt,Xe=>{C()==="checkboxes"&&Xe(jt)})}var kt=o(gt,2);{var ua=Xe=>{var yt=ze(),Qt=Ce(yt);na(Qt,()=>t.option,()=>({option:e(at),idx:e(Ut)})),p(Xe,yt)},Zt=Xe=>{var yt=ze(),Qt=Ce(yt);{var Bt=Gt=>{var _a=ze(),us=Ce(_a);na(us,()=>t.children,()=>({option:e(at),idx:e(Ut)})),p(Gt,_a)},Pt=Gt=>{var _a=ze(),us=Ce(_a);{var Ei=Ma=>{var Xa=ze(),ps=Ce(Xa);Xs(ps,()=>ea(e(at))),p(Ma,Xa)},Ci=Ma=>{var Xa=pt();W(ps=>M(Xa,ps),[()=>ea(e(at))]),p(Ma,Xa)};B(us,Ma=>{pe()?Ma(Ei):Ma(Ci,!1)},!0)}p(Gt,_a)};B(Qt,Gt=>{t.children?Gt(Bt):Gt(Pt,!1)},!0)}p(Xe,yt)};B(kt,Xe=>{t.option?Xe(ua):Xe(Zt,!1)})}i(ht),W((Xe,yt)=>{qe(ht,"title",Xe),st=He(ht,1,`${P()??""} ${(e(dt)?L():"")??""}`,"svelte-iqpr0d",st,yt),vt(ht,e(ca))},[()=>e(ct).disabled?e(ct).disabledTitle:e(At)(e(ct).label)&&e(ct).selectedTitle||e(ct).title,()=>({selected:e(At)(e(ct).label),active:e(dt),disabled:e(ct).disabled})]),ue("focus",ht,()=>{e(ct).disabled||a(e(Ut))}),p(Ue,ht)});var lt=o(Qe,2);{var Fe=Ue=>{const at=bt(()=>_().map(ea).includes(D())),Ut=bt(()=>!f()&&e(at)&&"dupe"),la=bt(()=>!!(c()&&l())&&"create"),ct=bt(()=>!!(Z()?.length==0&&je())&&"no-match"),dt=bt(()=>e(Ut)||e(la)||e(ct));var ca=ze(),ht=Ce(ca);{var st=gt=>{const jt=bt(()=>({dupe:k(),create:l(),"no-match":je()})[e(dt)]);var kt=Zl();kt.__click=[Xl,dt,c,_e,D],kt.__keydown=[Gl,dt,c,_e,D],kt.__mouseover=[Yl,oe],kt.__mouseout=[Kl,oe];let ua,Zt;var Xe=n(kt);{var yt=Bt=>{var Pt=ze(),Gt=Ce(Pt);na(Gt,()=>t.userMsg,()=>({searchText:D(),msgType:e(dt),msg:e(jt)})),p(Bt,Pt)},Qt=Bt=>{var Pt=pt();W(()=>M(Pt,e(jt))),p(Bt,Pt)};B(Xe,Bt=>{t.userMsg?Bt(yt):Bt(Qt,!1)})}i(kt),W((Bt,Pt)=>{qe(kt,"title",e(dt)==="create"?l():e(dt)==="dupe"?k():""),ua=He(kt,1,`
              user-msg ${be()??""} ${(e(oe)?ve():"")??""}
            `,"svelte-iqpr0d",ua,Bt),Zt=vt(kt,"",Zt,Pt)},[()=>({active:e(oe)}),()=>({cursor:{dupe:"not-allowed",create:"pointer","no-match":"default"}[e(dt)]})]),ue("focus",kt,()=>h(oe,!0)),ue("blur",kt,()=>h(oe,!1)),p(gt,kt)};B(ht,gt=>{e(dt)&&gt(st)})}p(Ue,ca)};B(lt,Ue=>{D()&&Ue(Fe)})}i(ye),un(ye,(Ue,at)=>ja?.(Ue,at),()=>({target_node:U(),...Ne()})),wa(ye,Ue=>h(Ht,Ue),()=>e(Ht)),W(Ue=>{Oe=He(ye,1,`options ${ge()??""}`,"svelte-iqpr0d",Oe,Ue),qe(ye,"aria-multiselectable",q()===null||q()>1),qe(ye,"aria-expanded",ae()),qe(ye,"aria-disabled",m()?"true":null),vt(ye,ke())},[()=>({hidden:!ae()})]),p(j,ye)};B(ba,j=>{(D()&&je()||V()?.length>0)&&j(za)})}i(Rt),wa(Rt,j=>U(j),()=>U()),W((j,ye,Oe)=>{ya=He(Rt,1,`multiselect ${ie()??""} ${t.class??""??""}`,"svelte-iqpr0d",ya,j),qe(Rt,"title",m()?x():null),qe(Rt,"data-id",A()),vt(Rt,Le()),qe(aa,"name",$e()),aa.required=ye,Fs(aa,Oe),He(sa,1,`selected ${X()??""}`,"svelte-iqpr0d"),vt(sa,te())},[()=>({disabled:m(),single:q()===1,open:ae(),invalid:ee()}),()=>!!ne(),()=>_().length>=Number(ne())?JSON.stringify(_()):null]),bn("innerWidth",j=>h(xe,j,!0)),ue("invalid",aa,()=>{ee(!0);let j;q()&&q()>1&&Number(ne())>1?j=`Please select between ${ne()} and ${q()} options`:Number(ne())>1?j=`Please select at least ${ne()} options`:j="Please select an option",H()?.setCustomValidity(j)}),wt(ia,D),p(s,Rt),Ze()}Wa(["mouseup","click","keydown","mouseover","mouseout"]);Wa(["change","input","click"]);Wa(["keydown","change","click"]);function ii(s){return Object.prototype.toString.call(s)==="[object Date]"}function Ms(s,t,a,d){if(typeof a=="number"||ii(a)){const l=d-a,c=(a-t)/(s.dt||1/60),u=s.opts.stiffness*l,b=s.opts.damping*c,r=(u-b)*s.inv_mass,g=(c+r)*s.dt;return Math.abs(g)<s.opts.precision&&Math.abs(l)<s.opts.precision?d:(s.settled=!1,ii(a)?new Date(a.getTime()+g):a+g)}else{if(Array.isArray(a))return a.map((l,c)=>Ms(s,t[c],a[c],d[c]));if(typeof a=="object"){const l={};for(const c in a)l[c]=Ms(s,t[c],a[c],d[c]);return l}else throw new Error(`Cannot spring ${typeof a} values`)}}class Rs{#s=_t(.15);#i=_t(.8);#n=_t(.01);#e;#a;#o=void 0;#l=0;#r=1;#d=0;#t=null;#c=null;constructor(t,a={}){this.#e=_t(t),this.#a=_t(t),typeof a.stiffness=="number"&&(this.#s.v=as(a.stiffness,0,1)),typeof a.damping=="number"&&(this.#i.v=as(a.damping,0,1)),typeof a.precision=="number"&&(this.#n.v=a.precision)}static of(t,a){const d=new Rs(t(),a);return Ja(()=>{d.set(t())}),d}#v(t){if(h(this.#a,t),this.#e.v??=t,this.#o??=this.#e.v,!this.#t){this.#l=ma.now();var a=1e3/(this.#d*60);this.#t??=bi(d=>{this.#r=Math.min(this.#r+a,1);const l=Math.min(d-this.#l,1e3/30),c={inv_mass:this.#r,opts:{stiffness:this.#s.v,damping:this.#i.v,precision:this.#n.v},settled:!0,dt:l*60/1e3};var u=Ms(c,this.#o,this.#e.v,this.#a.v);return this.#o=this.#e.v,this.#l=d,h(this.#e,u),c.settled&&(this.#t=null),!c.settled})}return this.#t.promise}set(t,a){if(this.#c?.reject(new Error("Aborted")),a?.instant||this.#e.v===void 0)return this.#t?.abort(),this.#t=null,h(this.#e,h(this.#a,t)),this.#o=t,Promise.resolve();a?.preserveMomentum&&(this.#r=0,this.#d=a.preserveMomentum);var d=this.#c=tn();return d.promise.catch(Ta),this.#v(t).then(()=>{d===this.#c&&d.resolve(void 0)}),d.promise}get current(){return e(this.#e)}get damping(){return e(this.#i)}set damping(t){h(this.#i,as(t,0,1))}get precision(){return e(this.#n)}set precision(t){h(this.#n,t)}get stiffness(){return e(this.#s)}set stiffness(t){h(this.#s,as(t,0,1))}get target(){return e(this.#a)}set target(t){this.set(t)}}function as(s,t,a){return Math.max(t,Math.min(a,s))}var ac=T("<span><!></span>");function sc(s,t){Ke(t,!0);let a=Y(t,"wiggle",15,!1),d=Y(t,"angle",3,0),l=Y(t,"scale",3,1),c=Y(t,"dx",3,0),u=Y(t,"dy",3,0),b=Y(t,"duration",3,200),r=Y(t,"stiffness",3,.05),g=Y(t,"damping",3,.1);const y=Rs.of(()=>a()?{scale:l(),angle:d(),dx:c(),dy:u()}:{angle:0,scale:1,dx:0,dy:0},{stiffness:r(),damping:g()});qa(()=>{a()&&setTimeout(()=>a(!1),b())});var m=ac();let x;var k=n(m);na(k,()=>t.children??Ta),i(m),W(f=>x=vt(m,"",x,f),[()=>({transform:`rotate(${y.current.angle??""}deg) scale(${y.current.scale??""})
  translate(${y.current.dx??""}px, ${y.current.dy??""}px)`})]),p(s,m),Ze()}function ic(s,t=!0){const a=new IntersectionObserver(([d],l)=>{const c=d.intersectionRatio;if(c<1){const u=c<=0&&t?"center":"nearest";s.scrollIntoView({block:u,inline:u})}l.disconnect()});return a.observe(s),a}typeof Element<"u"&&!Element.prototype?.scrollIntoViewIfNeeded&&typeof IntersectionObserver<"u"&&(Element.prototype.scrollIntoViewIfNeeded=function(){ic(this)});async function nc(s,t,a,d,l,c,u,b,r,g,y,m,x,k,f,C){if(!e(t)){h(a,"No active entity selected");return}if(!e(d)){h(a,"No signer available for current tab");return}try{h(l,!0),h(a,null);const w=[...e(c)];e(u)&&!w.includes("hub")&&w.push("hub");const I=e(u)?{name:e(b),avatar:e(r),bio:e(g),website:e(y)}:m(e(x)),O=await St(),H=k();if(!H)throw new Error("XLN environment not ready");const F={type:"profile-update",data:{profile:{entityId:e(t),name:I?.name||"",avatar:I?.avatar||"",bio:I?.bio||"",website:I?.website||"",capabilities:w,hubs:[],hankoSignature:""}}},A={entityId:e(t),signerId:e(d),entityTxs:[F],timestamp:Date.now(),signature:""};await O.applyServerInput(H,{serverTxs:[],entityInputs:[A]}),console.log("📡 Submitted profile update transaction:",F),f.onProfileAnnounced?.({entityId:e(t),capabilities:w,hubs:[],metadata:{name:I?.name,avatar:I?.avatar,bio:I?.bio,website:I?.website}}),h(c,[],!0),h(u,!1),h(x,""),h(b,""),h(r,""),h(g,""),h(y,""),h(C,!1)}catch(w){console.error("❌ Failed to submit profile update:",w),h(a,w instanceof Error?w.message:"Failed to submit profile update",!0)}finally{h(l,!1)}}function oc(s,t,a,d){h(t,!e(t)),e(t)&&e(a)&&d(e(a))}var rc=T('<div class="loading-indicator svelte-1dzffeb"><span class="loading-spinner svelte-1dzffeb">🔄</span> <span>Loading profile...</span></div>'),lc=T('<div class="existing-profile-notice svelte-1dzffeb"><span class="notice-icon svelte-1dzffeb">ℹ️</span> <span>Editing existing profile for <strong> </strong></span></div>'),cc=T('<div class="hub-details-section svelte-1dzffeb"><h4 class="hub-details-header svelte-1dzffeb">🏢 Hub Details</h4> <div class="form-group svelte-1dzffeb"><label for="hub-name" class="svelte-1dzffeb">Hub Name:</label> <input id="hub-name" type="text" placeholder="Hub name" class="form-input svelte-1dzffeb"/></div> <div class="form-group svelte-1dzffeb"><label for="hub-avatar" class="svelte-1dzffeb">Avatar URL:</label> <input id="hub-avatar" type="url" placeholder="Avatar URL" class="form-input svelte-1dzffeb"/></div> <div class="form-group svelte-1dzffeb"><label for="hub-bio" class="svelte-1dzffeb">Description / Bio:</label> <textarea id="hub-bio" placeholder="Description / bio" class="form-textarea svelte-1dzffeb" rows="3"></textarea></div> <div class="form-group svelte-1dzffeb"><label for="hub-website" class="svelte-1dzffeb">Website:</label> <input id="hub-website" type="url" placeholder="Website" class="form-input svelte-1dzffeb"/></div></div>'),dc=T('<div class="form-group svelte-1dzffeb"><label for="metadata" class="svelte-1dzffeb">📋 Metadata (optional JSON)</label> <textarea id="metadata" placeholder="Enter JSON metadata here..." class="form-textarea svelte-1dzffeb" rows="3"></textarea> <small class="form-hint svelte-1dzffeb">Optional JSON metadata for additional information</small></div>'),vc=T('<small class="action-hint svelte-1dzffeb">Select an entity first</small>'),uc=T('<small class="action-hint svelte-1dzffeb">No signer available for current tab</small>'),pc=T('<div class="announce-error svelte-1dzffeb"> </div>'),fc=T('<div class="profile-form-content svelte-1dzffeb"><!> <!> <div class="form-group svelte-1dzffeb"><div><label for="capabilities-select" class="svelte-1dzffeb">Capabilities:</label> <svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper></div></div> <div class="form-group svelte-1dzffeb"><label class="checkbox-label svelte-1dzffeb"><input type="checkbox" class="form-checkbox svelte-1dzffeb" data-testid="hub-checkbox"/> <span class="checkbox-text svelte-1dzffeb">🌟 Register as Hub</span></label> <small class="form-hint svelte-1dzffeb">Automatically adds "hub" to your capabilities</small></div> <!> <!> <div class="form-actions svelte-1dzffeb"><button class="announce-btn svelte-1dzffeb" data-testid="announce-profile-button"><!></button> <!></div> <!></div>'),mc=T('<div class="profile-form-container svelte-1dzffeb" data-testid="profile-form"><div class="profile-form-header svelte-1dzffeb"><button class="toggle-btn svelte-1dzffeb"><span class="toggle-icon svelte-1dzffeb"> </span> <h3 class="svelte-1dzffeb">👤 My Profile</h3></button></div> <!></div>');function hc(s,t){Ke(t,!0);const[a,d]=Xt(),l=()=>Ge(Vt,"$tabs",a),c=()=>Ge(Ct,"$xlnEnvironment",a);let u=_t(Cs([])),b=_t(!1),r=_t(""),g=_t(!1),y=_t(!1),m=_t(null),x=_t(""),k=_t(""),f=_t(""),C=_t("");const w=["trading","liquidity","settlement","custody","market-making","routing","bridging","lending","borrowing","staking","governance","analytics","risk-management","compliance"];let I=bt(()=>l().find(se=>se.isActive)),O=bt(()=>e(I)?.entityId),H=bt(()=>e(I)?.signer),F=_t(!1),A=_t(null);function S(se){if(se.trim())try{return JSON.parse(se)}catch{throw new Error("Invalid JSON metadata")}}async function $(se){if(console.log("🚀 ~ loadExistingProfile ~ entityId:",se),!se){h(A,null),fe();return}try{h(F,!0);const Z=await St(),R=c();if(!R||!R.gossip){h(A,null);return}const ce=R.gossip.getProfiles().find(me=>me.entityId===se);ce?(h(A,ce,!0),J(ce),console.log("📝 Loaded existing profile for entity:",se,ce)):(h(A,null),fe(),console.log("📝 No existing profile found for entity:",se))}catch(Z){console.error("❌ Failed to load existing profile:",Z),h(A,null)}finally{h(F,!1)}}function J(se){h(u,(se.capabilities||[]).filter(Z=>Z!=="hub"),!0),h(b,(se.capabilities||[]).includes("hub"),!0),se.metadata?e(b)?(h(x,se.metadata.name||"",!0),h(k,se.metadata.avatar||"",!0),h(f,se.metadata.bio||"",!0),h(C,se.metadata.website||"",!0),h(r,"")):(h(r,JSON.stringify(se.metadata,(Z,R)=>typeof R=="bigint"?R.toString():R,2),!0),h(x,""),h(k,""),h(f,""),h(C,"")):ee()}function fe(){h(u,[],!0),h(b,!1),ee()}function ee(){h(r,""),h(x,""),h(k,""),h(f,""),h(C,"")}ss(()=>{e(O)&&$(e(O))});var L=mc(),ve=n(L),P=n(ve);P.__click=[oc,g,O,$];var E=n(P),N=n(E,!0);i(E),Et(2),i(P),i(ve);var K=o(ve,2);{var be=se=>{var Z=fc(),R=n(Z);{var q=X=>{var te=rc();p(X,te)};B(R,X=>{e(F)&&X(q)})}var ce=o(R,2);{var me=X=>{var te=lc(),ke=o(n(te),2),Ae=o(n(ke)),Ne=n(Ae,!0);i(Ae),i(ke),i(te),W(()=>M(Ne,e(A).entityId)),p(X,te)};B(ce,X=>{e(A)&&X(me)})}var $e=o(ce,2),je=n($e),ae=o(n(je),2);ln(ae,()=>({"--sms-border":"1px solid #3e3e3e","--sms-bg":"#1e1e1e","--sms-text-color":"#d4d4d4","--sms-focus-border":"#007acc","--sms-selected-bg":"#007acc","--sms-options-bg":"#1e1e1e","--sms-options-text":"#d4d4d4","--sms-options-hover-bg":"rgba(255, 255, 255, 0.05)"})),tc(ae.lastChild,{id:"capabilities-select",get options(){return w},placeholder:"Select capabilities...",searchable:!0,liMaxHeight:"200px","data-testid":"capabilities-multiselect",get selected(){return e(u)},set selected(X){h(u,X,!0)}}),i(ae),i(je),i($e);var V=o($e,2),U=n(V),ie=n(U);ft(ie),Et(2),i(U),Et(2),i(V);var pe=o(V,2);{var we=X=>{var te=cc(),ke=o(n(te),2),Ae=o(n(ke),2);ft(Ae),i(ke);var Ne=o(ke,2),Ve=o(n(Ne),2);ft(Ve),i(Ne);var Q=o(Ne,2),oe=o(n(Q),2);Ya(oe),i(Q);var xe=o(Q,2),Te=o(n(xe),2);ft(Te),i(xe),i(te),wt(Ae,()=>e(x),_e=>h(x,_e)),wt(Ve,()=>e(k),_e=>h(k,_e)),wt(oe,()=>e(f),_e=>h(f,_e)),wt(Te,()=>e(C),_e=>h(C,_e)),p(X,te)};B(pe,X=>{e(b)&&X(we)})}var G=o(pe,2);{var de=X=>{var te=dc(),ke=o(n(te),2);Ya(ke),Et(2),i(te),wt(ke,()=>e(r),Ae=>h(r,Ae)),p(X,te)};B(G,X=>{e(b)||X(de)})}var Se=o(G,2),le=n(Se);le.__click=[nc,O,m,H,y,u,b,x,k,f,C,S,r,c,t,g];var ne=n(le);{var Ie=X=>{var te=pt("🔄 Announcing...");p(X,te)},D=X=>{var te=pt("📡 Announce Profile");p(X,te)};B(ne,X=>{e(y)?X(Ie):X(D,!1)})}i(le);var _=o(le,2);{var he=X=>{var te=vc();p(X,te)},De=X=>{var te=ze(),ke=Ce(te);{var Ae=Ne=>{var Ve=uc();p(Ne,Ve)};B(ke,Ne=>{e(H)||Ne(Ae)},!0)}p(X,te)};B(_,X=>{e(O)?X(De,!1):X(he)})}i(Se);var Le=o(Se,2);{var ge=X=>{var te=pc(),ke=n(te);i(te),W(()=>M(ke,`❌ ${e(m)??""}`)),p(X,te)};B(Le,X=>{e(m)&&X(ge)})}i(Z),W(()=>le.disabled=e(y)||!e(O)||!e(H)),yn(ie,()=>e(b),X=>h(b,X)),p(se,Z)};B(K,se=>{e(g)&&se(be)})}i(L),W(()=>M(N,e(g)?"▼":"▶")),p(s,L),Ze(),d()}Wa(["click"]);var gc=T('<div class="loading-state svelte-1r8znrg"><div class="loading-spinner svelte-1r8znrg">🔄</div> <p>Loading network profiles...</p></div>'),yc=T('<div class="error-state svelte-1r8znrg"><div class="error-icon svelte-1r8znrg">❌</div> <p> </p> <button class="retry-btn svelte-1r8znrg">Retry</button></div>'),bc=T('<div class="empty-state svelte-1r8znrg"><div class="empty-icon svelte-1r8znrg">📭</div> <p>No network profiles available</p> <small>Profiles will appear here when entities announce themselves to the gossip layer</small></div>'),_c=T('<div class="profiles-grid svelte-1r8znrg"></div>'),wc=T('<div class="network-directory svelte-1r8znrg"><!> <div class="directory-header svelte-1r8znrg"><h3 class="svelte-1r8znrg">🌐 Network Directory</h3> <button class="refresh-btn svelte-1r8znrg"> </button></div> <!></div>');function xc(s,t){Ke(t,!1);const[a,d]=Xt(),l=()=>Ge(Sn,"$visibleGossip",a),c=()=>Ge(kn,"$isLive",a);let u=re([]),b=re(!0),r=re(null);async function g(){try{h(b,!0),h(r,null);const H=l();if(!H){console.log("📡 No gossip layer available"),h(u,[]);return}const F=H.getProfiles?H.getProfiles():[];h(u,F),console.log(`📡 Loaded gossip profiles (${c()?"LIVE":"HISTORICAL"}):`,e(u))}catch(H){console.error("❌ Failed to load gossip profiles:",H),h(r,H instanceof Error?H.message:"Failed to load profiles"),h(u,[])}finally{h(b,!1)}}ga(()=>{g()});function y(H){console.log("📡 Profile announced, refreshing directory...",H),g()}Pe(()=>l(),()=>{l()&&g()}),Ft(),ot();var m=wc(),x=n(m);hc(x,{onProfileAnnounced:y});var k=o(x,2),f=o(n(k),2),C=n(f);i(f),i(k);var w=o(k,2);{var I=H=>{var F=gc();p(H,F)},O=H=>{var F=ze(),A=Ce(F);{var S=J=>{var fe=yc(),ee=o(n(fe),2),L=n(ee);i(ee);var ve=o(ee,2);i(fe),W(()=>M(L,`Failed to load profiles: ${e(r)??""}`)),ue("click",ve,g),p(J,fe)},$=J=>{var fe=ze(),ee=Ce(fe);{var L=P=>{var E=bc();p(P,E)},ve=P=>{var E=_c();Je(E,5,()=>e(u),N=>N.entityId,(N,K)=>{Al(N,{get profile(){return e(K)}})}),i(E),p(P,E)};B(ee,P=>{e(u),v(()=>e(u).length===0)?P(L):P(ve,!1)},!0)}p(J,fe)};B(A,J=>{e(r)?J(S):J($,!1)},!0)}p(H,F)};B(w,H=>{e(b)?H(I):H(O,!1)})}i(m),W(()=>{f.disabled=e(b),M(C,`${e(b)?"🔄":"↻"} Refresh`)}),ue("click",f,g),p(s,m),Ze(),d()}var kc=T('<div class="error-item svelte-1ebqwoe"><span class="error-time svelte-1ebqwoe"> </span> <pre class="error-message svelte-1ebqwoe"> </pre></div>'),Sc=T('<div class="error-overlay svelte-1ebqwoe"><div class="error-panel svelte-1ebqwoe"><div class="error-header svelte-1ebqwoe"><span>🚨 Runtime Errors</span> <button class="svelte-1ebqwoe">✕</button></div> <!></div></div>');function Tc(s,t){Ke(t,!1);let a=re([]),d=re(!1);ga(()=>{const r=console.error;console.error=(...g)=>{r(...g);const y=g.map(m=>typeof m=="object"?JSON.stringify(m,null,2):String(m)).join(" ");h(a,[...e(a).slice(-4),{timestamp:new Date().toLocaleTimeString(),message:y,id:Date.now()}]),h(d,!0),y.includes("💥 CRITICAL")||setTimeout(()=>{h(a,e(a).filter(m=>m.id!==e(a)[e(a).length-1]?.id)),e(a).length===0&&h(d,!1)},1e4)},window.addEventListener("unhandledrejection",g=>{console.error("🚨 Unhandled Promise Rejection:",g.reason)})});function l(){h(a,[]),h(d,!1)}ot();var c=ze(),u=Ce(c);{var b=r=>{var g=Sc(),y=n(g),m=n(y),x=o(n(m),2);i(m);var k=o(m,2);Je(k,1,()=>e(a),nt,(f,C)=>{var w=kc(),I=n(w),O=n(I,!0);i(I);var H=o(I,2),F=n(H,!0);i(H),i(w),W(()=>{M(O,e(C).timestamp),M(F,e(C).message)}),p(f,w)}),i(y),i(g),ue("click",x,l),p(r,g)};B(u,r=>{e(d)&&e(a).length>0&&r(b)})}p(s,c),Ze()}var Ic=T('<div class="error-popup svelte-zcucz4"><div class="error-content svelte-zcucz4"><span class="error-icon svelte-zcucz4">⚠️</span> <span class="error-message svelte-zcucz4"> </span></div> <button class="error-close svelte-zcucz4">✕</button></div>'),Ec=T('<div class="error-popup-container svelte-zcucz4"></div>');function Cc(s,t){Ke(t,!1);const[a,d]=Xt(),l=()=>Ge(c,"$errors",a);let c=Wt([]),u=0;function b(y){const m={id:++u,message:y,timestamp:Date.now()};c.update(x=>[...x,m]),setTimeout(()=>{r(m.id)},1e4)}function r(y){c.update(m=>m.filter(x=>x.id!==y))}ga(()=>{if(typeof window<"u"){window.showError=b;const y=console.error;return console.error=function(...m){y.apply(console,m);const x=m.map(k=>typeof k=="object"?JSON.stringify(k):String(k)).join(" ");(x.includes("createHash")||x.includes("TypeError")||x.includes("is not a function")||x.includes("AccountInput")||x.includes("CRITICAL"))&&b(x.slice(0,200))},()=>{console.error=y,delete window.showError}}}),ot();var g=Ec();Je(g,5,l,y=>y.id,(y,m)=>{var x=Ic(),k=n(x),f=o(n(k),2),C=n(f,!0);i(f),i(k);var w=o(k,2);i(x),W(()=>M(C,e(m).message)),ue("click",w,()=>r(e(m).id)),p(y,x)}),i(g),p(s,g),Ze(),d()}var $c=T('<meta name="description" content="XLN Visual Debugger - Real-time consensus monitoring and debugging interface"/>'),jc=T('<div class="loading-container svelte-140hcng"><div class="loading-spinner svelte-140hcng">🔄</div> <div class="loading-text svelte-140hcng">Loading XLN Environment...</div></div>'),Ac=T('<div class="error-container svelte-140hcng"><div class="error-icon svelte-140hcng">❌</div> <div class="error-text svelte-140hcng">Failed to load XLN Environment</div> <div class="error-details svelte-140hcng"> </div> <button class="retry-btn svelte-140hcng">Retry</button></div>'),Nc=T('<div class="entity-panels-container svelte-140hcng" id="entityPanelsContainer"></div>'),Lc=T('<div class="main-content svelte-140hcng"><!> <!> <div class="actionable-tabs-container svelte-140hcng"><div class="tabs-header svelte-140hcng"><button id="formationTab">🏗️ Entity Formation</button> <button id="jurisdictionsTab">🏛️ Jurisdictions</button> <button id="networkTab">🌐 Network</button></div> <div id="formationTabContent"><!></div> <div id="jurisdictionsTabContent"><!></div> <div id="networkTabContent"><!></div></div></div> <!> <!>',1),Pc=T('<main class="app svelte-140hcng"><!> <!> <!></main>');function Rc(s,t){Ke(t,!1);const[a,d]=Xt(),l=()=>Ge(Ba,"$isLoading",a),c=()=>Ge(La,"$error",a),u=()=>Ge(Vt,"$tabs",a);let b=re("formation");function r(C){h(b,C)}ga(async()=>{window.addEventListener("error",C=>{console.error("❌ Global error caught:",C.error),La.set({message:C.error?.message||C.message||"An unknown error occurred",source:C.filename||"Unknown",details:C.error?.stack||""})}),window.addEventListener("unhandledrejection",C=>{console.error("❌ Unhandled promise rejection:",C.reason),La.set({message:C.reason?.message||String(C.reason)||"Unhandled promise rejection",source:"Promise",details:C.reason?.stack||""})});try{console.log("🚀 Initializing XLN Svelte application..."),Ha.initialize(),Ia.loadFromStorage(),Ia.initializeDefaultTabs(),Sa.initialize(),await js(),console.log("✅ XLN Svelte application initialized successfully")}catch(C){console.error("❌ Failed to initialize XLN application:",C),La.set({message:C?.message||"Failed to initialize application",source:"Initialization",details:C?.stack||""})}}),ot();var g=Pc();an(C=>{var w=$c();sn.title="XLN Consensus Visual Debug",p(C,w)});var y=n(g);Un(y,{});var m=o(y,2);Tc(m,{});var x=o(m,2);{var k=C=>{var w=jc();p(C,w)},f=C=>{var w=ze(),I=Ce(w);{var O=F=>{var A=Ac(),S=o(n(A),4),$=n(S,!0);i(S);var J=o(S,2);i(A),W(()=>M($,c())),ue("click",J,()=>js()),p(F,A)},H=F=>{var A=Lc(),S=Ce(A),$=n(S);{var J=ie=>{var pe=Nc();Je(pe,7,u,we=>we.id,(we,G,de)=>{{let Se=Ot(()=>e(de)===u().length-1);Fr(we,{get tab(){return e(G)},get isLast(){return e(Se)}})}}),i(pe),W(()=>qe(pe,"data-panel-count",u().length)),p(ie,pe)};B($,ie=>{u().length>0&&ie(J)})}var fe=o($,2);Zr(fe,{});var ee=o(fe,2),L=n(ee),ve=n(L);let P;var E=o(ve,2);let N;var K=o(E,2);let be;i(L);var se=o(L,2);let Z;var R=n(se);ul(R,{}),i(se);var q=o(se,2);let ce;var me=n(q);gl(me,{}),i(q);var $e=o(q,2);let je;var ae=n($e);xc(ae,{}),i($e),i(ee),i(S);var V=o(S,2);Hn(V,{});var U=o(V,2);Cc(U,{}),W((ie,pe,we,G,de,Se)=>{P=He(ve,1,"tab-button svelte-140hcng",null,P,ie),N=He(E,1,"tab-button svelte-140hcng",null,N,pe),be=He(K,1,"tab-button svelte-140hcng",null,be,we),Z=He(se,1,"tab-content svelte-140hcng",null,Z,G),ce=He(q,1,"tab-content svelte-140hcng",null,ce,de),je=He($e,1,"tab-content svelte-140hcng",null,je,Se)},[()=>({active:e(b)==="formation"}),()=>({active:e(b)==="jurisdictions"}),()=>({active:e(b)==="network"}),()=>({active:e(b)==="formation"}),()=>({active:e(b)==="jurisdictions"}),()=>({active:e(b)==="network"})]),ue("click",ve,()=>r("formation")),ue("click",E,()=>r("jurisdictions")),ue("click",K,()=>r("network")),p(F,A)};B(I,F=>{c()?F(O):F(H,!1)},!0)}p(C,w)};B(x,C=>{l()?C(k):C(f,!1)})}i(g),p(s,g),Ze(),d()}export{Rc as component};
